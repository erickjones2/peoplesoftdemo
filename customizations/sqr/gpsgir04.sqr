!***********************************************************************
!  GPSGIR04:  Appendix 8A - Value of Benefits-in-Kind for the Tax Year *
!***********************************************************************
!***********************************************************************
!                                                                      *
!                                                                      *
!                                                                      *
! This software and related documentation are provided under a         *
! license agreement containing restrictions on use and                 *
! disclosure and are protected by intellectual property                *
! laws. Except as expressly permitted in your license agreement        *
! or allowed by law, you may not use, copy, reproduce,                 *
! translate, broadcast, modify, license, transmit, distribute,         *
! exhibit, perform, publish or display any part, in any form or        *
! by any means. Reverse engineering, disassembly, or                   *
! decompilation of this software, unless required by law for           *
! interoperability, is prohibited.                                     *
! The information contained herein is subject to change without        *
! notice and is not warranted to be error-free. If you find any        *
! errors, please report them to us in writing.                         *
!                                                                      *
!                                                                      *
! Copyright (C) 1988, 2017, Oracle and/or its affiliates.              *
! All Rights Reserved.                                                 *
!***********************************************************************
!                                                                      *
!       $Release:  HR92                                                !
!           $Bug:  26907868                                            !
!***********************************************************************
! Modification History                                                 *
! Dated      Author  Changes                                           *
!***********************************************************************
!Dated            ICE          Changes
!03/02/05         1201358000   SQR has been modified to incorporate   *
!                               the format changes for year           *
!                               ended 31 Dec 2004
!11/01/07         1582607000  SQR has been modified to incorporate     *
!                              the format changes for year             *
!                              ended 31 Dec 2006                       *
!15/10/2014                    Changes made to incorporate the new App *
!                              8A Format changes for YA 2015. Also Am  *
!                              endments need to be supported for prior *
!                              year. gpsgir04.sqc is introduced to hold*
!                              the calculation logic for current year  *
!***********************************************************************
!

#Include 'setenv.sqc'  !Set environment

begin-setup
#include 'setupdb.sqc'
  page-size 76 70

    declare printer
      type          = HPLASERJET
      orientation   = portrait
      top-margin    = 0.30
      left-margin   = 0.4 ! 0.2 !Changes made for centralizing the form.
      font          = 5
      point-size    = 7
      line-size     = 11
      char-size     = 8

  declare-color-map
  white=(255,255,255)
  black = (0,0,0)
  end-declare

End-Setup

begin-report

  move 'GPSGIR04' to $ReportID
  move 'Singapore Appendix 8A Form' to $ReportTitle

  do Init-DateTime
  do Init-Number
  do Stdapi-Init
  do Select-Parameters

  Let $WrkTaxYear    = edit(#Tax_Year,'9999')
  Let $YrEndSrch_Dt = $WrkTaxYear || '1231'
  do Format-DateTime ($YrEndSrch_Dt, $YrEndSrch_Dt, {DEFCMP}, '', 'native')

  do Format-DateTime ($Date_Created, $Prn_Date_Created, {DEFDMY}, '', '')

  Let $InDate1 = $WrkTaxyear || '0101'
  Let $InDate2 = $WrkTaxyear || '1231'
  Do Count-LeapDays ($indate1,$indate2,#Leapdays)
  if #Leapdays = 0
     Let #DivYear = 365
  else
     Let #DivYear = 366
  end-if

     Let $DivYear = to_char (#DivYear)
     Let $DivYear = ltrim(rtrim ($DivYear,' '),' ')

  
  do Load-Bnft-Code-Rate
  do Build-Order-By
  do Build-Process

  do Stdapi-Term

end-report
!
!***********************************************************************
!  Procedure: Build-Process                                            *
!             The main driving procedure                               *
!***********************************************************************
begin-Procedure Build-Process

    do Get-Company-Details
    let $SlctEmpls = ''
    if rtrim($Paygroup,' ') <> ''
       Do Build-Where
    else
       do Select-Spec-Empls
    end-if

end-procedure
!

!***********************************************************************
! Procedure: Get-Company-Details                                       *
!            Gets the Company Details that are printed on the form.    *
!***********************************************************************
begin-procedure Get-Company-Details

begin-SELECT
CO.GPSG_REGISTERED_NM
CO.GPSG_CPY_DESCR
CO.GPSG_ADDRESS1
CO.GPSG_ADDRESS2
CO.GPSG_ADDRESS3
CO.POSTAL
CO.GPSG_TAX_CONT_ID
CO.GPSG_CPY_SIGNATORY
CO.PHONE
CO.GPSG_OHQ_STATUS

  FROM PS_GPSG_IRAS_CPY CO
 WHERE CO.GPSG_CPY_TAX_REF = $Company_Tax_Ref
   AND CO.EFFDT = (SELECT MAX(CO1.EFFDT)
                     FROM PS_GPSG_IRAS_CPY CO1
                    WHERE CO1.GPSG_CPY_TAX_REF = CO.GPSG_CPY_TAX_REF
                      AND CO1.EFFDT <= $AsofToday)
end-SELECT

  let $Co_Phone = rtrim(&CO.PHONE, ' ')
  let $Co_Tax_Contact_Id = rtrim(&CO.GPSG_TAX_CONT_ID, ' ')
  let $Co_Tax_Contact = rtrim(&CO.GPSG_CPY_SIGNATORY, ' ')

  let $Co_Name = rtrim(&CO.GPSG_REGISTERED_NM, ' ')
  if $Co_Name = ''
     let $Co_Name = rtrim(&CO.GPSG_CPY_DESCR, ' ')
  end-if
  uppercase $Co_Name

  let $Co_Address = rtrim(&CO.GPSG_ADDRESS1,' ')
  if $Co_Address = ''
    if rtrim(&CO.GPSG_ADDRESS2,' ') <> ''
       let $Co_Address = rtrim(&CO.GPSG_ADDRESS2,' ')
    end-if
  else
    if rtrim(&CO.GPSG_ADDRESS2,' ') <> ''
       let $Co_Address = $Co_Address || ', ' || rtrim(&CO.GPSG_ADDRESS2,' ')
    end-if
  end-if
  if $Co_Address = ''
    if rtrim(&CO.GPSG_ADDRESS3,' ') <> ''
      let $Co_Address = rtrim(&CO.GPSG_ADDRESS3,' ')
    end-if
  else
    if rtrim(&CO.GPSG_ADDRESS3,' ') <> ''
      let $Co_Address = $Co_Address || ',  ' || rtrim(&CO.GPSG_ADDRESS3,' ')
    end-if
  end-if

  if rtrim(&CO.POSTAL,' ') <> ''
      let $Co_Address = $Co_Address || ',  ' || rtrim(&CO.POSTAL,' ')
  end-if

  uppercase $Co_Address

begin-select
P.NAME
JC.DESCR

  FROM PS_JOB J
     , PS_PERSON_NAME P
     , PS_JOBCODE_TBL JC

 WHERE P.EMPLID = J.EMPLID
   AND J.EMPL_RCD = 0
   AND P.EMPLID = $Co_Tax_Contact_Id
   AND J.JOBCODE = JC.JOBCODE
   AND J.SETID_JOBCODE = JC.SETID
   AND J.EFFDT = (SELECT MAX(J1.EFFDT)
                    FROM PS_JOB J1
                   WHERE J1.EMPLID = J.EMPLID
                     AND J1.EMPL_RCD = J.EMPL_RCD
                     AND J1.EFFDT <= $AsofToday)
   AND J.EFFSEQ = (SELECT MAX(J1.EFFSEQ)
                     FROM PS_JOB J1
                    WHERE J1.EMPLID = J.EMPLID
                      AND J1.EMPL_RCD = J.EMPL_RCD
                      AND J1.EFFDT = J.EFFDT)
   AND JC.EFFDT = (SELECT MAX(JC1.EFFDT)
                     FROM PS_JOBCODE_TBL JC1
                    WHERE JC1.JOBCODE = J.JOBCODE
                      AND JC1.SETID = JC.SETID
                      AND JC1.EFFDT <= $AsofToday)
end-select

  if rtrim(&P.NAME, ' ') <> ''
     let $Co_Tax_Contact = rtrim(&P.NAME, ' ')
  end-if

  uppercase $Co_Tax_Contact
  let $Co_Designation = rtrim(&JC.DESCR, ' ')
  uppercase $Co_Designation

end-procedure



!***********************************************************************
! Procedure: Process-Empls                                             *
!            Select App 8A data to be printed.                         *
!***********************************************************************
!
begin-Procedure Process-Empls

begin-SELECT
A8.EMPLID
A8.BALANCE_GRP_NUM
A8.GPSG_CPY_TAX_REF
A8.GPSG_TAX_YEAR
A8.GPSG_AP8A_RES_SHR
A8.GPSG_AP8A_RES_FR
A8.GPSG_AP8A_RES_TO
A8.GPSG_AP8A_ER_RENT
A8.GPSG_AP8A_EE_RENT
A8.GPSG_AP8A_FURNIT
A8.GPSG_AP8A_FRIDGE
A8.GPSG_AP8A_VCR
A8.GPSG_AP8A_WASHER
A8.GPSG_AP8A_DRYER
A8.GPSG_AP8A_DWASHER
A8.GPSG_AP8A_AC_UNIT
A8.GPSG_AP8A_AC_CENTR
A8.GPSG_AP8A_AC_SITTG
A8.GPSG_AP8A_AC_ADDNL
A8.GPSG_AP8A_TV
A8.GPSG_AP8A_RADIO
A8.GPSG_AP8A_AMP
A8.GPSG_AP8A_STEREO
A8.GPSG_AP8A_GUITAR
A8.GPSG_AP8A_COMPUTER
A8.GPSG_AP8A_ORGAN
A8.GPSG_AP8A_POOL
A8.GPSG_AP8A_PUB_UT
A8.GPSG_AP8A_PHONE
A8.GPSG_AP8A_PAGER
A8.GPSG_AP8A_SUITCASE
A8.GPSG_AP8A_GOLF_BAG
A8.GPSG_AP8A_CAMERA
A8.GPSG_AP8A_SERVANT
A8.GPSG_AP8A_DRIVER
A8.GPSG_AP8A_GARDENER
A8.GPSG_AP8A_OTH_FURN
A8.GPSG_AP8A_HTL_SLFN
A8.GPSG_AP8A_HTL_SLFD
A8.GPSG_AP8A_HTL_SPSN
A8.GPSG_AP8A_HTL_SPSD
A8.GPSG_AP8A_HTL_C20N
A8.GPSG_AP8A_HTL_C20D
A8.GPSG_AP8A_HTL_CH8N
A8.GPSG_AP8A_HTL_CH8D
A8.GPSG_AP8A_HTL_CH3N
A8.GPSG_AP8A_HTL_CH3D
A8.GPSG_AP8A_HTL_CH0N
A8.GPSG_AP8A_HTL_CH0D
A8.GPSG_AP8A_HOME_LVE
A8.GPSG_AP8A_HL_SELF
A8.GPSG_AP8A_HL_WIFE
A8.GPSG_AP8A_HL_CHILD
A8.GPSG_AP8A_ER_INT
A8.GPSG_AP8A_LIFE_INS
A8.GPSG_AP8A_HOLIDAY
A8.GPSG_AP8A_EDUC
A8.GPSG_AP8A_LS_AWARD
A8.GPSG_AP8A_FEES
A8.GPSG_AP8A_GAINS
A8.GPSG_AP8A_VEHICLE
A8.GPSG_AP8A_CAR
A8.GPSG_AP8A_OTHER
A8.GPSG_8A_STATUS
A8.GPSG_CREATE_DATE
I.GPSG_8A_GROSS
I.GPSG_8A_NC_BONUS
I.GPSG_8A_CNT_BONUS
I.GPSG_8A_DIR_FEE
I.GPSG_8A_COMMSN
I.GPSG_8A_PENSION
I.GPSG_8A_ALLOW_TOT
I.GPSG_8A_GRATUITY
I.GPSG_8A_EXGRATIA
I.GPSG_8A_RETIRE
I.GPSG_8A_OS_PENSION
I.GPSG_CPF_VOL_ER
I.GPSG_8A_SHARE_GAIN
I.NATIONAL_ID
I.NATIONAL_ID_TYPE
I.NAME
I.GPSG_ADDRESS1
I.GPSG_ADDRESS2
I.GPSG_ADDRESS3
I.GPSG_8A_BIK
A8.GPSG_ADDRESS1
A8.GPSG_ADDRESS2
A8.GPSG_ADDRESS3
A8.GPSG_AP8A_FAN
A8.GPSG_AP8A_TOASTER
A8.GPSG_AP8A_IRON
A8.GPSG_AP8A_COOLER
A8.GPSG_AP8A_LIGHT
A8.GPSG_AP8A_VACUUM
A8.GPSG_AP8A_COOKER
A8.GPSG_AP8A_WATER_HT
A8.GPSG_AP8A_OVEN
A8.GPSG_AP8A_JUICER
A8.GPSG_AP8A_BLENDER
A8.GPSG_AP8A_KETTLE
A8.GPSG_AP8A_FLOOR_PL
A8.GPSG_AP8A_MOWER
A8.GPSG_AP8A_FAX
A8.GPSG_AP8A_AC_APF
A8.GPSG_AP8A_SVS
A8.GPSG_AP8A_RES_VAL
A8.GPSG_FURNISHED
A8.GPSG_AP8A_EL_GADG
A8.GPSG_AP8A_ER_HTL
A8.GPSG_AP8A_EE_HTL


   Let #Annual_Value =  &A8.GPSG_AP8A_RES_VAL
   Let $Furnished =  &A8.GPSG_FURNISHED
   Let $Elect_Gadgets = &A8.GPSG_AP8A_EL_GADG
   Let #Er_Hotel = &A8.GPSG_AP8A_ER_HTL
   Let #Ee_Hotel = &A8.GPSG_AP8A_EE_HTL

   let $Nid = &I.NATIONAL_ID
   let $Nid_Type = &I.NATIONAL_ID_TYPE
   Do Format_NationalID($Nid, $Nid_Type)
   Move &A8.EMPLID to $Emplid
   Move &A8.BALANCE_GRP_NUM to $Balance_Grp_Num

   !Move &I.NATIONAL_ID to $TaxRefNo
   Let $TaxRefNo = $Nid

   Move &A8.GPSG_AP8A_ER_RENT to $ER
   Move &A8.GPSG_AP8A_EE_RENT to $EE
   
   Let #Prev_BIK = &I.GPSG_8A_BIK


   let $Tax_Ref_Type = rtrim(&I.NATIONAL_ID_TYPE, ' ')
   if $Tax_Ref_Type = 'IC' or $Tax_Ref_Type = 'PR'
      let $Tax_Ref_Type = 'NRIC'
   else
      if $Tax_Ref_Type = 'EP' or $Tax_Ref_Type = 'FI'
         let $Tax_Ref_Type = 'FIN'
      else
         let $Tax_Ref_Type = 'Other'
      end-if
   end-if

   if &A8.GPSG_AP8A_RES_SHR <> 0
      Let #NoSharing = &A8.GPSG_AP8A_RES_SHR
   else
      Let #NoSharing = 1
   end-if
   Let #TotalRem       = &I.GPSG_8A_NC_BONUS + &I.GPSG_8A_CNT_BONUS + &I.GPSG_8A_DIR_FEE + &I.GPSG_8A_COMMSN + &I.GPSG_8A_PENSION
                       + &I.GPSG_8A_ALLOW_TOT + &I.GPSG_8A_GRATUITY +&I.GPSG_8A_EXGRATIA+ &I.GPSG_8A_RETIRE + &I.GPSG_8A_GROSS
                       + &I.GPSG_8A_OS_PENSION + &I.GPSG_CPF_VOL_ER + &I.GPSG_8A_SHARE_GAIN

   Let #DiffDays = 0
   do calc-diff-days
   Let $Adr1 = ' '
   Let $Adr2 = ' '
   Let $Adr3 = ' '


   Let $Adr1 = &I.GPSG_ADDRESS1
   Let $Adr2 = rtrim(&I.GPSG_ADDRESS2,' ')


   let $Adr3 = &I.GPSG_ADDRESS3

   if rtrim($Adr1,' ') = ''
      If rtrim($Adr2,' ') = ''
         Let $Adr1 = $Adr3
         let $Adr3 = ' '
      else
         Let $Adr2 = $Adr3
         let $Adr3 = ' '
      end-if
   else
      If rtrim($Adr2,' ') = ''
         Let $Adr2 = $Adr3
         let $Adr3 = ' '
      end-if
   end-if


     Let #TotalFurniture = round(&A8.GPSG_AP8A_FURNIT   * #Furniture    * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalRefrig    = round(&A8.GPSG_AP8A_FRIDGE   * #Refrigerator * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalVCR       = round(&A8.GPSG_AP8A_VCR      * #VCR          * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalWashMach  = round(&A8.GPSG_AP8A_WASHER   * #Washmach     * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalDryer     = round(&A8.GPSG_AP8A_DRYER    * #Dryer        * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalDishWash  = round(&A8.GPSG_AP8A_DWASHER  * #DishWasher   * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalACUnit    = round(&A8.GPSG_AP8A_AC_UNIT  * #ACUnit       * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalACCentral = round(&A8.GPSG_AP8A_AC_CENTR * #ACCentral    * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalACSitting = round(&A8.GPSG_AP8A_AC_SITTG * #ACSitting    * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalACAddl    = round(&A8.GPSG_AP8A_AC_ADDNL * #ACAddl       * 12 * #DiffDays / #DivYear / #NoSharing, 2)

     Let #TotalACPurifier= round(&A8.GPSG_AP8A_AC_APF   * #ACPurifier   * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalSVSystem  = round(&A8.GPSG_AP8A_SVS      * #SVSystem     * 12 * #DiffDays / #DivYear / #NoSharing, 2)

     Let #TotalTV        = round(&A8.GPSG_AP8A_TV       * #TV           * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalRadio     = round(&A8.GPSG_AP8A_RADIO    * #Radio        * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalAmp       = round(&A8.GPSG_AP8A_AMP      * #Amp          * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalHiFi      = round(&A8.GPSG_AP8A_STEREO   * #HiFi         * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalGuitar    = round(&A8.GPSG_AP8A_GUITAR   * #Guitar       * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalComputer  = round(&A8.GPSG_AP8A_COMPUTER * #Computer     * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalOrgan     = round(&A8.GPSG_AP8A_ORGAN    * #Organ        * 12 * #DiffDays / #DivYear / #NoSharing, 2)
     Let #TotalPool      = round(&A8.GPSG_AP8A_POOL     * #Pool         * 12 * #DiffDays / #DivYear / #NoSharing, 2)

     Let #TotalOthers    = round(&A8.GPSG_AP8A_FAN      * #Fan          * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_TOASTER  * #Toaster      * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_IRON     * #Iron         * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_COOLER   * #AirCooler    * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_LIGHT    * #Light        * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_VACUUM   * #Vacuum       * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_COOKER   * #Cooker       * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_WATER_HT * #WaterHeater  * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_OVEN     * #Oven         * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_JUICER   * #Juicer       * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_BLENDER  * #Blender      * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_KETTLE   * #Kettle       * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_FLOOR_PL * #FloorPolishr * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + round(&A8.GPSG_AP8A_MOWER    * #Mower        * 12 * #DiffDays / #DivYear / #NoSharing, 2)
                         + &A8.GPSG_AP8A_FAX
                         + &A8.GPSG_AP8A_OTH_FURN

     Let #TotalBVar = #TotalRefrig + #TotalVCR
     Let #TotalCVar = #TotalWashMach + #TotalDryer + #TotalDishWash
     Let #TotalDVar = #TotalACUnit + #TotalACCentral + #TotalACSitting + #TotalACAddl  + #TotalACPurifier
    ! Let #TotalEVar = #TotalTV + #TotalRadio + #TotalAmp + #TotalHiFi + #TotalGuitar
     Let #TotalEVar = #TotalTV + #TotalRadio + #TotalHiFi + #TotalGuitar + #TotalSVSystem
     Let #TotalFVar = #TotalComputer + #TotalOrgan

     Let #TotalHVar      = &A8.GPSG_AP8A_PUB_UT   + &A8.GPSG_AP8A_PHONE    + &A8.GPSG_AP8A_PAGER +
                           &A8.GPSG_AP8A_SUITCASE + &A8.GPSG_AP8A_GOLF_BAG + &A8.GPSG_AP8A_CAMERA +
                           &A8.GPSG_AP8A_SERVANT
     Let #TotalDriver    = &A8.GPSG_AP8A_DRIVER
     Let #TotalGardener  = &A8.GPSG_AP8A_GARDENER
     if #TotalGardener > 35
        Let #TotalGardener = 35
     end-if
     Let #Total2Block = #TotalFurniture + #TotalBVar + #TotalCVar + #TotalDVar   + #TotalEVar
                      + #TotalFVar      + #TotalPool + #TotalHVar + #TotalDriver + #TotalGardener
                      + #TotalOthers

     Let #TotalRem = #TotalRem  + #TotalFurniture + #TotalBVar + #TotalCVar + #TotalDVar
                   + #TotalEVar + #TotalFVar + #TotalPool + #TotalHVar + #TotalDriver
                   + #TotalGardener + #TotalOthers +
                   + &A8.GPSG_AP8A_HOME_LVE
                   + &A8.GPSG_AP8A_ER_INT
                   + &A8.GPSG_AP8A_LIFE_INS
                   + &A8.GPSG_AP8A_HOLIDAY
                   + &A8.GPSG_AP8A_EDUC
                   + &A8.GPSG_AP8A_LS_AWARD
                   + &A8.GPSG_AP8A_FEES
                   + &A8.GPSG_AP8A_GAINS
                   + &A8.GPSG_AP8A_VEHICLE
                   + &A8.GPSG_AP8A_CAR
                   + &A8.GPSG_AP8A_OTHER

     Let #TotalTenPercRem = round(#TotalRem * .10, 2)

     if &A8.GPSG_AP8A_ER_RENT < #TotalTenPercRem
        Let #TotalResidValue = &A8.GPSG_AP8A_ER_RENT
     else
        Let #TotalResidValue = #TotalTenPercRem
     end-if

     let #TotalResidValue = #TotalResidValue - &A8.GPSG_AP8A_EE_RENT

     if  #TotalResidValue  <  0
        let #TotalResidValue  =  0
     end-if


     Let #HotelLine1 = 0
     Let #HotelLine2 = 0
     Let #HotelLine3 = 0
     Let #HotelLine4 = 0

     if (&A8.GPSG_AP8A_HTL_SLFN <> 0 and &A8.GPSG_AP8A_HTL_SLFD <> 0) OR (&A8.GPSG_AP8A_HTL_SPSN <> 0 and &A8.GPSG_AP8A_HTL_SPSD <> 0) OR ( &A8.GPSG_AP8A_HTL_C20N <> 0 AND &A8.GPSG_AP8A_HTL_C20D <> 0)  

        Let #HotelLine1 = round(((&A8.GPSG_AP8A_HTL_SLFN * #Abv20Yrs * 12 * &A8.GPSG_AP8A_HTL_SLFD / #DivYear) + (&A8.GPSG_AP8A_HTL_SPSN * #Abv20Yrs * 12 * &A8.GPSG_AP8A_HTL_SPSD / #DivYear)
                         + (&A8.GPSG_AP8A_HTL_C20N * #Abv20Yrs * 12 * &A8.GPSG_AP8A_HTL_C20D / #DivYear)), 2)
     end-if

     if &A8.GPSG_AP8A_HTL_CH8N <> 0 and &A8.GPSG_AP8A_HTL_CH8D <> 0
        Let #HotelLine2 = round(&A8.GPSG_AP8A_HTL_CH8N * #Bet8_20Yrs * 12 * &A8.GPSG_AP8A_HTL_CH8D / #DivYear, 2)
     end-if
     if &A8.GPSG_AP8A_HTL_CH3N <> 0  and &A8.GPSG_AP8A_HTL_CH3D <> 0
        Let #HotelLine3 = round(&A8.GPSG_AP8A_HTL_CH3N * #Bet3_7Yrs * 12 * &A8.GPSG_AP8A_HTL_CH3D / #DivYear, 2)
     end-if
     if &A8.GPSG_AP8A_HTL_CH0N <> 0 and &A8.GPSG_AP8A_HTL_CH0D <> 0
        Let #HotelLine4 = round(&A8.GPSG_AP8A_HTL_CH0N * #Less3Yrs * 12 * &A8.GPSG_AP8A_HTL_CH0D / #DivYear, 2)
     end-if
     let #Tot_Hotel_Line=#HotelLine2+#HotelLine3+#HotelLine4

!2% of Basic salary

     if #HotelLine1 <> 0 or #HotelLine2 <> 0 or #HotelLine3 <> 0 or #HotelLine4 <> 0
        let #TwoPercentBasicSalary = round(&A8.GPSG_AP8A_HTL_SLFD / #DivYear * 0.02 * &I.GPSG_8A_GROSS, 2)
     else
        let #TwoPercentBasicSalary = 0
     end-if

     Let #Total3Block = #HotelLine1 + #HotelLine2 + #HotelLine3 + #HotelLine4 + #TwoPercentBasicSalary

     Let #Total4Block = &A8.GPSG_AP8A_HOME_LVE + &A8.GPSG_AP8A_ER_INT + &A8.GPSG_AP8A_LIFE_INS
                      + &A8.GPSG_AP8A_HOLIDAY  + &A8.GPSG_AP8A_EDUC   + &A8.GPSG_AP8A_LS_AWARD
                      + &A8.GPSG_AP8A_FEES     + &A8.GPSG_AP8A_GAINS  + &A8.GPSG_AP8A_VEHICLE
                      + &A8.GPSG_AP8A_CAR      + &A8.GPSG_AP8A_OTHER

     Let #TotalAppendix = #TotalResidValue + #Total2Block + #Total3Block + #Total4Block

   if #Tax_Year < 2014
     Do Print-Report
   end-if

   if #Tax_Year >=2014
     Do Print-Report-New-Format
   end-if

   FROM PS_GPSG_APP_8A A8,
        PS_GPSG_IR8A_FORM I

  WHERE A8.GPSG_TAX_YEAR    = #Tax_Year
    AND A8.GPSG_TAX_YEAR    = I.GPSG_TAX_YEAR
    AND A8.EMPLID           = I.EMPLID
    AND A8.BALANCE_GRP_NUM  = I.BALANCE_GRP_NUM
    AND A8.GPSG_CPY_TAX_REF = I.GPSG_CPY_TAX_REF
    [$SlctEmpls]
    [$SlctCriteria]

[$OrderClause]

end-SELECT
end-procedure


!**************************************************************************
! Procedure: Get-Country-Name
!            Get Country name
!**************************************************************************
begin-procedure Get-Country-Name
  move '' to $CountryName
  move '' to $CountryShortNm

begin-SELECT
CT.DESCR,
CT.DESCRSHORT
  FROM PS_COUNTRY_TBL CT
 WHERE CT.COUNTRY = $CountryCode
end-SELECT

  let $CountryName    = rtrim(&CT.Descr,' ')
  let $CountryShortNm = rtrim(&CT.DescrShort,' ')

end-procedure

!
!***********************************************************************
! Procedure: Build-Order-By                                            *
!            Dynamically build the order by clause according to flags. *
!***********************************************************************
begin-Procedure Build-Order-By

  move ' ORDER BY' to $OrderClause

  evaluate $Empl_Sort
    when = 'E'
      let $OrderClause =  $OrderClause || ' I.EMPLID, I.BALANCE_GRP_NUM'
      break
    when = 'T'
      let $OrderClause =  $OrderClause || ' I.NATIONAL_ID'
      break
    when-other
      let $OrderClause =  $OrderClause || ' I.NAME'
  end-evaluate

end-Procedure

!
!***********************************************************************
! Procedure: Select-Spec-Empls                                         *
!            Select Specific employees listed in the child run control.*
!***********************************************************************
begin-procedure Select-Spec-Empls

  let $Empls_Exist = 'N'

  begin-SELECT
EMPLID

     let $Empls_Exist = 'Y'

  FROM PS_GPSG_RC_IRASEMP
 WHERE OPRID       =  $Prcs_OprID
   AND RUN_CNTL_ID =  $Prcs_Run_Cntl_ID

end-SELECT

  if $Empls_Exist = 'Y'
     let $SlctEmpls = ' AND EXISTS (SELECT ''X'' FROM PS_GPSG_RC_IRASEMP R '
     let $SlctEmpls = $SlctEmpls || 'WHERE R.OPRID = ''' || $Prcs_OprID || ''' AND R.RUN_CNTL_ID = '''
     let $SlctEmpls = $SlctEmpls || $Prcs_Run_Cntl_ID || ''' AND R.EMPLID = A8.EMPLID '
     let $SlctEmpls = $SlctEmpls || 'AND R.BALANCE_GRP_NUM = A8.BALANCE_GRP_NUM)'
  end-if

  do Build-Where

end-procedure

!
!***********************************************************************
! Procedure: Build-Where                                               *
!            Dynamically build the WHERE clause according to flags.    *
!***********************************************************************
begin-procedure Build-Where
if $Company_Tax_Ref <> ''
  let $SlctCompany = 'AND A8.GPSG_CPY_TAX_REF = ''' || $Company_Tax_Ref
  concat '''' with $SlctCompany
end-if
  if $Reprint = 'N'
     let $SlctStatus = ' AND A8.GPSG_8A_STATUS = ''W'''
  else
     let $SlctStatus = ' AND A8.GPSG_8A_STATUS IN (''W'',''Y'')'
  end-if

  if $Paygroup <> ''
     let $SlctCriteria = ' AND I.GP_PAYGROUP = ''' || $Paygroup
     concat '''' with $SlctCriteria
  end-if

  let $SlctCriteria = $SlctCriteria||$SlctStatus||$SlctCompany

  do Process-Empls

end-procedure
!
!
!***********************************************************************
!  Procedure: Update-Employee-Rec                                      *
!             Updated the Issue Status and Date Issued fields for the  *
!             employee.                                                *
!***********************************************************************
begin-procedure Update-Employee-Rec
   let $sql-statement = 'GPSGIR04.SQR,Update-Record,PS_GPSG_IR8A_FORM'

   begin-SQL on-error=SQL-Error
      UPDATE PS_GPSG_APP_8A
         SET GPSG_8A_STATUS = 'Y',
             GPSG_CREATE_DATE = $Date_Created
       WHERE EMPLID = $EmplId
         AND BALANCE_GRP_NUM = $Balance_Grp_Num
         AND GPSG_CPY_TAX_REF = $Company_Tax_Ref
         AND GPSG_TAX_YEAR = #Tax_Year
   end-SQL

end-Procedure

!
!
!***********************************************************************
!  Procedure: Update-BIK-Value                                         *
!             Updated the Benefits in Kind Value into ir8a_form_sgp    *
!***********************************************************************
begin-procedure Update-BIK-Value

   let $sql-statement = 'GPSGIR04.SQR,Update-Record,PS_GPSG_IR8A_FORM'

   begin-SQL on-error=SQL-Error
      UPDATE PS_GPSG_IR8A_FORM
         SET GPSG_8A_INCOME_TOT = GPSG_8A_INCOME_TOT - GPSG_8A_BIK + #TotalAppendix
           , GPSG_8A_BIK = #TotalAppendix
       WHERE EMPLID = $EmplId
         AND BALANCE_GRP_NUM = $Balance_Grp_Num
         AND GPSG_CPY_TAX_REF = $Company_Tax_Ref
         AND GPSG_TAX_YEAR = #Tax_Year
   end-SQL

end-Procedure


!
begin-procedure calc-diff-days

   Let #DiffDays = 0
   Let $OccupDT = &A8.GPSG_AP8A_RES_FR

   if rtrim(&A8.GPSG_AP8A_RES_FR,' ') <> ''
      Do Convert-To-DTU-Date(&A8.GPSG_AP8A_RES_FR, $OccupFrom)
   end-if

   if rtrim(&A8.GPSG_AP8A_RES_TO,' ') <> ''
      Let $OccupDT = &A8.GPSG_AP8A_RES_TO

      Do Convert-To-DTU-Date(&A8.GPSG_AP8A_RES_TO, $OccupTo)

      Do Dtu-Diff-Days($OccupFrom, $OccupTo,#DiffDays)
      iF #DiffDays > 0
         Add 1 to #DiffDays
      end-if
      if #DiffDays > 366
         let #DiffDays = 366
      end-if
   end-if

end-Procedure
!
!***********************************************************************
!  Procedure: Init-Report                                              *
!             The main driving procedure                               *
!***********************************************************************
begin-Procedure Print-Report

     graphic () font 4 15

     let $NextYear = to_char((#Tax_Year + 1))
     print $NextYear               (1,1) bold
     print 'APPENDIX 8A'           (0,29) bold
     graphic                       (2,1,70)  box 2 0 100
     graphic () font 5 10

     print ' ' (2,1)

     let $TaxYear = to_char(#Tax_Year)
     alter-color-map name = 'white' value = (255, 255, 255)
     get-color print-text-foreground = ($print-foreground)
     set-color print-text-foreground = ('white') 

     let $Line2Title = 'Value of Benefits-in-Kind for the Year Ended 31 Dec ' || $TaxYear

     print $Line2Title (0,18) bold  foreground = ('white') 
     print ' ' (3,1)
     let $Notice1 = '(Fill in this form if applicable and give it to your employee by 1 Mar ' || to_char(#Tax_Year + 1) || ' for his submission together with his Income Tax Return)'
     print $Notice1 (0,-1) BOLD

     alter-color-map name = 'black' value = (0, 0, 0)
     get-color print-text-foreground = ($print-foreground)
     set-color print-text-foreground = ('black') 

     graphic () font 4 8

     print 'Tax Ref No : '       (5,52) Bold
     print $Tax_Ref_Type         (0,59) Bold foreground = ('black') 

     print $TaxRefNo             (0,+1) Bold
     print 'Full Name of Employee as per NRIC / FIN :  ' (5,1)  Bold

     print &I.NAME               (0,21) Bold wrap 32 2 
     print '$'                   (6,67)
     print '1. Value of the place of residence (See paragraph 14 of the Explanatory Notes) :' (7,1) BOLD

     graphic    (7,63,7) horz-line 
     if #TotalResidValue = 0
        print '0'               (7,67)
     else
        print #TotalResidValue   (7,62) edit '999,999,999.9B'
     end-if

     graphic    (8,1,62)  box 4
     graphic    (12,1,62) box 2
     graphic    (7,45,5)  vert-line
     graphic    (7,57,4)  vert-line
     graphic    (13,1,62) box 1

     graphic () font 5 8
     print 'Address:'                             (8,1)
     print 'Period of occupation:'                (8,46)
     print 'No. of'                              (8,58)

     print &A8.GPSG_ADDRESS1                     (9,2)
     print 'days:'                                (9,58)
     print &A8.GPSG_ADDRESS2                     (10,2)
     print &A8.GPSG_ADDRESS3                     (11,2)

     if rtrim(&A8.GPSG_AP8A_RES_FR,' ') <> ''
        print &A8.GPSG_AP8A_RES_FR               (11,46) edit 'DD/MM/YYYY'
        print '-'                                (11,51)
     end-if

     if rtrim(&A8.GPSG_AP8A_RES_TO,' ') <> ''
        print &A8.GPSG_AP8A_RES_TO               (11,52) edit 'DD/MM/YYYY'
     end-if

     print #DiffDays (11,58) edit '9999'

     print 'Annual value of Premises/Rent paid by employer:' (12,2) 
     print 'Rent paid by employee:' (12,46) 
 
     print 'Number of employee(s) sharing the premises (exclude family members who are not employees):' (13,2)   

     if #TotalResidValue <> 0
        print &A8.GPSG_AP8A_ER_RENT              (12,29) edit '999999999.99'
        print &A8.GPSG_AP8A_EE_RENT              (12,54) edit '999999999.99'
     end-if

     print #NoSharing  (13,46) edit '999999999'  

     graphic () font 4 8

     print '2. Value of Furniture & Fittings/Driver/Gardener (Total of 2a to 2k):' (14,1) BOLD
     graphic            (14,63,7) horz-line
     if #Total2Block = 0
        print 'NA'               (14,67)
     else
        print #Total2Block       (14,62) edit '999,999,999.9B'
     end-if

     graphic (15,1,62) box 18

     graphic (17,1,62) horz-line
     graphic (18,1,62) horz-line
     graphic (19,1,62) horz-line
     graphic (20,1,62) horz-line
     graphic (22,1,62) horz-line
     graphic (24,1,62) horz-line
     graphic (25,1,62) horz-line
     graphic (26,1,62) horz-line
     graphic (28,1,62) horz-line
     graphic (29,1,62) horz-line
     graphic (31,1,62) horz-line

     graphic (14,33,18) vert-line
     graphic (14,47,12) vert-line
     graphic (14,56,18) vert-line

     graphic (18,40,1) vert-line

     graphic (19,38,1) vert-line
     graphic (19,42,1) vert-line


     graphic (20,37,2) vert-line
     graphic (20,39,2) vert-line
     graphic (20,41,2) vert-line
     graphic (20,43,2) vert-line

     graphic (22,36,2) vert-line
     graphic (22,39,2) vert-line
     graphic (22,42,2) vert-line
     graphic (22,44,2) vert-line

     graphic (24,40,1) vert-line

     print 'Item (Please cross box if applicable)' (15,8) ! BOLD
     print 'A) No of Units'                 (15,36) !BOLD
     print 'B) Rate per'                    (15,48) !BOLD
     print '#Value ($)'                     (15,57) !BOLD
     print 'unit  p.m.($)'                  (16,48) !BOLD

     print 'a. Furniture : Hard & Soft'     (18,2)
     print &A8.GPSG_AP8A_FURNIT             (18,36)
     print #Furniture                       (18,51) edit '99.9B'
     if &A8.GPSG_AP8A_FURNIT <> 0
        !print &A8.GPSG_AP8A_FURNIT         (18,40) edit '9B'
        print #TotalFurniture               (18,56) edit '9999999.9B'
     end-if

     graphic                                (19,3,1) box 1
     graphic                                (19,11,1) box 1


     if &A8.GPSG_AP8A_FRIDGE <> 0
        print 'X'                     (19,3)
        print &A8.GPSG_AP8A_FRIDGE    (19,34)   edit '9B'
     end-if

     if &A8.GPSG_AP8A_VCR
        print 'X'                     (19,11)
        print &A8.GPSG_AP8A_VCR       (19,42)   edit '9B'
     end-if

     Let $BRate = edit(#Refrigerator,'99.9B')
     Let $BRate1 = edit(#VCR,'99.9B')

     Let $BRate = $BRate || '/' || $BRate1

     print 'b.     Refrigerator          Video Recorder/DVD/VCD Player' (19,2)

     print $BRate                                       (19,49)
     print #TotalBVar                                   (19,56) edit '9999999.9B'

     graphic (20,3,1)  box 1
     graphic (20,14,1) box 1
     graphic (20,19,1) box 1

     if &A8.GPSG_AP8A_WASHER
        print 'X'                     (20,3)
        print &A8.GPSG_AP8A_WASHER    (20,34)   edit '9B'
     end-if
     if &A8.GPSG_AP8A_DRYER
        print 'X'                     (20,14)
        print &A8.GPSG_AP8A_DRYER     (20,39)  edit '9B'
     end-if
     if &A8.GPSG_AP8A_DWASHER
        print 'X'                     (20,19)
        print &A8.GPSG_AP8A_DWASHER   (20,43)  edit '9B'
     end-if

     print 'c.     Washing Machine           Dryer         Dish Washer' (20,2)

     print #Washmach                                 (20,51) edit '99.9B'
     print #TotalCVar                                (20,56) edit '9999999.9B'



     graphic (21,10,1)  box 1
     graphic (21,14,1)  box 1
     graphic (21,23,1) box 1
     graphic (21,27,1) box 1
     graphic (22,3,1) box 1


     if &A8.GPSG_AP8A_AC_UNIT
        print 'X'                     (21,10)
        print &A8.GPSG_AP8A_AC_UNIT   (21,33) edit '9B'
     end-if
     if &A8.GPSG_AP8A_AC_CENTR
        print 'X'                     (21,14)
        print &A8.GPSG_AP8A_AC_CENTR  (21,37) edit '9B'
     end-if
     if &A8.GPSG_AP8A_AC_SITTG
        print 'X'                     (21,23)
        print &A8.GPSG_AP8A_AC_SITTG  (21,39) edit '9B'
     end-if
     if &A8.GPSG_AP8A_AC_ADDNL
        print 'X'                     (21,27)
        print &A8.GPSG_AP8A_AC_ADDNL  (21,41) edit '9B'
     end-if



      if &A8.GPSG_AP8A_AC_APF
        print 'X'                     (22,3)
        print &A8.GPSG_AP8A_AC_APF    (22,43) edit '9B'
     end-if


     Let $DRate  = edit(#ACUnit,'99.9B')
     Let $DRate1 = edit(#ACCentral,'99.9B')
     Let $DRate = $DRate || '/' || $DRate1

     Let $D2Rate  = edit(#ACSitting,'99.9B')
     Let $D2Rate1 = edit(#ACAddl,'99.9B')
     Let $D3Rate1= edit(#ACPurifier,'99.9B')
     Let $D2Rate = $D2Rate || '/' || $D2Rate1 || '/' || $D3Rate1


     print 'd. Air conditioner :'                                          (21,2)
     print $DRate                                                          (21,49)

     print '         Unit        Central-Dining        Sitting     Additional' (21,9)
     print '        Air Purifier'(22,2)
     print $D2Rate                                                         (22,49)

     print #TotalDVar                                                      (21,56) edit '9999999.9B'

     graphic (23,3,1)  box 1
     graphic (24,2,1)  box 1
     graphic (24,7,1) box 1
     graphic (24,14,1) box 1
     graphic (24,22,1) box 1
     if &A8.GPSG_AP8A_TV
        print 'X'                     (23,3)
        print &A8.GPSG_AP8A_TV        (23,33) edit '9B'
     end-if
     if &A8.GPSG_AP8A_RADIO
        print 'X'                     (24,2)
        print &A8.GPSG_AP8A_RADIO     (24,37) edit '9B'
     end-if
     !if &A8.GPSG_AP8A_AMP
      !  print 'X'                     (24,7)
       ! print &A8.GPSG_AP8A_AMP       (24,40) edit '9B'
     !end-if
     if &A8.GPSG_AP8A_GUITAR
        print 'X'                     (24,14)
        print &A8.GPSG_AP8A_GUITAR    (24,42) edit '9B'
     end-if


     if &A8.GPSG_AP8A_STEREO
        print 'X'                     (24,7)
        print &A8.GPSG_AP8A_STEREO    (24,40) edit '9B'
     end-if

     if &A8.GPSG_AP8A_SVS
        print 'X'                     (24,22)
        print &A8.GPSG_AP8A_SVS       (24,45) edit '9B'
     end-if

     print 'e.     TV/Home Entertainment Theatre/Plasma TV/High definition TV'                (23,2)
     print ' Radio'                      (24,3)
     print ' Hi-Fi Stereo'               (24,8)
     print ' Electric Guitar'            (24,15)
     print ' Surveillance system'        (24,23)

     print #TV                        (23,51) edit '99.9B'

     print #TotalEVar                 (23,56) edit '9999999.9B'

     !print ' Guitar'                 (24,28)

     graphic (25,3,1) box 1
     graphic (25,11,1) box 1

     if &A8.GPSG_AP8A_COMPUTER
        print 'X'                     (25,3)
        print &A8.GPSG_AP8A_COMPUTER  (25,34) edit '9B'
     end-if
     if &A8.GPSG_AP8A_ORGAN
        print 'X'                     (25,11)
        print &A8.GPSG_AP8A_ORGAN     (25,41) edit '9B'
     end-if
     print 'f.      Computer'         (25,2)
     print ' Organ'                   (25,12)

     print #Computer                  (25,51) edit '99.9B'

     print #TotalFVar                 (25,56) edit '9999999.9B'

     print 'g. Swimming Pool (exclude swimming pool in condominiums)'         (26,2)
     if &A8.GPSG_AP8A_POOL <> 0
        print &A8.GPSG_AP8A_POOL      (26,38) edit '9B'
     end-if
     print #Pool                      (26,51) edit '999.9B'
     print #TotalPool                 (26,56) edit '9999999.9B'

     graphic (27,3,1) box 1
     graphic (27,13,1) box 1
     graphic (27,22,1) box 1
     graphic (27,27,1) box 1

     graphic (28,3,1) box 1
     graphic (28,19,1) box 1
     graphic (28,27,1) box 1
     if &A8.GPSG_AP8A_PUB_UT
        print 'X'                     (27,3)
     end-if
     if &A8.GPSG_AP8A_PHONE
        print 'X'                     (27,13)
     end-if
     if &A8.GPSG_AP8A_PAGER
        print 'X'                     (27,22)
     end-if
     if &A8.GPSG_AP8A_SUITCASE
        print 'X'                     (27,27)
     end-if
     if &A8.GPSG_AP8A_GOLF_BAG
        print 'X'                     (28,3)
     end-if
     if &A8.GPSG_AP8A_CAMERA
        print 'X'                     (28,19)
     end-if
     if &A8.GPSG_AP8A_SERVANT
        print 'X'                     (28,27)
     end-if

     print #TotalHVar                 (27,56) edit '9999999.9B'

     print 'h.     Public Utilities'              (27,2)
     print ' Telephone'                           (27,14)
     print ' Pager'                               (27,23)
     print ' Suitcase'                            (27,28)
     print '        Golf Bag & Accessories'       (28,2)
     print ' Camera'                              (28,20)
     print ' Servant'                             (28,28)

     print 'Actual amount'                        (27,40)
     print 'i. Driver'                            (29,2)
     print #TotalDriver                           (29,56) edit '9999999.9B'

     print '  Annual wages x (private/total mileage)' (29,34)
     print 'j. Gardener or Upkeep of Compound'        (30,2)
     print #TotalGardener                             (30,56) edit '9999999.9B'

     print ' $35.00 p.m. or actual wages, whichever is' (30,34)
     print ' lesser'                             (31,34)

     print 'k. Others'                           (32,2)
     print ' (See paragraph 15 of the Explanatory Notes)'     (32,6) BOLD
     print #TotalOthers                               (32,56) edit '9999999.9B'

     print ' # Value for (2a) to (2g) & (2k) = A (No. of units) x B (Rate p.m.) x 12 x No. of days' (33,1) BOLD
      
     Let $str =  ' / ' ||$DivYear || ' ('
     print $str  (33,39)  BOLD
     print 'To be apportioned to the no. of ' (33,42) BOLD
     print '  employees sharing the residence)' (34,1) BOLD

     graphic () font 4 8

     let #row = 36
     print '3. Value of Hotel Accommodation provided (Total of 3a to 3e):' (#row,1) BOLD
     graphic    (#row,63,7) horz-line
     if #Total3Block = 0
        print 'NA'                 (#row,67)
     else
        print #Total3Block         (#row,62) edit '999,999,999.9B'
     end-if

     add 1 to #row
     graphic                       (#row,1,62) box 8
     add -1 to #row
     graphic (#row,26,7) vert-line
     graphic (#row,35,7) vert-line
     graphic (#row,45,7) vert-line
     graphic (#row,54,8) vert-line
     add 3 to #row
     graphic (#row,29,1) vert-line
     graphic (#row,32,1) vert-line
     graphic (#row,48,1) vert-line
     graphic (#row,51,1) vert-line

     graphic (#row,1,62) horz-line
     add 1 to #row
     graphic (#row,1,62) horz-line
     add 1 to #row
     graphic (#row,1,62) horz-line
     add 1 to #row
     graphic (#row,1,62) horz-line
     add 1 to #row
     graphic (#row,1,62) horz-line
     add 1 to #row
     graphic (#row,1,62) horz-line

     add -7 to #row
     print 'A) No. of '                  (#row,28) !BOLD
     print 'B) Rate per '                (#row,37) !BOLD
     print 'C) Period '                  (#row,47) !BOLD
     print 'Value ($)'                   (#row,55) !BOLD

     add 1 to #row

     print 'Persons'                     (#row,28) !BOLD
     print ' Person p.m.'                (#row,37) !BOLD
     print ' provided '                  (#row,47) !BOLD
     print 'AxBx12xC/365'                (#row,55) !BOLD
     add 1 to #row
     print ' (No. of days)'              (#row,46) !BOLD
     print ' ($) '                       (#row,39) !BOLD

     add 1 to #row
     print 'a. Self'                     (#row,2)
     graphic                             (#row,5,1) box 1
     print 'Spouse'                      (#row,7)
     graphic                             (#row,11,1) box 1
     print 'Children > 20 years old'     (#row,13)
     graphic                             (#row,24,1) box 1

     if &A8.GPSG_AP8A_HTL_SLFN
       print 'X'                         (#row,5)
     end-if
     if &A8.GPSG_AP8A_HTL_SPSN
       print 'X'                         (#row,11)
     end-if
     if &A8.GPSG_AP8A_HTL_C20N
       print 'X'                         (#row,24)
     end-if

     print &A8.GPSG_AP8A_HTL_SLFN         (#row,26) edit '99B'
     print &A8.GPSG_AP8A_HTL_SPSN         (#row,29) edit '99B'
     print &A8.GPSG_AP8A_HTL_C20N         (#row,32) edit '99B'
     print #Abv20Yrs                      (#row,40) edit '99B'
     print &A8.GPSG_AP8A_HTL_SLFD         (#row,45) edit '999B'
     print &A8.GPSG_AP8A_HTL_SPSD         (#row,48) edit '999B'
     print &A8.GPSG_AP8A_HTL_C20D         (#row,51) edit '999B'
     print #HotelLine1                    (#row,53) edit '999,999,999.9B'

     add 1 to #row
     print 'b. Children < 3 yrs old'      (#row,2)
     print &A8.GPSG_AP8A_HTL_CH0N         (#row,29) edit '99B'
     print #Less3Yrs                      (#row,40) edit '99B'
     print &A8.GPSG_AP8A_HTL_CH0D         (#row,48) edit '999B'
     print #HotelLine4                    (#row,53) edit '999,999,999.9B'

     add 1 to #row
     print 'c. Children 3-7  yrs old'     (#row,2)
     print &A8.GPSG_AP8A_HTL_CH3N         (#row,29) edit '99B'
     print #Bet3_7Yrs                     (#row,40) edit '99B'
     print &A8.GPSG_AP8A_HTL_CH3D         (#row,48) edit '999B'
     print #HotelLine3                    (#row,53) edit '999,999,999.9B'

     add 1 to #row
     print 'd. Children 8- 20 yrs old'    (#row,2)
     print &A8.GPSG_AP8A_HTL_CH8N         (#row,29) edit '99B'
     print #Bet8_20Yrs                    (#row,40) edit '99B'
     print &A8.GPSG_AP8A_HTL_CH8D         (#row,48) edit '999B'
     print #HotelLine2                    (#row,53) edit '999,999,999.9B'

     add 1 to #row
     print 'e. Add: 2% x Basic Salary for period provided' (#row,2)

     if #HotelLine1 <> 0 or #HotelLine2 <> 0 or #HotelLine3 <> 0 or #HotelLine4 <> 0
        print #TwoPercentBasicSalary      (#row,53) edit '999,999,999.9B'
     end-if

     add 2 to #row
     print '4    Others' (#row,1) BOLD
     let $NoSelfPassages = edit(to_char(&A8.GPSG_AP8A_HL_SELF ),'99B')
     let $NoWifePassages = edit(to_char(&A8.GPSG_AP8A_HL_WIFE ),'99B')
     let $NoChildPassages = edit(to_char(&A8.GPSG_AP8A_HL_CHILD),'99B')

     let $OthersLine1 =
       'a    Cost of home leave passages and incidental benefits:                      No. of passages for self: ' || $NoSelfPassages
       || '                Spouse: ' || $NoWifePassages
       || '              Children: ' || $NoChildPassages

     add 1 to #row
     print $OthersLine1 (#row,1)
     if &A8.GPSG_AP8A_HOME_LVE = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_HOME_LVE    (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
      print '......'  (#row,3)

     add 1 to #row

     print '     (See paragraph 16 of the Explanatory Notes) ' (#row,2) BOLD
     add 1 to #row
     print '      Pioneer/export/pioneer service/OHQ Status was awarded or granted extension prior to 1 Jan 2004: '     (#row,1)
     !add 1 to #row
      print  'Yes'                            (#row,48) bold
      graphic                            (#row,51,1) box 1
     !graphic                            (#row,50,1) box 1
        print 'No'                         (#row,54) BOLD
     graphic                            (#row,57,1) box 1
     if &A8.GPSG_AP8A_HOME_LVE > 0
        if &CO.GPSG_OHQ_STATUS = 'Y'
           print 'X'                    (#row,51)
        else
           if &CO.GPSG_OHQ_STATUS = 'N'
              print 'X'                 (#row,57)
           end-if
        end-if
     end-if

     add 1 to #row
     print 'b    Interest payment made by the employer to a third party on behalf of an employee and/or interest benefits arising from loans' (#row,1)
     if &A8.GPSG_AP8A_ER_INT = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_ER_INT      (#row,62) edit '999,999,999.9B'
     end-if

     add 1 to #row
     print '       provided by employer interest free or at a rate below market rate to the employee who has substantial shareholding or control' (#row,1)
     add 1 to #row
     print '       or influence over the company:' (#row,1)

     add 1 to #row
     print 'c.   Life insurance premiums paid by the employer:' (#row,1)
     if &A8.GPSG_AP8A_LIFE_INS = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_LIFE_INS    (#row,62) edit '999,999,999.9B'
     end-if

     add 1 to #row
     print 'd.   Free or subsidised holidays including air passage, etc.:' (#row,1)
     if &A8.GPSG_AP8A_HOLIDAY = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_HOLIDAY     (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
     print 'e.   Educational expenses including tutor provided:' (#row,1)
     if &A8.GPSG_AP8A_EDUC = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_EDUC        (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
     print 'f.    Non-monetary awards for long service (for awards exceeding $200 in value):' (#row,1)
     if &A8.GPSG_AP8A_LS_AWARD = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_LS_AWARD    (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
     print 'g.   Entrance/transfer fees and annual subscription to social or recreational clubs:' (#row,1)
     if &A8.GPSG_AP8A_FEES = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_FEES        (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
     print 'h.   Gains from assets, e.g. vehicles, property, etc. sold to employees at a price lower than open market value:' (#row,1)
     if &A8.GPSG_AP8A_GAINS = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_GAINS       (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
     print 'i.    Full cost of motor vehicles given to employee:' (#row,1)
     if &A8.GPSG_AP8A_VEHICLE = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_VEHICLE     (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
     print 'j.    Car benefits'           (#row,1)
     print ' (See paragraph 17 of the Explanatory Notes)' (#row,8) Bold
     if &A8.GPSG_AP8A_CAR = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_CAR         (#row,62) edit '999,999,999.9B'
     end-if
     add 1 to #row
     print 'k.   Other non-monetary benefits which do not fall within the above items:' (#row,1)
     if &A8.GPSG_AP8A_OTHER = 0
        print 'NA'                      (#row,67)
     else
        print &A8.GPSG_AP8A_OTHER       (#row,62) edit '999,999,999.9B'
     end-if

     add 2 to #row
     !graphic                           (#row,1,63)  box 1 0 15
     graphic () font 5 10

     print '   TOTAL VALUE OF BENEFITS-IN-KIND (ITEMS 1 TO 4) TO BE REFLECTED IN ITEM d9 OF FORM IR8A' (#row,1) BOLD

     graphic    (#row,64,6) horz-line
     graphic () font 4 8
     print #TotalAppendix (#row,63) edit '99,999,999.9B'

     add 2 to #row
     print 'Name of Employer:    ' (#row,1)
     print $Co_Name               (#row,24) underline
     add 2 to #row
     print 'Address of Employer: ' (#row,1)

     print $Co_Address   (#row,24) underline
     add 2 to #row
     graphic    (#row,58,9) horz-line
     add 1 to #row
     print 'Name of authorised person making the declaration' (#row,1)
     print 'Designation'                            (#row, 24)
     print 'Tel. No.'                               (#row, 44)
     print 'Signature'                              (#row, 58)
     print 'Date'                                   (#row, 68)
     add -1 to #row
     print $Co_Tax_Contact                          (#row, 1)  underline
     print $Co_Designation                          (#row, 24) underline
     print $Co_Phone                                (#row, 44) underline
     print $Prn_Date_Created                        (#row, 68) underline

     let $FormId = 'IR8A(A/1/' || $NextYear || ')'
     add 2 to #row
     print $FormId                                  (#row, 1) Bold
     print 'There are penalties for failing to give a return or furnishing an incorrect or late return.' (#row, 15) bold

     Do Update-Employee-Rec
     Do Update-BIK-Value

     new-page

end-Procedure

!
!***********************************************************************
!  Procedure: Load-Bnft-Code-Rate                                      *
!             Load the Benefit Code and Rates into Variables           *
!***********************************************************************
begin-Procedure Load-Bnft-Code-Rate

BEGIN-SELECT
PAR.GPSG_BEN_TYP_U
PAR.GPSG_BEN_RATE &BnftRate
    Evaluate &PAR.GPSG_BEN_TYP_U
       when = '001'
              Let #Furniture    = &BnftRate
       when = '002'
              Let #Refrigerator = &BnftRate
       when = '003'
              Let #VCR          = &BnftRate
       when = '004'
              Let #WashMach     = &BnftRate
       when = '005'
              Let #Dryer        = &BnftRate
       when = '006'
              Let #DishWasher   = &BnftRate
       when = '007'
              Let #ACUnit       = &BnftRate
       when = '008'
              Let #ACCentral    = &BnftRate
       when = '009'
              Let #ACSitting    = &BnftRate
       when = '010'
              Let #ACAddl       = &BnftRate
       when = '012'
              Let #TV           = &BnftRate
       when = '013'
              Let #Radio        = &BnftRate
       when = '014'
              Let #Amp          = &BnftRate
       when = '015'
              Let #HiFi         = &BnftRate
       when = '016'
              Let #Guitar       = &BnftRate
       when = '017'
              Let #Computer     = &BnftRate
       when = '018'
              Let #Organ        = &BnftRate
       when = '019'
              Let #Pool         = &BnftRate
       when = '030'
              Let #Fan          = &BnftRate
       when = '031'
              Let #AirCooler    = &BnftRate
       when = '032'
              Let #Iron         = &BnftRate
       when = '033'
              Let #Toaster      = &BnftRate
       when = '035'
              Let #Vacuum       = &BnftRate
       when = '036'
              Let #Juicer       = &BnftRate
       when = '037'
              Let #Blender      = &BnftRate
       when = '038'
              Let #Kettle       = &BnftRate
       when = '039'
              Let #Cooker       = &BnftRate
       when = '040'
              Let #WaterHeater  = &BnftRate
       when = '041'
              Let #Oven         = &BnftRate
       when = '042'
              Let #Light        = &BnftRate
       when = '043'
              Let #FloorPolishr = &BnftRate
       when = '044'
              Let #Mower        = &BnftRate
       when = '056'
              Let #Abv20Yrs     = &BnftRate
       when = '057'
              Let #Bet8_20Yrs   = &BnftRate
       when = '058'
              Let #Bet3_7Yrs    = &BnftRate
       when = '059'
              Let #Less3Yrs     = &BnftRate

       when = '060'
              Let #ACPurifier    = &BnftRate

       when = '061'
              Let #SVSystem    = &BnftRate

    End-Evaluate

  FROM PS_GPSG_APP_RATE PAR
WHERE
  PAR.EFFDT = (SELECT MAX(PAR1.EFFDT) FROM PS_GPSG_APP_RATE PAR1
                 WHERE PAR1.GPSG_BEN_TYP_U = PAR.GPSG_BEN_TYP_U
                   AND PAR1.EFFDT         <= $YrEndSrch_Dt)
END-SELECT
end-Procedure
!
#Include 'reset.sqc'     !Reset printer procedure
#Include 'curdttim.sqc'  !Get-Current-DateTime procedure
#Include 'datetime.sqc'  !Routines for date and time formatting
#Include 'datemath.sqc'  !Routines for Date Arithmetic
#Include 'number.sqc'    !Routines to format numbers
#Include 'stdapi.sqc'    !Routines to Update Run Status
#Include 'gpsgirrc.sqc'  !Select-Parameters procedure
#Include 'gpsgir04.sqc'  !SQC For new format changes of App 8A released for YA2015





