!***********************************************************************
!                                                                      *
!  GPTHTX10.SQR      Global Payroll Thailand Tax Statement Program     *
!                                                                      *
!  Description:                                                        *
!                 This report generates the tax log.                   *
!                 The user has several options of generating           *
!                 a summary or detail report.                          *
!                                                                      *
!                                                                      *
!***********************************************************************
!                                                                      *
!                                                                      *
!                                                                      *
!                                                                      *
! This software and related documentation are provided under a         *
! license agreement containing restrictions on use and                 *
! disclosure and are protected by intellectual property                *
! laws. Except as expressly permitted in your license agreement        *
! or allowed by law, you may not use, copy, reproduce,                 *
! translate, broadcast, modify, license, transmit, distribute,         *
! exhibit, perform, publish or display any part, in any form or        *
! by any means. Reverse engineering, disassembly, or                   *
! decompilation of this software, unless required by law for           *
! interoperability, is prohibited.                                     *
! The information contained herein is subject to change without        *
! notice and is not warranted to be error-free. If you find any        *
! errors, please report them to us in writing.                         *
!                                                                      *
! Copyright (C) 1988, 2014, Oracle and/or its affiliates.              *
! All Rights Reserved.                                                 *
!***********************************************************************
!                                                                      *
!          $Date:  2014/04/25:09:51:48                                 !
!       $Release:  HR92                                                !
!      $Revision:  105                                                 !
!                                                                      *
!***********************************************************************

#include 'setenv.sqc'   !Set environment
#include 'number.sqc'   !Routines to format numbers
#include 'datetime.sqc' !Routines for date and time formatting
#include 'prcsapi.sqc'  !Replaces stdapi.sqc

#define ColR   155

begin-setup

declare-layout lay         ! Results in:

paper-size  = (a4)
orientation=landscape   
MAX-LINES=60
line-height=9         
char-width=4.32          
left-margin=.05
right-margin=.05
end-declare
declare-report HC

layout=lay

!printer-type=LINEPRINTER
end-declare
end-setup

begin-heading 4
alter-printer font-type = 'fixed' point-size = 10
print $GPTH_TAXLOG_TITLE (1,58) bold  
print $GPTH_TAXLOG_PAGE  (,138)
page-number             (,147) 
print '/'               (,150)
last-page               (,153) 
print $GPTH_TAXLOG_NAME (+1,5)
alter-printer font-type = 'fixed' point-size = 12
print $Name             (,15)
alter-printer font-type = 'fixed' point-size = 10
print $GPTH_TAXLOG_PSID (,50)
print $Emplid           (,60)
print $GPTH_TAXLOG_CALID (+1,5)
print $Cal_Run_ID       (,24)
print $GPTH_TAXLOG_EMPID (,50)
print $Emplid           (,64)
print $GPTH_TAXLOG_PG   (+1,5)
print &PRC.GP_PAYGROUP  (,20)
print $GPTH_TAXLOG_RID  (,50)
print $GPTH_TAXLOG_RNAME (,68)

print $SAL_REG_PRO_SEG     (2,85)      
print #SAL_REG_PRO_SEG     (2,105)      edit '999,999,999.99'
print $SAL_REG_TAL_PTD     (3,85)      
print #HD_SAL_REG_TAL_PTD  (3,105)      edit '999,999,999.99'

print $GPTH_REMAIN_PRD     (4,85)      
print #GPTH_REMAIN_PRD     (4,105)      edit '999,999,999.99'
print $SAL_REG_PRO_SEG_402 (2, 128)
print #SAL_REG_PRO_SEG_402 (2, 157)
print $SAL_REG_TAL_PTD_402 (3, 128)
print #SAL_REG_TAL_PTD_402 (3, 157)
print $GPTH_CAL_CATEGORY   (4, 128)
print $GPTH_CAL_C_CATEGORY (4, 157)
print $GPTH_TAXLOG_DATE    (5,5)
print $current-date     (5,20)   edit 'DD/MM/YYYY'
print $GPTH_TAXLOG_TIME (5,50)
print $current-date     (5,68)   edit 'hh:mm:ss'
print $GPTH_TAXLOG_USER (5,85)
print  $userid          (5,103)
        
alter-printer font-type = 'fixed' point-size = 8

end-heading

begin-program

        alter-printer font-type = 'fixed' point-size = 8
        use-report HC
        Do Stdapi-Init
        Do Init-Processing            
        Do Get-Parameters
        
        Do Read-Pye-Prc-Stat
        do Reset                        ! called from reset.sqc
        Do Stdapi-Term
end-program

!***********************************************************************
! Read-Pye-Prc-Stat
!***********************************************************************
begin-procedure Read-Pye-Prc-Stat
 
Begin-SELECT 
PRC.EMPLID                   
PRC.CAL_RUN_ID
PRC.EMPL_RCD
PRC.GP_PAYGROUP
PRC.CAL_ID
PRC.ORIG_CAL_RUN_ID
SEG.RSLT_SEG_NUM
PRC.RUN_TYPE  
            
      let $CalID         = rtrim(&PRC.CAL_ID,' ')
      let #length        = length($CalID)
      let $Emplid      = rtrim(&PRC.EMPLID,' ')
      let #Empl_Rcd    = &PRC.EMPL_RCD
                                                
      Do Get-Name
                        Do Print-Heading
                        let $userid = $PRCS_OPRID
      Do Process-PE
                        new-page        
                        
        FROM PS_GP_PYE_PRC_STAT PRC, PS_GP_PYE_SEG_STAT SEG
        WHERE PRC.CAL_RUN_ID = $Cal_Run_ID
        AND PRC.CAL_RUN_ID = SEG.CAL_RUN_ID
        AND PRC.EMPLID = SEG.EMPLID
        AND PRC.EMPL_RCD = SEG.EMPL_RCD
        AND PRC.GP_PAYGROUP = SEG.GP_PAYGROUP
        AND PRC.CAL_ID = SEG.CAL_ID
        AND PRC.ORIG_CAL_RUN_ID = SEG.ORIG_CAL_RUN_ID
        AND PRC.PRD_TYPE = 'C'
        AND PRC.CALC_TYPE='P'
        [$where]
End-SELECT

end-procedure ! Read-Pye-Prc-Stat

!
!***********************************************************************
! Init-Processing                                                      *
!***********************************************************************
begin-procedure Init-Processing
        do Init-Datetime        
        do Init-Number
        do Get-Current-Datetime
        do Init-Report
     
end-procedure ! Init-Processing
!
!***********************************************************************
! Init-Report                                                          *
!***********************************************************************
begin-procedure Init-Report

#define Col1   1
#define Col2   14
#define Col3   27
#define Col4   38
#define Col5   88
#define Col6   102
                
                do Get-Language-Codes  
    
    Let $ReportID = 'GPTHTX10'
                show 'Language_Cd' $Curr_Language_Cd
                show 'prcs_language_cd' $prcs_language_cd
                show 'prcs_oprid' $prcs_oprid
    do Init_Report_Translation ($ReportID, $curr_language_cd)
    
    do Get_Field_Information($ReportID,'GPTH_R_INC',$GPTH_R_INC                ,#DW)
    do Get_Field_Information($ReportID,'GPTH_R_INC_YTD',$GPTH_R_INC_YTD        ,#DW)
    do Get_Field_Information($ReportID,'GPTH_R_INC_ANU',$GPTH_R_INC_ANU        ,#DW)
    do Get_Field_Information($ReportID,'GPTH_IR_INC',$GPTH_IR_INC              ,#DW)
    do Get_Field_Information($ReportID,'GPTH_IR_INC_YTD',$GPTH_IR_INC_YTD      ,#DW)
    do Get_Field_Information($ReportID,'GPTH_IR_INC_ANU',$GPTH_IR_INC_ANU      ,#DW)
    do Get_Field_Information($ReportID,'TAX_VR_TOTAL_INC',$TAX_VR_TOTAL_INC    ,#DW)
    do Get_Field_Information($ReportID,'TAX_EXCEPT',$TAX_EXCEPT                ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_OE',$TAX_ALLOW_OE            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_XT',$TAX_ALLOW_XT            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_PE',$TAX_ALLOW_PE            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_SP',$TAX_ALLOW_SP            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_CH',$TAX_ALLOW_CH            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_CE',$TAX_ALLOW_CE            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_FA',$TAX_ALLOW_FA            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_MO',$TAX_ALLOW_MO            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_SF',$TAX_ALLOW_SF            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_SM',$TAX_ALLOW_SM            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_HI',$TAX_ALLOW_HI            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_PI',$TAX_ALLOW_PI            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_SI',$TAX_ALLOW_SI            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_PF',$TAX_ALLOW_PF            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_MF',$TAX_ALLOW_MF            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_EF',$TAX_ALLOW_EF            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_SS',$TAX_ALLOW_SS            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_MI',$TAX_ALLOW_MI            ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAL_ALLOW',$GPTH_TAL_ALLOW        ,#DW)
    do Get_Field_Information($ReportID,'TAX_VR_SPORT_AMT',$TAX_VR_SPORT_AMT    ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_ED',$TAX_ALLOW_ED            ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_PT',$TAX_ALLOW_PT            ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAXABLE_AMT',$GPTH_TAXABLE_AMT    ,#DW)
    do Get_Field_Information($ReportID,'TAX_ALLOW_DN',$TAX_ALLOW_DN            ,#DW)
    do Get_Field_Information($ReportID,'TAX_VR_TAXABLE_AMT',$TAX_VR_TAXABLE_AMT,#DW)
    do Get_Field_Information($ReportID,'TAX_VR_TOTAL_AMT',$TAX_VR_TOTAL_AMT    ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAL_R_TX_YTD',$GPTH_TAL_R_TX_YTD  ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAL_IR_TX_YTD',$GPTH_TAL_IR_TX_YTD,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAX_AMT',$GPTH_TAX_AMT            ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAX_R_PTD',$GPTH_TAX_R_PTD        ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAX_IR_PTD',$GPTH_TAX_IR_PTD      ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAX_IR_YTD',$GPTH_TAX_IR_YTD      ,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAX_EE_IR_YTD',$GPTH_TAX_EE_IR_YTD,#DW)
    do Get_Field_Information($ReportID,'GPTH_TAX_ER_IR_YTD',$GPTH_TAX_ER_IR_YTD,#DW)
    do Get_Field_Information($ReportID,'TAX_R_SEG_WH',$TAX_R_SEG_WH            ,#DW)
    do Get_Field_Information($ReportID,'TAX_R_SEG_GA',$TAX_R_SEG_GA            ,#DW)
    do Get_Field_Information($ReportID,'TAX_R_SEG_GO',$TAX_R_SEG_GO            ,#DW)
    do Get_Field_Information($ReportID,'TAX_IR_SEG_WH',$TAX_IR_SEG_WH          ,#DW)
    do Get_Field_Information($ReportID,'TAX_IR_SEG_GA',$TAX_IR_SEG_GA          ,#DW)
    do Get_Field_Information($ReportID,'TAX_IR_SEG_GO',$TAX_IR_SEG_GO          ,#DW)
    do Get_Field_Information($ReportID,'TAX_WH_DED',$TAX_WH_DED                ,#DW)
    do Get_Field_Information($ReportID,'TAX_GA_DED',$TAX_GA_DED                ,#DW)
    do Get_Field_Information($ReportID,'TAX_GO_DED',$TAX_GO_DED                ,#DW)
    do Get_Field_Information($ReportID,'TAX_OVR_YTD_WH',$TAX_OVR_YTD_WH        ,#DW)
    do Get_Field_Information($ReportID,'TAX_OVR_YTD_GA',$TAX_OVR_YTD_GA        ,#DW)
    do Get_Field_Information($ReportID,'TAX_OVR_YTD_GO',$TAX_OVR_YTD_GO        ,#DW)
    do Get_Field_Information ($ReportID, 'REGULAR',$Regular,#DW)
    do Get_Field_Information ($ReportID, 'IRREGULAR',$Irregular,#DW)
    do Get_Field_Information ($ReportID, 'WITHHOLDING',$Witholding,#DW)
    do Get_Field_Information ($ReportID, 'GROSSUP1',$Gross_Up1,#DW)
    do Get_Field_Information ($ReportID, 'GROSSUPALL',$Gross_Up_All,#DW)
    
    do Get_Field_Information ($ReportID, 'SAL_REG_PRO_SEG',$SAL_REG_PRO_SEG,#DW)
    do Get_Field_Information ($ReportID, 'SAL_REG_TAL_PTD',$SAL_REG_TAL_PTD,#DW)
    do Get_Field_Information ($ReportID, 'SAL_REG_PRO_SEG_42',$SAL_REG_PRO_SEG_402,#DW)
    do Get_Field_Information ($ReportID, 'SAL_REG_TAL_PTD_42',$SAL_REG_TAL_PTD_402,#DW)
    do Get_Field_Information ($ReportID, 'T_GPTH_INC_SECTION',$T_GPTH_INC_SECTION,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_R_402_WH', $GPTH_TAX_R_402_WH,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_R_402_GA', $GPTH_TAX_R_402_GA,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_R_402_GO', $GPTH_TAX_R_402_GO,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_IR_402_WH',$GPTH_TAX_IR_402_WH,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_IR_402_GA',$GPTH_TAX_IR_402_GA,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_IR_402_GO',$GPTH_TAX_IR_402_GO,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_DD_402WH', $GPTH_TAX_DD_402WH,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_DD_402GA', $GPTH_TAX_DD_402GA,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_DD_402GO', $GPTH_TAX_DD_402GO,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_OVT_402WH',$GPTH_TAX_OVT_402WH,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_OVT_402GA',$GPTH_TAX_OVT_402GA,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAX_OVT_402GO',$GPTH_TAX_OVT_402GO,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_REMAIN_PRD',$GPTH_REMAIN_PRD,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_CAL_CATEGORY',$GPTH_CAL_CATEGORY,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_TITLE', $GPTH_TAXLOG_TITLE      ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_PAGE', $GPTH_TAXLOG_PAGE        ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_NAME', $GPTH_TAXLOG_NAME        ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_PSID', $GPTH_TAXLOG_PSID        ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_CALID', $GPTH_TAXLOG_CALID      ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_EMPID', $GPTH_TAXLOG_EMPID      ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_PG', $GPTH_TAXLOG_PG            ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_RID', $GPTH_TAXLOG_RID          ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_RNAME', $GPTH_TAXLOG_RNAME      ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_DATE', $GPTH_TAXLOG_DATE        ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_TIME', $GPTH_TAXLOG_TIME        ,#DW)
    do Get_Field_Information ($ReportID, 'GPTH_TAXLOG_USER', $GPTH_TAXLOG_USER        ,#DW)
    do Get_Field_Information ($ReportID, 'TAX_ALLOW_PP', $TAX_ALLOW_PP        ,#DW)
    do Get_Field_Information ($ReportID, 'TAX_ALLOW_PS', $TAX_ALLOW_PS        ,#DW)
    do Get_Field_Information ($ReportID, 'TAX_ALLOW_HP', $TAX_ALLOW_HP        ,#DW)
    do Get_Field_Information ($ReportID, 'TAX_ALLOW_DS', $TAX_ALLOW_DS        ,#DW)
    
    do Get_Field_Information ($ReportID, 'TAX_ALLOW_IP', $TAX_ALLOW_IP        ,#DW)
    do Get_Field_Information ($ReportID, 'TAX_ALLOW_TR', $TAX_ALLOW_TR        ,#DW)

    do Get_Field_Information ($ReportID, 'TAX_ALLOW_OT', $TAX_ALLOW_OT        ,#DW) ! add from 2012
end-procedure ! Init-Report


!***********************************************************************
! Print-Heading                                                                                                                                                                                                  *
!***********************************************************************
begin-Procedure Print-Heading

  Let #row = 3
  Let #Col1 = 3
  
  print $T_GPTH_INC_SECTION (5, #Col1)
  print $GPTH_R_INC         (+1,#Col1)
  print $GPTH_R_INC_YTD     (+1,#Col1)
  print $GPTH_R_INC_ANU     (+1,#Col1)
  print $GPTH_IR_INC        (+1,#Col1)
  print $GPTH_IR_INC_YTD    (+1,#Col1)
  print $GPTH_IR_INC_ANU    (+1,#Col1)
  print $TAX_VR_TOTAL_INC   (+1,#Col1)
  print $TAX_EXCEPT         (+1,#Col1)
  print $TAX_ALLOW_OE       (+1,#Col1)
  
  print $TAX_ALLOW_XT       (+1,#Col1)
  print $TAX_ALLOW_PE       (+1,#Col1)
  print $TAX_ALLOW_SP       (+1,#Col1)
  print $TAX_ALLOW_CH       (+1,#Col1)
  print $TAX_ALLOW_CE       (+1,#Col1)
  print $TAX_ALLOW_FA       (+1,#Col1)
  print $TAX_ALLOW_MO       (+1,#Col1)
  print $TAX_ALLOW_SF       (+1,#Col1)
  print $TAX_ALLOW_SM       (+1,#Col1)
  print $TAX_ALLOW_DS       (+1,#Col1)
  print $TAX_ALLOW_HI       (+1,#Col1)
  print $TAX_ALLOW_PI       (+1,#Col1)
  print $TAX_ALLOW_SI       (+1,#Col1)
  print $TAX_ALLOW_IP       (+1,#Col1)  ! add this Item from 2010
  print $TAX_ALLOW_PF       (+1,#Col1)
  print $TAX_ALLOW_MF       (+1,#Col1)
  print $TAX_ALLOW_EF       (+1,#Col1)
  print $TAX_ALLOW_HP       (+1,#Col1)
  print $TAX_ALLOW_TR       (+1,#Col1)  ! add this Item from 2010
  print $TAX_ALLOW_SS       (+1,#Col1)
  print $TAX_ALLOW_MI       (+1,#Col1)
  print $GPTH_TAL_ALLOW     (+1,#Col1)
  print $TAX_VR_SPORT_AMT   (+1,#Col1)
  print $TAX_ALLOW_ED       (+1,#Col1)
  print $TAX_ALLOW_PT       (+1,#Col1)
  print $TAX_ALLOW_OT       (+1,#Col1)  ! add this Item from 2012
  print $GPTH_TAXABLE_AMT   (+1,#Col1)
  print $TAX_ALLOW_DN       (+1,#Col1)
  print $TAX_VR_TAXABLE_AMT (+1,#Col1)
  print $TAX_VR_TOTAL_AMT   (+1,#Col1)
  print $GPTH_TAL_R_TX_YTD  (+1,#Col1)
  print $GPTH_TAL_IR_TX_YTD (+1,#Col1)
  print $GPTH_TAX_AMT       (+1,#Col1)
  print $GPTH_TAX_R_PTD     (+1,#Col1)
  print $GPTH_TAX_IR_PTD    (+1,#Col1)
  print $GPTH_TAX_IR_YTD    (+1,#Col1)
  print $GPTH_TAX_EE_IR_YTD (+1,#Col1)
  print $GPTH_TAX_ER_IR_YTD (+1,#Col1)
    
End-Procedure !Print-Heading
        
begin-Procedure Print-Heading1
        Let #Col1 = 3
  print $TAX_R_SEG_WH   (5,#Col1)  bold
  print $TAX_R_SEG_GA   (+1,#Col1) bold
  print $TAX_R_SEG_GO   (+1,#Col1) bold
  print $TAX_IR_SEG_WH  (+1,#Col1) bold
  print $TAX_IR_SEG_GA  (+1,#Col1) bold
  print $TAX_IR_SEG_GO  (+1,#Col1) bold
  print $TAX_WH_DED     (+1,#Col1) bold
  print $TAX_GA_DED     (+1,#Col1) bold
  print $TAX_GO_DED     (+1,#Col1) bold
  print $TAX_OVR_YTD_WH (+1,#Col1) bold
  print $TAX_OVR_YTD_GA (+1,#Col1) bold
  print $TAX_OVR_YTD_GO (+1,#Col1) bold
  print $GPTH_TAX_R_402_WH  (+1,#Col1) bold
  print $GPTH_TAX_R_402_GA  (+1,#Col1) bold
  print $GPTH_TAX_R_402_GO  (+1,#Col1) bold
  print $GPTH_TAX_IR_402_WH (+1,#Col1) bold
  print $GPTH_TAX_IR_402_GA (+1,#Col1) bold
  print $GPTH_TAX_IR_402_GO (+1,#Col1) bold
  print $GPTH_TAX_DD_402WH  (+1,#Col1) bold
  print $GPTH_TAX_DD_402GA  (+1,#Col1) bold
  print $GPTH_TAX_DD_402GO  (+1,#Col1) bold
  print $GPTH_TAX_OVT_402WH (+1,#Col1) bold
  print $GPTH_TAX_OVT_402GA (+1,#Col1) bold
  print $GPTH_TAX_OVT_402GO (+1,#Col1) bold
        
End-Procedure !Print-Heading1

!***********************************************************************
! Get-Parameters                                                       *
!***********************************************************************
begin-procedure Get-Parameters
        
Begin-SELECT    
RC.CAL_RUN_ID
RC.EMPLID
        
             Let $Cal_Run_ID = rtrim(&RC.CAL_RUN_ID,' ')
             let $Emplid  = rtrim(&RC.EMPLID,' ')
             show 'emplid' $Emplid
             
          FROM PS_GPTH_RC_TAX_LOG RC
          WHERE RC.OPRID = $PRCS_OPRID
            AND RC.RUN_CNTL_ID = $PRCS_RUN_CNTL_ID
End-SELECT
        
        let $where = 'AND 1 = 1'
        if (rtrim($Emplid, ' ') <> '')
              let $where = $where || ' AND PRC.EMPLID =' || '''' || $Emplid || ''''
        end-if
end-procedure ! Get-Parameters

!***********************************************************************
! Get-Name                                                                                                                                                                                                                       *
!***********************************************************************
Begin-Procedure Get-Name
Begin-SELECT    
A.NAME
     
     Let $Name = &A.NAME
     
  FROM PS_NAMES A
  WHERE A.EMPLID = &PRC.EMPLID
    AND A.NAME_TYPE = 'PRI'
End-SELECT
        
Begin-Select
PER.NAME_AC
             Let $SCGID = rtrim(&PER.NAME_AC,' ')
                FROM PS_PERSON_NAME PER
                WHERE PER.EMPLID = &PRC.EMPLID
                AND PER.NAME_TYPE = 'PRI'
End-Select
End-Procedure !Get-Name
  
!***********************************************************************
! Process-PE                                                           *
!***********************************************************************
begin-procedure Process-PE
  
  Let #col = 33
  Let #counter = 0
  Let #zero = 0

Do Get-G-PE     
          
BEGIN-SELECT 
A.EMPLID                                       
A.CAL_RUN_ID                                   
A.EMPL_RCD                                     
A.GP_PAYGROUP                                  
A.CAL_ID                                       
A.ORIG_CAL_RUN_ID                              
A.RSLT_SEG_NUM                                 
A.GPTH_TAX_VR_LOG_PS                             
A.GPTH_TAX_VR_IR_SEQ                                
A.GPTH_TAX_VR_CAL_MD                            
A.GPTH_TAX_VR_CYCLE                                 
A.GPTH_TAX_VR_LOG_YE                           
A.GPTH_SAL_R_TAL_PTD                              
A.GPTH_SAL_R_TAL_YTD                              
A.GPTH_TAX_VR_T_INC                             
A.GPTH_TAX_EXCEPT
A.GPTH_TAX_ALLOW_OE                                  
A.GPTH_TAX_ALLOW_XT                                 
A.GPTH_TAX_ALLOW_PE                                 
A.GPTH_TAX_ALLOW_SP                                 
A.GPTH_TAX_ALLOW_CH                                 
A.GPTH_TAX_ALLOW_CE                                 
A.GPTH_TAX_ALLOW_FA                                 
A.GPTH_TAX_ALLOW_MO                                 
A.GPTH_TAX_ALLOW_SF                                 
A.GPTH_TAX_ALLOW_SM                                 
A.GPTH_TAX_ALLOW_HI                                 
A.GPTH_TAX_ALLOW_PI                                 
A.GPTH_TAX_ALLOW_SI                                 
A.GPTH_TAX_ALLOW_IP  
A.GPTH_TAX_ALLOW_PF                                 
A.GPTH_TAX_ALLOW_MF                                 
A.GPTH_TAX_ALLOW_EF                                 
A.GPTH_TAX_ALLOW_SS                                 
A.GPTH_TAX_ALLOW_MI                                 
A.GPTH_TAX_VR_SPORT                             
A.GPTH_TAX_ALLOW_ED                                 
A.GPTH_TAX_ALLOW_PT                                 
A.GPTH_TAX_ALLOW_DN                                 
A.GPTH_TAX_VR_TAXABL                           
A.GPTH_TAX_VR_TOTAL                             
A.GPTH_TAX_R_TAL_PTD                              
A.GPTH_TAX_R_TAL_YTD                              
A.GPTH_TAX_VR_C_TTPY                                
A.GPTH_TAX_VR_C_TTPP  
A.GPTH_TAX_VR_L_TTPP                              
A.GPTH_TAX_VR_C_TAX                               
A.GPTH_TAX_IR_YTD                                   
A.GPTH_TAX_IR_EE_YTD                                
A.GPTH_TAX_IR_ER_YTD                                
A.GPTH_TAX_IR_T_YTD                               
A.GPTH_TAX_VR_R_AMT                               
A.GPTH_TAX_VR_C_IR                                  
A.GPTH_SAL_IR_SEG                                   
A.GPTH_SAL_IR_YTD
A.GPTH_INC_SECTION
A.GPTH_TAX_XMPT_402
A.GPTH_TAX_VR_CAL_CA
A.GPTH_SAL_REG_A_YTD
A.GPTH_TAX_VR_ER_E
A.GPTH_OFF_CYCLE
A.GPTH_TAX_VR_EE_E
A.GPTH_TAX_REG_A_SEG
A.GPTH_TAX_REG_A_YTD
A.GPTH_TAX_IR_A_YTD
A.GPTH_TAX_ALLOW_DS
A.GPTH_TAX_ALLOW_PS
A.GPTH_TAX_ALLOW_PP
A.GPTH_TAX_ALLOW_HP
A.GPTH_TAX_ALLOW_TR
A.GPTH_TAX_ALLOW_OT    ! add this Item from 2012

                  let #GPTH_TAX_IR_A_YTD = &A.GPTH_TAX_IR_A_YTD
                  let #GPTH_TAX_REG_A_YTD = &A.GPTH_TAX_REG_A_YTD
                  let #GPTH_TAX_REG_A_SEG = &A.GPTH_TAX_REG_A_SEG
                  let #GPTH_TAX_VR_EE_E   = &A.GPTH_TAX_VR_EE_E
                  let #GPTH_TAX_VR_ER_E   = &A.GPTH_TAX_VR_ER_E
                  let #GPTH_SAL_REG_A_YTD = &A.GPTH_SAL_REG_A_YTD
                  let $GPTH_INC_SECTION   = &A.GPTH_INC_SECTION
                  let #GPTH_TAX_XMPT_402  = &A.GPTH_TAX_XMPT_402
                     
                  let $EMPLID             =&A.EMPLID                                       
                  let $CAL_RUN_ID         =&A.CAL_RUN_ID                                   
                  let #EMPL_RCD           =&A.EMPL_RCD                                     
                  let $GP_PAYGROUP        =&A.GP_PAYGROUP                                  
                  let $CAL_ID             =&A.CAL_ID                                       
                  let $ORIG_CAL_RUN_ID    =&A.ORIG_CAL_RUN_ID                              
                  let #RSLT_SEG_NUM       =&A.RSLT_SEG_NUM                                 
                  
                  let $TAX_VR_LOG_PHASE   =rtrim(&A.GPTH_TAX_VR_LOG_PS, ' ')                             
                  let #TAX_VR_IR_SEQ      =&A.GPTH_TAX_VR_IR_SEQ                                
                  let $TAX_VR_CAL_METHOD  =rtrim(&A.GPTH_TAX_VR_CAL_MD, ' ')  
                  let #TAX_VR_CYCLE       =&A.GPTH_TAX_VR_CYCLE
                  let #TAX_VR_CYCLE1      =#TAX_VR_CYCLE -1                             
                  let $TAX_VR_LOG_YEA_END =&A.GPTH_TAX_VR_LOG_YE  
                                
                  if &A.GPTH_INC_SECTION = '401'
                     let #SAL_REG_TAL_PTD = &A.GPTH_SAL_R_TAL_PTD
                     let #SAL_REG_TAL_YTD = &A.GPTH_SAL_R_TAL_YTD
                  else
                     if &A.GPTH_SAL_R_TAL_PTD = 0
                        !if reg 40(2) is equal to zero, it should be same with 40(1) regular income
                        let #SAL_REG_TAL_PTD = #SAL_REG_TAL_PTD
                     else
                        let #SAL_REG_TAL_PTD = &A.GPTH_SAL_R_TAL_PTD
                     end-if
                     let #SAL_REG_TAL_YTD = #SAL_REG_TAL_YTD + &A.GPTH_SAL_R_TAL_YTD
                  end-if
                  
                                                
                  let #TAX_VR_TOTAL_INC   =&A.GPTH_TAX_VR_T_INC                             
                  let #TAX_EXCEPT         =&A.GPTH_TAX_EXCEPT 
                  let #TAX_ALLOW_OE       =&A.GPTH_TAX_ALLOW_OE                                  
                  let #TAX_ALLOW_XT       =&A.GPTH_TAX_ALLOW_XT                                 
                  let #TAX_ALLOW_PE       =&A.GPTH_TAX_ALLOW_PE                                 
                  let #TAX_ALLOW_SP       =&A.GPTH_TAX_ALLOW_SP                                 
                  let #TAX_ALLOW_CH       =&A.GPTH_TAX_ALLOW_CH                                 
                  let #TAX_ALLOW_CE       =&A.GPTH_TAX_ALLOW_CE                                 
                  let #TAX_ALLOW_FA       =&A.GPTH_TAX_ALLOW_FA                                 
                  let #TAX_ALLOW_MO       =&A.GPTH_TAX_ALLOW_MO                                 
                  let #TAX_ALLOW_SF       =&A.GPTH_TAX_ALLOW_SF                                 
                  let #TAX_ALLOW_SM       =&A.GPTH_TAX_ALLOW_SM                                 
                  let #TAX_ALLOW_HI       =&A.GPTH_TAX_ALLOW_HI                                 
                  let #TAX_ALLOW_PI       =&A.GPTH_TAX_ALLOW_PI                                 
                  let #TAX_ALLOW_SI       =&A.GPTH_TAX_ALLOW_SI                                 
                  let #TAX_ALLOW_IP       =&A.GPTH_TAX_ALLOW_IP           
                  let #TAX_ALLOW_PF       =&A.GPTH_TAX_ALLOW_PF                                 
                  let #TAX_ALLOW_MF       =&A.GPTH_TAX_ALLOW_MF                                 
                  let #TAX_ALLOW_EF       =&A.GPTH_TAX_ALLOW_EF                                 
                  let #TAX_ALLOW_SS       =&A.GPTH_TAX_ALLOW_SS                                 
                  let #TAX_ALLOW_MI       =&A.GPTH_TAX_ALLOW_MI                                 
                  let #TAX_VR_SPORT_AMT   =&A.GPTH_TAX_VR_SPORT                             
                  let #TAX_ALLOW_ED       =&A.GPTH_TAX_ALLOW_ED                                 
                  let #TAX_ALLOW_PT       =&A.GPTH_TAX_ALLOW_PT                                 
                  let #TAX_ALLOW_DN       =&A.GPTH_TAX_ALLOW_DN                                 
                  let #TAX_VR_TAXABLE_AMT =&A.GPTH_TAX_VR_TAXABL                           
                  let #TAX_VR_TOTAL_AMT   =&A.GPTH_TAX_VR_TOTAL                             
                  let #TAX_REG_TAL_PTD    =&A.GPTH_TAX_R_TAL_PTD                              
                  let #TAX_REG_TAL_YTD    =&A.GPTH_TAX_R_TAL_YTD                              
                  let #TAX_VR_C_TTPY      =&A.GPTH_TAX_VR_C_TTPY                                
                  let #TAX_VR_C_TTPP      =&A.GPTH_TAX_VR_C_TTPP    
                  if &A.GPTH_TAX_VR_L_TTPP >= 0
                        let #TAX_VR_L_TTPP      =&A.GPTH_TAX_VR_L_TTPP                          
                  else
                        let #TAX_VR_L_TTPP      =0
                  end-if
                  let #TAX_VR_CUR_TAX     =&A.GPTH_TAX_VR_C_TAX                               
                  let #TAX_IR_YTD         =&A.GPTH_TAX_IR_YTD                                   
                  let #TAX_IR_EE_YTD      =&A.GPTH_TAX_IR_EE_YTD                                
                  let #TAX_IR_ER_YTD      =&A.GPTH_TAX_IR_ER_YTD                                
                  let #TAX_IR_TAL_YTD     =&A.GPTH_TAX_IR_T_YTD                               
                  let #TAX_VR_REG_AMT     =&A.GPTH_TAX_VR_R_AMT                               
                  let #TAX_VR_C_IR        =&A.GPTH_TAX_VR_C_IR                                  
                  let #SAL_IR_SEG         =&A.GPTH_SAL_IR_SEG                                   
                  let #SAL_IR_YTD         =&A.GPTH_SAL_IR_YTD                                   
                  let $GPTH_TAX_VR_CAL_CA = rtrim(&A.GPTH_TAX_VR_CAL_CA,' ')
                  let #TAX_ALLOW_DS       =&A.GPTH_TAX_ALLOW_DS
                  let #TAX_ALLOW_PS       =&A.GPTH_TAX_ALLOW_PS
                  let #TAX_ALLOW_PP       =&A.GPTH_TAX_ALLOW_PP
                  let #TAX_ALLOW_HP       =&A.GPTH_TAX_ALLOW_HP
                  let #TAX_ALLOW_TR       =&A.GPTH_TAX_ALLOW_TR
                  let #TAX_ALLOW_OT       =&A.GPTH_TAX_ALLOW_OT    ! add this Item from 2012
                        
                        Let #counter = #counter + 1
                        if #counter>5           
                                new-page        
                                Do Print-Heading                        
                                Let #counter = 0
                                Let #col = 33
                        end-if
                        
                        if $TAX_VR_LOG_PHASE = 'R'
                                if $TAX_VR_CAL_METHOD = 'WH'
                                        Let $Income_Type = $Regular
                                        Let $Type_Tax = $Witholding
                                        Let #Col = #Col + 20
                                        Do Print-Values
                                end-if
                                if $TAX_VR_CAL_METHOD = 'GO'
                                        Let $Income_Type = $Regular
                                        Let $Type_Tax = $Gross_Up1
                                        Let #Col = #Col + 20
                                        Do Print-Values
                                end-if
                                if $TAX_VR_CAL_METHOD = 'GA'
                                  Let $Income_Type = $Regular
                                        Let $Type_Tax = $Gross_Up_All
                                        Let #Col = #Col + 20
                                        Do Print-Values
                                end-if
                        end-if
                        if $TAX_VR_LOG_PHASE = 'I'
                                if $TAX_VR_CAL_METHOD = 'WH'
                                        Let $Income_Type = $Irregular
                                        Let $Type_Tax = $Witholding
                                        Let #Col = #Col + 20
                                        Do Print-Values
                                end-if
                                if $TAX_VR_CAL_METHOD = 'GO'
                                        Let $Income_Type = $Irregular
                                        Let $Type_Tax = $Gross_Up1
                                        Let #Col = #Col + 20
                                        Do Print-Values
                                end-if
                                if $TAX_VR_CAL_METHOD = 'GA'
                                        Let $Income_Type = $Irregular
                                        Let $Type_Tax = $Gross_Up_All
                                        Let #Col = #Col + 20
                                        Do Print-Values
                                end-if
                        end-if                                  
                        
                FROM PS_GPTH_TAX_D_LOG A
                WHERE A.EMPLID=&PRC.EMPLID
                        AND A.CAL_RUN_ID=&PRC.CAL_RUN_ID
                        AND A.EMPL_RCD=&PRC.EMPL_RCD
                        AND A.GP_PAYGROUP=&PRC.GP_PAYGROUP
                        AND A.CAL_ID=&PRC.CAL_ID 
                        AND A.ORIG_CAL_RUN_ID=&PRC.ORIG_CAL_RUN_ID
                        AND A.RSLT_SEG_NUM = &SEG.RSLT_SEG_NUM
                !Sequence should be 40(1)reg,40(2)reg,40(1)irr,40(2)irr 
                ORDER BY EMPLID,GPTH_TAX_VR_LOG_PS DESC, GPTH_INC_SECTION, GPTH_TAX_VR_IR_SEQ,GPTH_TAX_VR_CYCLE
                
End-SELECT

Do Print-G-Values

End-Procedure ! Process-PE

Begin-procedure Get-G-PE

BEGIN-SELECT 
G.EMPLID                              
G.GPTH_TAX_R_SEG_WH                               
G.GPTH_TAX_R_SEG_GA                               
G.GPTH_TAX_R_SEG_GO                               
G.GPTH_TAX_IR_SEG_WH                              
G.GPTH_TAX_IR_SEG_GA                              
G.GPTH_TAX_IR_SEG_GO                              
G.GPTH_TAX_WH_DED                                 
G.GPTH_TAX_GA_DED                                 
G.GPTH_TAX_GO_DED                                 
G.GPTH_TAX_OV_YTD_WH                             
G.GPTH_TAX_OV_YTD_GA                             
G.GPTH_TAX_OV_YTD_GO 
G.GPTH_SAL_R_PRO_SEG
G.GPTH_SAL_R_TAL_PTD
G.GPTH_REMAIN_PRD
G.GPTH_TAX_CAL_C_CAT  
G.GPTH_INC_SECTION
G.GPTH_TAX_R_402_WH
G.GPTH_TAX_R_402_GA
G.GPTH_TAX_R_402_GO
G.GPTH_TAX_IR_402_WH
G.GPTH_TAX_IR_402_GA
G.GPTH_TAX_IR_402_GO
G.GPTH_TAX_DD_402WH
G.GPTH_TAX_DD_402GA
G.GPTH_TAX_DD_402GO
G.GPTH_TAX_OVT_402WH
G.GPTH_TAX_OVT_402GA
G.GPTH_TAX_OVT_402GO
G.GPTH_OFF_CYCLE
                                let  #TAX_R_SEG_WH   = round(&G.GPTH_TAX_R_SEG_WH,2)  
                                let  #TAX_R_SEG_GA   = round(&G.GPTH_TAX_R_SEG_GA,2)  
                                let  #TAX_R_SEG_GO   = round(&G.GPTH_TAX_R_SEG_GO,2)  
                                let  #TAX_IR_SEG_WH  = round(&G.GPTH_TAX_IR_SEG_WH,2) 
                                let  #TAX_IR_SEG_GA  = round(&G.GPTH_TAX_IR_SEG_GA,2) 
                                let  #TAX_IR_SEG_GO  = round(&G.GPTH_TAX_IR_SEG_GO,2) 
                                let  #TAX_WH_DED     = round(&G.GPTH_TAX_WH_DED,2)    
                                let  #TAX_GA_DED     = round(&G.GPTH_TAX_GA_DED,2)    
                                let  #TAX_GO_DED     = round(&G.GPTH_TAX_GO_DED,2)    
                                let  #TAX_OVR_YTD_WH = round(&G.GPTH_TAX_OV_YTD_WH,2)
                                let  #TAX_OVR_YTD_GA = round(&G.GPTH_TAX_OV_YTD_GA,2)
                                let  #TAX_OVR_YTD_GO = round(&G.GPTH_TAX_OV_YTD_GO,2) 
                                if &G.GPTH_INC_SECTION = '401'
                                  let  #SAL_REG_PRO_SEG     = round(&G.GPTH_SAL_R_PRO_SEG,2)
                                  if &G.GPTH_OFF_CYCLE = 'N'
                                     let  #HD_SAL_REG_TAL_PTD  = round(&G.GPTH_SAL_R_TAL_PTD,2)
                                  else
                                     let  #HD_SAL_REG_TAL_PTD  = 0
                                  end-if
                                else
                                  let  #SAL_REG_PRO_SEG_402 = round(&G.GPTH_SAL_R_PRO_SEG,2)
                                  if &G.GPTH_OFF_CYCLE = 'N'
                                     let  #SAL_REG_TAL_PTD_402 = round(&G.GPTH_SAL_R_TAL_PTD,2)
                                  else
                                     let  #SAL_REG_TAL_PTD_402 = 0
                                  end-if
                                end-if
                                
                                let #GPTH_TAX_R_402_WH  = round(&G.GPTH_TAX_R_402_WH,2)
                                let #GPTH_TAX_R_402_GA  = round(&G.GPTH_TAX_R_402_GA,2)
                                let #GPTH_TAX_R_402_GO  = round(&G.GPTH_TAX_R_402_GO,2)
                                let #GPTH_TAX_IR_402_WH = round(&G.GPTH_TAX_IR_402_WH,2)
                                let #GPTH_TAX_IR_402_GA = round(&G.GPTH_TAX_IR_402_GA,2)
                                let #GPTH_TAX_IR_402_GO = round(&G.GPTH_TAX_IR_402_GO,2)
                                let #GPTH_TAX_DD_402WH  = round(&G.GPTH_TAX_DD_402WH,2)
                                let #GPTH_TAX_DD_402GA  = round(&G.GPTH_TAX_DD_402GA,2)
                                let #GPTH_TAX_DD_402GO  = round(&G.GPTH_TAX_DD_402GO,2)
                                let #GPTH_TAX_OVT_402WH = round(&G.GPTH_TAX_OVT_402WH,2)
                                let #GPTH_TAX_OVT_402GA = round(&G.GPTH_TAX_OVT_402GA,2)
                                let #GPTH_TAX_OVT_402GO = round(&G.GPTH_TAX_OVT_402GO,2)
                                let  #GPTH_REMAIN_PRD= &G.GPTH_REMAIN_PRD
                                let  $GPTH_CAL_C_CATEGORY = rtrim(&G.GPTH_TAX_CAL_C_CAT,' ')

                FROM PS_GPTH_TAX_G_LOG G
                WHERE G.EMPLID=&PRC.EMPLID
                        AND G.CAL_RUN_ID=&PRC.CAL_RUN_ID
                        AND G.EMPL_RCD=&PRC.EMPL_RCD
                        AND G.GP_PAYGROUP=&PRC.GP_PAYGROUP
                        AND G.CAL_ID=&PRC.CAL_ID 
                        AND G.ORIG_CAL_RUN_ID=&PRC.ORIG_CAL_RUN_ID
                        AND G.RSLT_SEG_NUM = &SEG.RSLT_SEG_NUM
                ORDER BY EMPLID
END-SELECT      

End-Procedure ! Get-G-PE


!***********************************************************************
! Print-Foot-Values
!***********************************************************************
Begin-procedure Print-G-Values
        
        new-page
        Let #col=65     
        Do Print-Heading1
        print #TAX_R_SEG_WH                                           (5,#col)      edit '999,999,999.99'
        print #TAX_R_SEG_GA                                           (+1,#col)     edit '999,999,999.99'
        print #TAX_R_SEG_GO                                           (+1,#col)     edit '999,999,999.99'
        print #TAX_IR_SEG_WH                                          (+1,#col)     edit '999,999,999.99'
        print #TAX_IR_SEG_GA                                          (+1,#col)     edit '999,999,999.99'
        print #TAX_IR_SEG_GO                                          (+1,#col)     edit '999,999,999.99'
        print #TAX_WH_DED                                             (+1,#col)     edit '999,999,999.99'
        print #TAX_GA_DED                                             (+1,#col)     edit '999,999,999.99'
        print #TAX_GO_DED                                             (+1,#col)     edit '999,999,999.99'
        print #TAX_OVR_YTD_WH                                         (+1,#col)     edit '999,999,999.99'
        print #TAX_OVR_YTD_GA                                         (+1,#col)     edit '999,999,999.99'
        print #TAX_OVR_YTD_GO                                         (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_R_402_WH                                      (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_R_402_GA                                      (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_R_402_GO                                      (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_IR_402_WH                                     (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_IR_402_GA                                     (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_IR_402_GO                                     (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_DD_402WH                                      (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_DD_402GA                                      (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_DD_402GO                                      (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_OVT_402WH                                     (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_OVT_402GA                                     (+1,#col)     edit '999,999,999.99'
        print #GPTH_TAX_OVT_402GO                                     (+1,#col)     edit '999,999,999.99'
        
End-Procedure ! Print-G-Values

!***********************************************************************
! Print-Values
!***********************************************************************
Begin-procedure Print-Values
        Let #row1 = 2
  Let #Col_Heading = #Col + 4
        Let #Col_Heading1=#Col_Heading+2
  print $Income_Type            (#row1,#Col_Heading) 
  print $Type_Tax                               (+1,#Col_Heading)  
  print #TAX_VR_CYCLE1  (+1,#Col_Heading1)               edit 999,99
  
  if $TAX_VR_LOG_PHASE = 'R' 
     if $GPTH_TAX_VR_CAL_CA = 'ACM'
           if &A.GPTH_INC_SECTION = '401'
              !let #GPTH_R_INC=#TAX_VR_TOTAL_INC - #SAL_REG_TAL_YTD + #SAL_REG_TAL_PTD
              
              if &A.GPTH_OFF_CYCLE = 'N'
                 let #GPTH_R_INC_YTD=#SAL_REG_TAL_YTD - #SAL_REG_TAL_PTD
              else
                 let #GPTH_R_INC_YTD=#SAL_REG_TAL_YTD
              end-if
              
              let #GPTH_R_INC=#TAX_VR_TOTAL_INC - #GPTH_R_INC_YTD
              
           else
              !let #GPTH_R_INC=#TAX_VR_TOTAL_INC - #GPTH_SAL_REG_A_YTD + #SAL_REG_TAL_PTD
              
              if &A.GPTH_OFF_CYCLE = 'N'
                 let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD - #SAL_REG_TAL_PTD
              else
                 let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD + #GPTH_TAX_VR_ER_E
              end-if
              
              let #GPTH_R_INC=#TAX_VR_TOTAL_INC - #GPTH_R_INC_YTD
              
           end-if
           
           let #GPTH_R_INC_ANU=#TAX_VR_TOTAL_INC
           
     else
     !CAM: Regular Income = Regular Income Aunualized
           let #GPTH_R_INC=#TAX_VR_TOTAL_INC
           if &A.GPTH_INC_SECTION = '401'
              if &A.GPTH_OFF_CYCLE = 'N'
                 let #GPTH_R_INC_YTD=#SAL_REG_TAL_YTD - #SAL_REG_TAL_PTD
              else
                 let #GPTH_R_INC_YTD=#SAL_REG_TAL_YTD
              end-if
           else
              if &A.GPTH_OFF_CYCLE = 'N'
                  let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD - #SAL_REG_TAL_PTD
              else
                  let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD + #GPTH_TAX_VR_ER_E
              end-if
           end-if
           let #GPTH_R_INC_ANU=#TAX_VR_TOTAL_INC
     end-if
     let #GPTH_IR_INC=#zero 
     let #GPTH_IR_INC_YTD=#zero 
     let #GPTH_IR_INC_ANU=#zero    
             
     let #GPTH_TAL_IR_TX_YTD=#zero         
     !let #GPTH_TAX_AMT      =#TAX_VR_C_TTPY
     let #GPTH_TAX_R_PTD    =#TAX_VR_C_TTPP
     let #GPTH_TAX_IR_PTD   =#zero         
     let #GPTH_TAX_IR_YTD   =#zero         
     let #GPTH_TAX_EE_IR_YTD=#zero         
     let #GPTH_TAX_ER_IR_YTD=#zero                   
  end-if
  
  if $TAX_VR_LOG_PHASE = 'I'
     if $GPTH_TAX_VR_CAL_CA = 'ACM'
           !let #GPTH_R_INC=#TAX_VR_REG_AMT  - #SAL_REG_TAL_YTD + #SAL_REG_TAL_PTD
           !let #GPTH_R_INC=#TAX_VR_REG_AMT  - #GPTH_SAL_REG_A_YTD
           !let #GPTH_R_INC_YTD=#SAL_REG_TAL_YTD - #SAL_REG_TAL_PTD
           if &A.GPTH_OFF_CYCLE = 'N'
              let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD
           else
              let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD + #GPTH_TAX_VR_ER_E
           end-if
           let #GPTH_R_INC=#TAX_VR_REG_AMT  - #GPTH_R_INC_YTD
           let #GPTH_R_INC_ANU=#TAX_VR_REG_AMT
     else
           let #GPTH_R_INC=#TAX_VR_REG_AMT
           if &A.GPTH_OFF_CYCLE = 'N'
              let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD
           else
              let #GPTH_R_INC_YTD=#GPTH_SAL_REG_A_YTD + #GPTH_TAX_VR_ER_E
           end-if
           let #GPTH_R_INC_ANU=#TAX_VR_REG_AMT
     end-if
           
     let #GPTH_IR_INC_ANU=#TAX_VR_C_IR + #TAX_VR_L_TTPP
     
     !if $TAX_VR_LOG_YEA_END='N'
     !if #GPTH_REMAIN_PRD <> 0
               let #GPTH_IR_INC=#SAL_IR_SEG + #TAX_VR_L_TTPP
               let #GPTH_IR_INC_YTD=#TAX_VR_C_IR - #SAL_IR_SEG       
               
               if &A.GPTH_INC_SECTION = '401'
                  let #GPTH_TAL_IR_TX_YTD = #TAX_IR_TAL_YTD                                                   
               else
                  let #GPTH_TAL_IR_TX_YTD = #GPTH_TAX_IR_A_YTD
               end-if
     !end-if
     
     !if $TAX_VR_LOG_YEA_END='Y'
     if #GPTH_REMAIN_PRD = 0
               !let #GPTH_IR_INC=#SAL_IR_YTD - #TAX_IR_ER_YTD + #TAX_VR_L_TTPP
               !let #GPTH_IR_INC_YTD=#TAX_VR_C_IR
               let #GPTH_TAL_IR_TX_YTD=#TAX_VR_CUR_TAX
     end-if

     if &A.GPTH_OFF_CYCLE = 'N'
        let #GPTH_TAX_R_PTD    = #GPTH_TAX_REG_A_SEG
     else
        let #GPTH_TAX_R_PTD    = #GPTH_TAX_VR_EE_E + #GPTH_TAX_VR_ER_E
     end-if
     
     let #GPTH_TAX_IR_PTD   =#TAX_VR_C_TTPP                   
     let #GPTH_TAX_IR_YTD   =#TAX_IR_YTD                      
     let #GPTH_TAX_EE_IR_YTD=#TAX_IR_EE_YTD                   
     let #GPTH_TAX_ER_IR_YTD=#TAX_IR_ER_YTD         
  end-if
        
  !Tax Exempt for Employee Over 65 Years Old for Section 402 equals 401 plus 402
  let #TAX_ALLOW_OE = #TAX_ALLOW_OE + #GPTH_TAX_XMPT_402
  
  let #GPTH_TAL_ALLOW=#TAX_EXCEPT  + #TAX_ALLOW_OE  + #TAX_ALLOW_XT  + #TAX_ALLOW_PE  + #TAX_ALLOW_SP  + #TAX_ALLOW_CH  + #TAX_ALLOW_CE  + #TAX_ALLOW_FA  + #TAX_ALLOW_MO + #TAX_ALLOW_DS
        + #TAX_ALLOW_HP + #TAX_ALLOW_SF  + #TAX_ALLOW_SM  + #TAX_ALLOW_HI  + #TAX_ALLOW_PI  + #TAX_ALLOW_SI  + #TAX_ALLOW_IP  + #TAX_ALLOW_PF  + #TAX_ALLOW_MF  + #TAX_ALLOW_EF  + #TAX_ALLOW_TR  + #TAX_ALLOW_SS  + #TAX_ALLOW_MI 
  let #GPTH_TAXABLE_AMT=#TAX_VR_TAXABLE_AMT  + #TAX_ALLOW_DN
  
  if &A.GPTH_OFF_CYCLE = 'N'
     if $TAX_VR_LOG_PHASE = 'R' and &A.GPTH_INC_SECTION = '401'
        let #GPTH_TAL_R_TX_YTD = #TAX_REG_TAL_YTD
     else
        let #GPTH_TAL_R_TX_YTD = #GPTH_TAX_REG_A_YTD
     end-if
  else
     if $TAX_VR_LOG_PHASE = 'R' and &A.GPTH_INC_SECTION = '401' 
        let #GPTH_TAL_R_TX_YTD = #TAX_REG_TAL_YTD
     else
        let #GPTH_TAL_R_TX_YTD = #GPTH_TAX_REG_A_YTD + #GPTH_TAX_VR_EE_E + #GPTH_TAX_VR_ER_E
     end-if
  end-if
  
  if $GPTH_TAX_VR_CAL_CA = 'ACM'
     let #GPTH_TAX_AMT = #TAX_VR_TOTAL_AMT - #GPTH_TAL_R_TX_YTD - #GPTH_TAL_IR_TX_YTD
  else
     let #GPTH_TAX_AMT = #TAX_VR_TOTAL_AMT
  end-if

  let #col2 = #col + 7
  print $GPTH_INC_SECTION                                       (+1,#col2)     edit 'xxxxxxxxxxx'
  print #GPTH_R_INC                                             (+1,#col)     edit '999,999,999.99'
  print #GPTH_R_INC_YTD                                         (+1,#col)     edit '999,999,999.99'
  print #GPTH_R_INC_ANU                                         (+1,#col)     edit '999,999,999.99'
  print #GPTH_IR_INC                                            (+1,#col)     edit '999,999,999.99'
  print #GPTH_IR_INC_YTD                                        (+1,#col)     edit '999,999,999.99'
  print #GPTH_IR_INC_ANU                                        (+1,#col)     edit '999,999,999.99'
  print #TAX_VR_TOTAL_INC                                       (+1,#col)     edit '999,999,999.99'
  print #TAX_EXCEPT                                             (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_OE                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_XT                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_PE                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_SP                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_CH                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_CE                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_FA                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_MO                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_SF                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_SM                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_DS                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_HI                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_PI                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_SI                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_IP                                           (+1,#col)     edit '999,999,999.99'
 
  
  print #TAX_ALLOW_PF                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_MF                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_EF                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_HP                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_TR                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_SS                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_MI                                           (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAL_ALLOW                                         (+1,#col)     edit '999,999,999.99'
  print #TAX_VR_SPORT_AMT                                       (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_ED                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_PT                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_OT                                           (+1,#col)     edit '999,999,999.99'    ! add from 2012
  print #GPTH_TAXABLE_AMT                                       (+1,#col)     edit '999,999,999.99'
  print #TAX_ALLOW_DN                                           (+1,#col)     edit '999,999,999.99'
  print #TAX_VR_TAXABLE_AMT                                     (+1,#col)     edit '999,999,999.99'
  print #TAX_VR_TOTAL_AMT                                       (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAL_R_TX_YTD                                      (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAL_IR_TX_YTD                                     (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAX_AMT                                           (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAX_R_PTD                                         (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAX_IR_PTD                                        (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAX_IR_YTD                                        (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAX_EE_IR_YTD                                     (+1,#col)     edit '999,999,999.99'
  print #GPTH_TAX_ER_IR_YTD                                     (+1,#col)     edit '999,999,999.99'
                         
End-Procedure
          
#include 'datemath.sqc'     ! Date conversion procedures
#include 'sqrtrans.sqc'     ! Translate SQR strings to given language
#include 'prcslng.sqc'      ! Replaces getrplng.sqc
#include 'readxlat.sqc'     ! Procedure to read values from xlattable
#include 'reset.sqc'        ! Reset printer procedure
#include 'stdapi.sqc'       ! routines for process scheduler manipulation.                                                                       _   