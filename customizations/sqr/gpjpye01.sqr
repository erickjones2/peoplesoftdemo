!***********************************************************************
! GPJPYE01.sqr:  Withholding Tax report/Wage Payment Report            *
!***********************************************************************
!                                                                      *
!                                                                      *
!                                                                      *
!                                                                      *
! This software and related documentation are provided under a         *
! license agreement containing restrictions on use and                 *
! disclosure and are protected by intellectual property                *
! laws. Except as expressly permitted in your license agreement        *
! or allowed by law, you may not use, copy, reproduce,                 *
! translate, broadcast, modify, license, transmit, distribute,         *
! exhibit, perform, publish or display any part, in any form or        *
! by any means. Reverse engineering, disassembly, or                   *
! decompilation of this software, unless required by law for           *
! interoperability, is prohibited.                                     *
! The information contained herein is subject to change without        *
! notice and is not warranted to be error-free. If you find any        *
! errors, please report them to us in writing.                         *
!                                                                      *
!                                                                      *
! Copyright (C) 1988, 2017, Oracle and/or its affiliates.              *
! All Rights Reserved.                                                 *
!***********************************************************************
!                                                                      *
!       $Release:  HR92                                                !
!           $Bug:  26097469                                            !
!                                                                      *
!***********************************************************************

#include 'setenv.sqc'   !Set environment
#define PAPER_SIZE   A4
#DEFINE JapaneseDates
#DEFINE PRINT_JAPANESE

#DEFINE SUMLEN 40
#DEFINE PERS_ADDR_LEN 40
#DEFINE ESTAB_ADDR_LEN 65

#include 'gpjppnbr.sqc'  !JPN Personal Number
begin-setup
#include 'gpjpyel.sqc'  !page layout and printer definition


end-setup


begin-report

        #IFDEF GPJPPNBR-Included                  !gpjppnbr.sqc
          do Check-JPN-Personal-Nbr-Install
        #ENDIF

        do Init-Processing

        do Process-Main

        do Reset

        do Update-Prcs-Run-Status

end-report


!***********************************************************************
!                                                                      *
! Init-Processing                                                      *
!                                                                      *
!                                                                      *
! Called By:    begin-report                                           *
!                                                                      *
! Calls:        Init-Datetime           - datetime.sqc                 *
!               Get-Current-Datetime    - prcsapi.sqc (curdttim.sqc)   *
!               Get-Run-Control-Parms   - prcsapi.sqc                  *
!               Get-Language-Codes      - prcslng.sqc                  *
!               Get-GPJPYE01-runctl                                    *
!               Init-Report                                            *
!               Get-Estab-Name          - Getestab.sqc                 *
!                                                                      *
! Description:  Standard PeopleSoft initialization processing.         *
!                                                                      *
!***********************************************************************
begin-procedure Init-Processing


        do Init-Datetime

        do Get-Current-Datetime

        do Define-Prcs-Vars

        do Get-Run-Control-Parms

        do Get-Language-Codes
        if $JPN-Personal-Nbr-Installed='Y'
          do Get-Prcs-Instance-Pers-Nbr-Process
        end-if
        do Get-GPJPYE01-runctl

        do Init-Report

        let $Estab  = $Rc_Gpjp_tax_estab
        let $EstabType = 'IT'
        do Get-Estab-Name

end-procedure ! Init-Processing


!***********************************************************************
!                                                                      *
! Get-GPJPYE01-runctl                                                  *
!                                                                      *
!                                                                      *
! Called By:    Init-Processing                                        *
!                                                                      *
! Description:  Get data from GPJP_RC_YEA runcontrol record.          *
!                                                                      *
!***********************************************************************
begin-procedure Get-GPJPYE01-runctl


  begin-select

RC.GPJP_TAX_ESTAB
RC.DATE_YEAR_VAL
RC.CAL_RUN_ID
RC.GPJP_YEA_RPTTYP
RC.PAY_ENTITY
RC.BUSINESS_UNIT
RC.DEPTID
RC.LOCATION
RC.MUNICIPAL_CD_JPN
RC.EMPLID
RC.GPJP_RECIPIENT_NBR
RC.GPJP_YEA_RPTFLG
RC.GPJP_BU_SORT
RC.GPJP_LOC_SORT
RC.GPJP_DEPT_SORT
RC.GPJP_INCL_PERNBR
RC.GPJP_INCL_ASGNBR

FROM  PS_GPJP_RC_YEA_RPT RC
WHERE RC.OPRID          = $Prcs_OprID
AND   RC.RUN_CNTL_ID    = $Prcs_Run_Cntl_ID

end-select

      let $Rc_gpjp_tax_estab = RTRIM(&RC.Gpjp_tax_estab, ' ')
      let $Rc_cal_run_id     = RTRIM(&RC.Cal_run_id, ' ')

          let #Rc_date_year_val  = &RC.Date_year_val
          move #Rc_date_year_val to $Rc_date_year_val 9999

      let $Rc_gpjp_yea_rpttyp = RTRIM(&RC.Gpjp_yea_rpttyp,' ')
      let $Rc_pay_entity      = RTRIM(&RC.Pay_entity,' ')
      let $Rc_business_unit   = RTRIM(&RC.Business_unit,' ')
      let $Rc_deptid          = RTRIM(&RC.Deptid,' ')
      let $Rc_location        = RTRIM(&RC.Location,' ')
      let $Rc_municipal_cd    = RTRIM(&RC.Municipal_cd_jpn,' ')
      let $Rc_emplid          = RTRIM(&RC.Emplid,' ')
      let $Rc_gpjp_recipient  = RTRIM(&RC.Gpjp_recipient_nbr,' ')
      let $Rc_gpjp_yea_rptflg = RTRIM(&RC.Gpjp_yea_rptflg,' ')

      let $Rc_bu_sort         = &RC.Gpjp_bu_sort
      let $Rc_loc_sort        = &RC.Gpjp_loc_sort
      let $Rc_dept_sort       = &RC.Gpjp_dept_sort
      let $RC_Print_Pers_Nbr  = &RC.Gpjp_incl_pernbr
      let $RC_Print_Asgn_Nbr  = &RC.Gpjp_incl_asgnbr
end-procedure !Get-GPJPYE01-runctl


!***********************************************************************
!                                                                      *
! Init-Report                                                          *
!                                                                      *
!                                                                      *
! Called By:    Init-Processing                                        *
!                                                                      *
! Calls:        Init_Report_Translation    - sqrtrans.sqc              *
!               Append_Report_Translation  - sqrtrans.sqc              *
!               Get_Field_Information                                  *
!                                                                      *
! Description:  Initializes variables, defines values for variables    *
!               used in report header & throughout report.  Performs   *
!               Strings Table translation.  #Defines variables for     *
!               use throughout report in printing columns.             *
!                                                                      *
!***********************************************************************
begin-procedure Init-Report


    do Init_Report_Translation ($ReportID, $curr_language_cd)

    do Append_Report_Translation ('GPJPYE01')

    do Get_Field_Information ('GPJPYE01','SAL_BONUS',      $GPJPYE01_Sal_bonus,         #dummy_width)


    !do Security-Param                   ! SQR Security

end-procedure ! Init-Report


!***********************************************************************
!                                                                      *
! Process-Main                                                         *
!                                                                      *
!                                                                      *
! Called By:    Begin-Report                                           *
!                                                                      *
! Description:  Main processing                                        *
!                                                                      *
!***********************************************************************
begin-procedure Process-Main

    if $Rc_gpjp_yea_rpttyp  = '10'
       do Withholding-Report
    else
       if $Rc_gpjp_yea_rpttyp  = '20'
          do Wage-Payment-Report
       end-if
    end-if


end-procedure ! Process-Main

!***********************************************************************
! Get-Sort-Order                                                       *
! Called By: Process-Main                                              *
! Description:  Determines Sort order string                           *
!***********************************************************************

begin-procedure Get-Sort-Order

     let $Order_By     = ' '

     If $Rc_bu_sort = 'Y'
       Let $Order_By = 'Order by A.BUSINESS_UNIT'
     end-if

     If $Rc_loc_sort = 'Y'
       If $Order_By = ' '
          Let $Order_By = 'Order by A.LOCATION '
       else
         Let $Order_By = $Order_By || ', A.LOCATION '
       end-if
     end-if

     If $Rc_dept_sort = 'Y'
       If $Order_By = ' '
          Let $Order_By = 'Order by A.DEPTID'
       else
         Let $Order_By = $Order_By || ', A.DEPTID'
       end-if
     end-if


     If $Order_By = ' '
         Let $Order_By = 'Order by A.EMPLID'
       else
         Let $Order_By = $Order_By || ', A.EMPLID'
     end-if

end-procedure Get-Sort-Order


!***********************************************************************
!                                                                      *
! Get-Tax-Establishment                                                *
!                                                                      *
!                                                                      *
! Called By:    Withholding-Report                                     *
!                                                                      *
! Description:  Get Tax Establishment data                             *
!                                                                      *
!***********************************************************************
begin-procedure Get-Tax-Establishment

let #Firm_Number = ' '

  begin-select

ESTAB.GPJP_TAX_ESTAB
ESTAB.GPJP_YEA_PRINT_INS
ESTAB.FIRM_NUM_JPN

    let $Estab_yea_print_ins = RTRIM(&ESTAB.Gpjp_yea_print_ins,' ')
    let #Firm_Number =  &ESTAB.Firm_Num_jpn

FROM  PS_GPJP_TAX_ESTAB ESTAB
WHERE ESTAB.GPJP_TAX_ESTAB = $Rc_gpjp_tax_estab
AND ESTAB.GPJP_TAX_ESTAB_TYP = 'IT'
AND ESTAB.EFFDT = (SELECT MAX(EFFDT)
FROM PS_GPJP_TAX_ESTAB H
WHERE H.GPJP_TAX_ESTAB = ESTAB.GPJP_TAX_ESTAB
AND H.GPJP_TAX_ESTAB_TYP = 'IT'
AND H.EFFDT <= $EndYR_Dt)

end-select
end-procedure


!***********************************************************************
!                                                                      *
! Withholding-Report                                                   *
!                                                                      *
!                                                                      *
! Called By:    Main processing                                        *
!                                                                      *
! Description:  This procedure prints the Withholding Tax report       *
!                                                                      *
!***********************************************************************
begin-procedure Withholding-Report

      do Build-Withh-select
      do Get-Sort-Order
      let $_TableAlias = 'A'
      do Security-Param                   ! SQR Security

begin-select
A.EMPLID
A.EMPL_RCD
A.DATE_YEAR_VAL
A.CAL_RUN_ID
A.GPJP_RECIPIENT_NBR
A.MUNICIPAL_CD_JPN
A.GPJP_YEA_SUBMIT
A.COMPANY
A.BUSINESS_UNIT
A.DEPTID
A.LOCATION
A.SUPV_LVL_ID
A.GPJP_YEA_TYPE
A.GPJP_IT_EARNS
A.GPJP_YEA_NET
A.GPJP_YEA_INCAFT
A.GPJP_IT_INCTAX
A.GPJP_YEA_SPSDED
A.GPJP_YEA_ELDPRT
A.GPJP_YEA_DEPSPC
A.GPJP_YEA_DEPELD
A.GPJP_YEA_DEPOTH
A.GPJP_YEA_DEPJUV
A.GPJP_YEA_DISLIV
A.GPJP_YEA_DISSPC
A.GPJP_YEA_DISOTH
A.GPJP_YEA_LIVELD
A.GPJP_SC_PREM
A.GPJP_YEA_MUTAID
A.GPJP_YEA_LIFPRE
A.GPJP_YEA_NONLIF
A.GPJP_YEA_HOUSE
A.GPJP_YEA_HOUSE2
A.GPJP_YEA_SPSINC
A.GPJP_YEA_PENPRE
A.GPJP_YEA_LTNONL
A.GPJP_YEA_YEASC
A.GPJP_YEA_YEADED
A.GPJP_YEA_YEATAX
A.GPJP_YEA_YEATX2
A.GPJP_YEA_TXDIFF
A.GPJP_YEA_DEDSPO
A.GPJP_YEA_DEDELS
A.GPJP_YEA_BDTERA
A.GPJP_YEA_BTHDT6
A.GPJP_YEA_HUSBND
A.GPJP_YEA_MINOR
A.GPJP_YEA_OTSU
A.GPJP_YEA_DISFL1
A.GPJP_YEA_DISFL2
A.GPJP_YEA_ELD
A.GPJP_YEA_WIDOW
A.GPJP_YEA_WDWER
A.GPJP_YEA_WRKSTD
A.GPJP_YEA_TRMDTH
A.GPJP_YEA_FORGN
A.GPJP_YEA_HIRMID
A.GPJP_YEA_MIDDT
A.GPJP_YEA_PRIDT
A.GPJP_RES_CHRDT7_1
A.GPJP_YEA_AMTDED
A.GPJP_YEA_PERSINS
A.GPJP_YEA_FLADDR
A.GPJP_YEA_FLADDR1
A.PHONE
A.GPJP_YEA_SPCTAX
A.GPJP_YEA_NATPEN
A.GPJP_YEA_SUMM
A.GPJP_YEA_CARPRE
A.GPJP_YEA_PENPRE1
A.GPJP_YEA_LIFPREAC1
A.GPJP_YEA_LIFPREAC
A.GPJP_NO_HOUSE_LOAN
A.GPJP_RES_CHRDT7_2
A.GPJP_APP_CLASS1 
A.GPJP_PAYABLE_LOAN1 
A.GPJP_APP_CLASS2 
A.GPJP_PAYABLE_LOAN2
A.GPJP_YEA_DEP_NRSD
A.GPJP_YEA_SUMM_NEW
     let $Emplid                = &A.Emplid
     let #Empl_rcd              = &A.Empl_rcd
     let #Date_year_val         = &A.DATE_YEAR_VAL
     let $Cal_run_id            = &A.Cal_run_id
     let $Gpjp_recipient_nbr    = &A.Gpjp_recipient_nbr
     let $Municipal_cd_jpn      = &A.Municipal_cd_jpn
     let #Gpjp_yea_submit       = &A.Gpjp_yea_submit
     let $Company               = &A.Company
     let $Business_unit         = &A.Business_unit
     let $Deptid                = &A.Deptid
     let $Location              = &A.Location
     let $SUPV_LVL_ID           = &A.SUPV_LVL_ID
     let $Gpjp_yea_type         = &A.Gpjp_yea_type
     let #Gpjp_it_earns         = &A.Gpjp_it_earns
     let #Gpjp_yea_net          = &A.Gpjp_yea_net
     let #Gpjp_yea_incaft       = &A.Gpjp_yea_incaft
     let #Gpjp_it_inctax        = &A.Gpjp_it_inctax
     let #Gpjp_yea_spsded       = &A.Gpjp_yea_spsded
     let $Gpjp_yea_eldprt       = &A.Gpjp_yea_eldprt
     let #Gpjp_yea_depspc       = &A.Gpjp_yea_depspc
     let #Gpjp_yea_depeld       = &A.Gpjp_yea_depeld
     let #Gpjp_yea_depoth       = &A.Gpjp_yea_depoth
     let #Gpjp_yea_depjuv       = &A.Gpjp_yea_depjuv
     let #Gpjp_yea_disliv       = &A.Gpjp_yea_disliv
     let #Gpjp_yea_disspc       = &A.Gpjp_yea_disspc
     let #Gpjp_yea_disoth       = &A.Gpjp_yea_disoth
     let #Gpjp_yea_liveld       = &A.Gpjp_yea_liveld
     let #Gpjp_sc_prem          = &A.Gpjp_sc_prem
     let #Gpjp_yea_mutaid       = &A.Gpjp_yea_mutaid
     let #Gpjp_yea_lifpre       = &A.Gpjp_yea_lifpre
     let #Gpjp_yea_nonlif       = &A.Gpjp_yea_nonlif
     let #Gpjp_yea_house        = &A.Gpjp_yea_house
     let #Gpjp_yea_spsinc       = &A.Gpjp_yea_spsinc
     let #Gpjp_yea_penpre       = &A.Gpjp_yea_penpre
     let #Gpjp_yea_ltnonl       = &A.Gpjp_yea_ltnonl
     let $Gpjp_yea_yeasc        = &A.Gpjp_yea_yeasc
     let #gpjp_yea_yeaded       = &A.Gpjp_yea_yeaded
     let $Gpjp_yea_yeatax       = &A.Gpjp_yea_yeatax
     let $Gpjp_yea_yeatx2       = &A.Gpjp_yea_yeatx2
     let $Gpjp_yea_txdiff       = &A.Gpjp_yea_txdiff
     let $Gpjp_yea_dedspo       = &A.Gpjp_yea_dedspo
     let $Gpjp_yea_dedels       = &A.Gpjp_yea_dedels
     let $Gpjp_yea_bdtera       = &A.Gpjp_yea_bdtera
     let $Gpjp_yea_bthdt6       = &A.Gpjp_yea_bthdt6
     let $Gpjp_yea_husbnd       = &A.Gpjp_yea_husbnd
     let #Gpjp_yea_minor        = &A.Gpjp_yea_minor
     let $Gpjp_yea_otsu         = &A.Gpjp_yea_otsu
     let $Gpjp_yea_disfl1       = &A.Gpjp_yea_disfl1
     let $Gpjp_yea_disfl2       = &A.Gpjp_yea_disfl2
     let $Gpjp_yea_eld          = &A.Gpjp_yea_eld
     let $Gpjp_yea_widow        = &A.Gpjp_yea_widow
     let $Gpjp_yea_wdwer        = &A.Gpjp_yea_wdwer
     let $Gpjp_yea_wrkstd       = &A.Gpjp_yea_wrkstd
     let $Gpjp_yea_trmdth       = &A.Gpjp_yea_trmdth
     let $Gpjp_yea_forgn        = &A.Gpjp_yea_forgn
     let #Gpjp_yea_hirmid       = &A.Gpjp_yea_hirmid
     let $Gpjp_yea_middt        = &A.Gpjp_yea_middt
     let $Gpjp_yea_pridt        = &A.Gpjp_yea_pridt
     let $Gpjp_res_chrdt7_1     = &A.Gpjp_res_chrdt7_1
     let $Gpjp_yea_amtded       = &A.Gpjp_yea_amtded
     let #Gpjp_yea_persins      = &A.Gpjp_yea_persins
     let $Gpjp_yea_fladdr       = &A.Gpjp_yea_fladdr
     let $Gpjp_yea_fladdr1      = &A.Gpjp_yea_fladdr1
     let $phone                 = &A.phone
     let #Gpjp_Yea_Carpre       = &A.Gpjp_Yea_Carpre
     let #Gpjp_Yea_Penpre1      = &A.Gpjp_Yea_Penpre1
     let #Gpjp_Yea_Lifpreac1    = &A.Gpjp_Yea_Lifpreac1
     let #Gpjp_Yea_Lifpreac     = &A.Gpjp_Yea_Lifpreac
     let #Gpjp_no_house_loan     =&A.Gpjp_no_house_loan
     let $Gpjp_res_chrdt7_2     = &A.Gpjp_res_chrdt7_2
     let $Gpjp_app_class1     = &A.Gpjp_app_class1
     let #Gpjp_payable_loan1     = &A.Gpjp_payable_loan1
     let $Gpjp_app_class2     = &A.Gpjp_app_class2
     let #Gpjp_payable_loan2     = &A.Gpjp_payable_loan2
     let #Gpjp_yea_dep_nrsd     =&A.Gpjp_yea_dep_nrsd
     let $Gpjp_yea_summ_new     =&A.Gpjp_yea_summ_new

     if #Date_year_val < 2007
         let #Gpjp_yea_spctax   = &A.Gpjp_yea_spctax
     ELSE
         let #Gpjp_yea_spctax   = &A.Gpjp_yea_house2
     END-IF

     let #Gpjp_yea_natpen       = &A.Gpjp_yea_natpen
     let $Gpjp_yea_summ         = &A.Gpjp_yea_summ

     If $Rc_gpjp_yea_rptflg = '10' or
        ($Rc_gpjp_yea_rptflg = '20' and #Gpjp_yea_submit = 1)

     do Calc-Date2
     do Check-Status
     do Get-Japanese-Dates
     do Get-Tax-Establishment

      If $Estab_yea_print_ins = 'N'
         If ($Status ='T' OR $Status ='D' ) AND #Gpjp_yea_hirmid = 2
           If ( $reason = 'DEA' AND $Gpjp_yea_type = '10')
              let #Gpjp_amount18 = #Gpjp_yea_persins + #Gpjp_sc_prem
                else
              let #Gpjp_amount18 = #Gpjp_yea_persins
             end-if
                else
                  let #Gpjp_amount18 = #Gpjp_yea_persins + #Gpjp_sc_prem
               end-if
          else
           let #Gpjp_amount18 = #Gpjp_yea_persins + #Gpjp_sc_prem
           end-if

 if $Rc_date_year_val < '2016'
     let $First_print = 'Y'
     do Print-Details
     position  (50,3)
     let $First_print = 'N'
     do Print-Details
 else
     do Print-Details-New-Withholding-Report
 end-if

     new-page
   end-if

FROM PS_GPJP_YEA_TABLE A
WHERE A.GPJP_TAX_ESTAB = $Rc_Gpjp_tax_estab
AND A.GPJP_IT_EARNS > 0
[$Slct_Payent]
[$SlctDept]
[$Slct_location]
[$Slct_emplid]
[$Slct_Calgid]
[$Slct_Dateyv]
[$SecurityClausewithERN]
[$Order_By]
end-select


end-procedure ! Withholding-Report


!***********************************************************************
!                                                                      *
! Wage-Payment-Report                                                  *
!                                                                      *
!                                                                      *
! Called By:    Main processing                                        *
!                                                                      *
! Description:  This procedure prints the Wage Payment Report          *
!                                                                      *
!***********************************************************************
begin-procedure Wage-Payment-Report

        do Build-Wage-select
        let $_TableAlias = 'B'
        do Security-Param                   ! SQR Security
     
        if $Rc_municipal_cd = ''
        let $_TableAlias = 'B'
        do Security-Param

begin-select
B.EMPLID
B.EMPL_RCD
B.DATE_YEAR_VAL
B.CAL_RUN_ID
B.GPJP_RECIPIENT_NBR
B.MUNICIPAL_CD_JPN
B.GPJP_YEA_SUBMIT
B.COMPANY
B.BUSINESS_UNIT
B.DEPTID
B.LOCATION
B.SUPV_LVL_ID
B.GPJP_YEA_TYPE
B.GPJP_IT_EARNS
B.GPJP_YEA_NET
B.GPJP_YEA_INCAFT
B.GPJP_IT_INCTAX
B.GPJP_YEA_SPSDED
B.GPJP_YEA_ELDPRT
B.GPJP_YEA_DEPSPC
B.GPJP_YEA_DEPELD
B.GPJP_YEA_DEPOTH
B.GPJP_YEA_DEPJUV
B.GPJP_YEA_DISLIV
B.GPJP_YEA_DISSPC
B.GPJP_YEA_DISOTH
B.GPJP_YEA_LIVELD
B.GPJP_SC_PREM
B.GPJP_YEA_MUTAID
B.GPJP_YEA_LIFPRE
B.GPJP_YEA_NONLIF
B.GPJP_YEA_HOUSE
B.GPJP_YEA_HOUSE2
B.GPJP_YEA_SPSINC
B.GPJP_YEA_PENPRE
B.GPJP_YEA_LTNONL
B.GPJP_YEA_YEASC
B.GPJP_YEA_YEADED
B.GPJP_YEA_YEATAX
B.GPJP_YEA_YEATX2
B.GPJP_YEA_TXDIFF
B.GPJP_YEA_DEDSPO
B.GPJP_YEA_DEDELS
B.GPJP_YEA_BDTERA
B.GPJP_YEA_BTHDT6
B.GPJP_YEA_HUSBND
B.GPJP_YEA_MINOR
B.GPJP_YEA_OTSU
B.GPJP_YEA_DISFL1
B.GPJP_YEA_DISFL2
B.GPJP_YEA_ELD
B.GPJP_YEA_WIDOW
B.GPJP_YEA_WDWER
B.GPJP_YEA_WRKSTD
B.GPJP_YEA_TRMDTH
B.GPJP_YEA_FORGN
B.GPJP_YEA_HIRMID
B.GPJP_YEA_MIDDT
B.GPJP_YEA_PRIDT
B.GPJP_RES_CHRDT7_1
B.GPJP_YEA_AMTDED
B.GPJP_YEA_PERSINS
B.GPJP_YEA_FLADDR
B.GPJP_YEA_FLADDR1
B.PHONE
B.GPJP_YEA_SPCTAX
B.GPJP_YEA_NATPEN
B.GPJP_YEA_SUMM
B.GPJP_YEA_CARPRE
B.GPJP_YEA_PENPRE1
B.GPJP_YEA_LIFPREAC1
B.GPJP_YEA_LIFPREAC
B.GPJP_NO_HOUSE_LOAN
B.GPJP_RES_CHRDT7_2
B.GPJP_APP_CLASS1 
B.GPJP_PAYABLE_LOAN1 
B.GPJP_APP_CLASS2 
B.GPJP_PAYABLE_LOAN2
B.GPJP_YEA_DEP_NRSD
B.GPJP_YEA_SUMM_NEW

     let $Emplid                = &B.Emplid
     let #Empl_rcd              = &B.Empl_rcd
     let #Date_year_val         = &B.DATE_YEAR_VAL
     let $Cal_run_id            = &B.Cal_run_id
     let $Gpjp_recipient_nbr    = &B.Gpjp_recipient_nbr
     let $Municipal_cd_jpn      = &B.Municipal_cd_jpn
     let #Gpjp_yea_submit       = &B.Gpjp_yea_submit
     let $Company               = &B.Company
     let $Business_unit         = &B.Business_unit
     let $Deptid                = &B.Deptid
     let $Location              = &B.Location
     let $SUPV_LVL_ID           = &B.SUPV_LVL_ID
     let $Gpjp_yea_type         = &B.Gpjp_yea_type
     let #Gpjp_it_earns         = &B.Gpjp_it_earns
     let #Gpjp_yea_net          = &B.Gpjp_yea_net
     let #Gpjp_yea_incaft       = &B.Gpjp_yea_incaft
     let #Gpjp_it_inctax        = &B.Gpjp_it_inctax
     let #Gpjp_yea_spsded       = &B.Gpjp_yea_spsded
     let $Gpjp_yea_eldprt       = &B.Gpjp_yea_eldprt
     let #Gpjp_yea_depspc       = &B.Gpjp_yea_depspc
     let #Gpjp_yea_depeld       = &B.Gpjp_yea_depeld
     let #Gpjp_yea_depoth       = &B.Gpjp_yea_depoth
     let #Gpjp_yea_depjuv       = &B.Gpjp_yea_depjuv
     let #Gpjp_yea_disliv       = &B.Gpjp_yea_disliv
     let #Gpjp_yea_disspc       = &B.Gpjp_yea_disspc
     let #Gpjp_yea_disoth       = &B.Gpjp_yea_disoth
     let #Gpjp_yea_liveld       = &B.Gpjp_yea_liveld
     let #Gpjp_sc_prem          = &B.Gpjp_sc_prem
     let #Gpjp_yea_mutaid       = &B.Gpjp_yea_mutaid
     let #Gpjp_yea_lifpre       = &B.Gpjp_yea_lifpre
     let #Gpjp_yea_nonlif       = &B.Gpjp_yea_nonlif
     let #Gpjp_yea_house        = &B.Gpjp_yea_house
     let #Gpjp_yea_spsinc       = &B.Gpjp_yea_spsinc
     let #Gpjp_yea_penpre       = &B.Gpjp_yea_penpre
     let #Gpjp_yea_ltnonl       = &B.Gpjp_yea_ltnonl
     let $Gpjp_yea_yeasc        = &B.Gpjp_yea_yeasc
     let #Gpjp_yea_yeaded       = &B.Gpjp_yea_yeaded
     let $Gpjp_yea_yeatax       = &B.Gpjp_yea_yeatax
     let $Gpjp_yea_yeatx2       = &B.Gpjp_yea_yeatx2
     let $Gpjp_yea_txdiff       = &B.Gpjp_yea_txdiff
     let $Gpjp_yea_dedspo       = &B.Gpjp_yea_dedspo
     let $Gpjp_yea_dedels       = &B.Gpjp_yea_dedels
     let $Gpjp_yea_bdtera       = &B.Gpjp_yea_bdtera
     let $Gpjp_yea_bthdt6       = &B.Gpjp_yea_bthdt6
     let $Gpjp_yea_husbnd       = &B.Gpjp_yea_husbnd
     let #Gpjp_yea_minor        = &B.Gpjp_yea_minor
     let $Gpjp_yea_otsu         = &B.Gpjp_yea_otsu
     let $Gpjp_yea_disfl1       = &B.Gpjp_yea_disfl1
     let $Gpjp_yea_disfl2       = &B.Gpjp_yea_disfl2
     let $Gpjp_yea_eld          = &B.Gpjp_yea_eld
     let $Gpjp_yea_widow        = &B.Gpjp_yea_widow
     let $Gpjp_yea_wdwer        = &B.Gpjp_yea_wdwer
     let $Gpjp_yea_wrkstd       = &B.Gpjp_yea_wrkstd
     let $Gpjp_yea_trmdth       = &B.Gpjp_yea_trmdth
     let $Gpjp_yea_forgn        = &B.Gpjp_yea_forgn
     let #Gpjp_yea_hirmid       = &B.Gpjp_yea_hirmid
     let $Gpjp_yea_middt        = &B.Gpjp_yea_middt
     let $Gpjp_yea_pridt        = &B.Gpjp_yea_pridt
     let $Gpjp_res_chrdt7_1     = &B.Gpjp_res_chrdt7_1
     let $Gpjp_yea_amtded       = &B.Gpjp_yea_amtded
     let #Gpjp_yea_persins      = &B.Gpjp_yea_persins
     let $Gpjp_yea_fladdr       = &B.Gpjp_yea_fladdr
     let $Gpjp_yea_fladdr1      = &B.Gpjp_yea_fladdr1
     let $phone                 = &B.phone
     let #Gpjp_Yea_Carpre       = &B.Gpjp_Yea_Carpre
     let #Gpjp_Yea_Penpre1      = &B.Gpjp_Yea_Penpre1
     let #Gpjp_Yea_Lifpreac1    = &B.Gpjp_Yea_Lifpreac1
     let #Gpjp_Yea_Lifpreac     = &B.Gpjp_Yea_Lifpreac
     let #Gpjp_no_house_loan    = &B.Gpjp_no_house_loan
     let $Gpjp_res_chrdt7_2     = &B.Gpjp_res_chrdt7_2
     let $Gpjp_app_class1       = &B.Gpjp_app_class1
     let #Gpjp_payable_loan1    = &B.Gpjp_payable_loan1
     let $Gpjp_app_class2       = &B.Gpjp_app_class2
     let #Gpjp_payable_loan2    = &B.Gpjp_payable_loan2
     let #Gpjp_yea_dep_nrsd     = &B.Gpjp_yea_dep_nrsd
     let $Gpjp_yea_summ_new     = &B.Gpjp_yea_summ_new

     if #Date_year_val < 2007
         let #Gpjp_yea_spctax   = &B.Gpjp_yea_spctax
     ELSE
         let #Gpjp_yea_spctax   = &B.Gpjp_yea_house2
     END-IF

     let #Gpjp_yea_natpen       = &B.Gpjp_yea_natpen
     let $Gpjp_yea_summ         = &B.Gpjp_yea_summ

      do Calc-Date2
      do Check-Status
      do Get-Japanese-Dates
      do Get-Tax-Establishment
      let #Gpjp_amount18 = #Gpjp_yea_persins + #Gpjp_sc_prem
      if $Rc_date_year_val < '2016'
       let $First_print = 'Y'
       do Print-Details
       position  (50,3)
       let $First_print = 'N'
       do Print-Details
      else
       do Print-Details-New-Wage-Payment-Report
      end-if     
      new-page

FROM PS_GPJP_YEA_TABLE B
WHERE B.DATE_YEAR_VAL = #Rc_date_year_val
AND B.GPJP_TAX_ESTAB = $Rc_Gpjp_tax_estab
AND B.GPJP_IT_EARNS > 0
[$Slct_Municipal_cd]
[$Slct_Recipient]
[$SecurityClausewithERN]
[$Slct_Order_by]
end-select

        ELSE
     
     let $_TableAlias = 'B1'
     do Security-Param
 
begin-select
B1.EMPLID
B1.EMPL_RCD
B1.DATE_YEAR_VAL
B1.CAL_RUN_ID
B1.GPJP_RECIPIENT_NBR
B1.MUNICIPAL_CD_JPN
B1.GPJP_YEA_SUBMIT
B1.COMPANY
B1.BUSINESS_UNIT
B1.DEPTID
B1.LOCATION
B1.SUPV_LVL_ID
B1.GPJP_YEA_TYPE
B1.GPJP_IT_EARNS
B1.GPJP_YEA_NET
B1.GPJP_YEA_INCAFT
B1.GPJP_IT_INCTAX
B1.GPJP_YEA_SPSDED
B1.GPJP_YEA_ELDPRT
B1.GPJP_YEA_DEPSPC
B1.GPJP_YEA_DEPELD
B1.GPJP_YEA_DEPOTH
B1.GPJP_YEA_DEPJUV
B1.GPJP_YEA_DISLIV
B1.GPJP_YEA_DISSPC
B1.GPJP_YEA_DISOTH
B1.GPJP_YEA_LIVELD
B1.GPJP_SC_PREM
B1.GPJP_YEA_MUTAID
B1.GPJP_YEA_LIFPRE
B1.GPJP_YEA_NONLIF
B1.GPJP_YEA_HOUSE
B1.GPJP_YEA_HOUSE2
B1.GPJP_YEA_SPSINC
B1.GPJP_YEA_PENPRE
B1.GPJP_YEA_LTNONL
B1.GPJP_YEA_YEASC
B1.GPJP_YEA_YEADED
B1.GPJP_YEA_YEATAX
B1.GPJP_YEA_YEATX2
B1.GPJP_YEA_TXDIFF
B1.GPJP_YEA_DEDSPO
B1.GPJP_YEA_DEDELS
B1.GPJP_YEA_BDTERA
B1.GPJP_YEA_BTHDT6
B1.GPJP_YEA_HUSBND
B1.GPJP_YEA_MINOR
B1.GPJP_YEA_OTSU
B1.GPJP_YEA_DISFL1
B1.GPJP_YEA_DISFL2
B1.GPJP_YEA_ELD
B1.GPJP_YEA_WIDOW
B1.GPJP_YEA_WDWER
B1.GPJP_YEA_WRKSTD
B1.GPJP_YEA_TRMDTH
B1.GPJP_YEA_FORGN
B1.GPJP_YEA_HIRMID
B1.GPJP_YEA_MIDDT
B1.GPJP_YEA_PRIDT
B1.GPJP_RES_CHRDT7_1
B1.GPJP_YEA_AMTDED
B1.GPJP_YEA_PERSINS
B1.GPJP_YEA_FLADDR
B1.GPJP_YEA_FLADDR1
B1.PHONE
B1.GPJP_YEA_SPCTAX
B1.GPJP_YEA_NATPEN
B1.GPJP_YEA_SUMM
B1.GPJP_YEA_CARPRE
B1.GPJP_YEA_PENPRE1
B1.GPJP_YEA_LIFPREAC1
B1.GPJP_YEA_LIFPREAC

     let $Emplid                = &B1.Emplid
     let #Empl_rcd              = &B1.Empl_rcd
     let #Date_year_val         = &B1.DATE_YEAR_VAL
     let $Cal_run_id            = &B1.Cal_run_id
     let $Gpjp_recipient_nbr    = &B1.Gpjp_recipient_nbr
     let $Municipal_cd_jpn      = &B1.Municipal_cd_jpn
     let #Gpjp_yea_submit       = &B1.Gpjp_yea_submit
     let $Company               = &B1.Company
     let $Business_unit         = &B1.Business_unit
     let $Deptid                = &B1.Deptid
     let $Location              = &B1.Location
     let $SUPV_LVL_ID           = &B1.SUPV_LVL_ID
     let $Gpjp_yea_type         = &B1.Gpjp_yea_type
     let #Gpjp_it_earns         = &B1.Gpjp_it_earns
     let #Gpjp_yea_net          = &B1.Gpjp_yea_net
     let #Gpjp_yea_incaft       = &B1.Gpjp_yea_incaft
     let #Gpjp_it_inctax        = &B1.Gpjp_it_inctax
     let #Gpjp_yea_spsded       = &B1.Gpjp_yea_spsded
     let $Gpjp_yea_eldprt       = &B1.Gpjp_yea_eldprt
     let #Gpjp_yea_depspc       = &B1.Gpjp_yea_depspc
     let #Gpjp_yea_depeld       = &B1.Gpjp_yea_depeld
     let #Gpjp_yea_depoth       = &B1.Gpjp_yea_depoth
     let #Gpjp_yea_depjuv       = &B1.Gpjp_yea_depjuv
     let #Gpjp_yea_disliv       = &B1.Gpjp_yea_disliv
     let #Gpjp_yea_disspc       = &B1.Gpjp_yea_disspc
     let #Gpjp_yea_disoth       = &B1.Gpjp_yea_disoth
     let #Gpjp_yea_liveld       = &B1.Gpjp_yea_liveld
     let #Gpjp_sc_prem          = &B1.Gpjp_sc_prem
     let #Gpjp_yea_mutaid       = &B1.Gpjp_yea_mutaid
     let #Gpjp_yea_lifpre       = &B1.Gpjp_yea_lifpre
     let #Gpjp_yea_nonlif       = &B1.Gpjp_yea_nonlif
     let #Gpjp_yea_house        = &B1.Gpjp_yea_house
     let #Gpjp_yea_spsinc       = &B1.Gpjp_yea_spsinc
     let #Gpjp_yea_penpre       = &B1.Gpjp_yea_penpre
     let #Gpjp_yea_ltnonl       = &B1.Gpjp_yea_ltnonl
     let $Gpjp_yea_yeasc        = &B1.Gpjp_yea_yeasc
     let #Gpjp_yea_yeaded       = &B1.Gpjp_yea_yeaded
     let $Gpjp_yea_yeatax       = &B1.Gpjp_yea_yeatax
     let $Gpjp_yea_yeatx2       = &B1.Gpjp_yea_yeatx2
     let $Gpjp_yea_txdiff       = &B1.Gpjp_yea_txdiff
     let $Gpjp_yea_dedspo       = &B1.Gpjp_yea_dedspo
     let $Gpjp_yea_dedels       = &B1.Gpjp_yea_dedels
     let $Gpjp_yea_bdtera       = &B1.Gpjp_yea_bdtera
     let $Gpjp_yea_bthdt6       = &B1.Gpjp_yea_bthdt6
     let $Gpjp_yea_husbnd       = &B1.Gpjp_yea_husbnd
     let #Gpjp_yea_minor        = &B1.Gpjp_yea_minor
     let $Gpjp_yea_otsu         = &B1.Gpjp_yea_otsu
     let $Gpjp_yea_disfl1       = &B1.Gpjp_yea_disfl1
     let $Gpjp_yea_disfl2       = &B1.Gpjp_yea_disfl2
     let $Gpjp_yea_eld          = &B1.Gpjp_yea_eld
     let $Gpjp_yea_widow        = &B1.Gpjp_yea_widow
     let $Gpjp_yea_wdwer        = &B1.Gpjp_yea_wdwer
     let $Gpjp_yea_wrkstd       = &B1.Gpjp_yea_wrkstd
     let $Gpjp_yea_trmdth       = &B1.Gpjp_yea_trmdth
     let $Gpjp_yea_forgn        = &B1.Gpjp_yea_forgn
     let #Gpjp_yea_hirmid       = &B1.Gpjp_yea_hirmid
     let $Gpjp_yea_middt        = &B1.Gpjp_yea_middt
     let $Gpjp_yea_pridt        = &B1.Gpjp_yea_pridt
     let $Gpjp_res_chrdt7_1     = &B1.Gpjp_res_chrdt7_1
     let $Gpjp_yea_amtded       = &B1.Gpjp_yea_amtded
     let #Gpjp_yea_persins      = &B1.Gpjp_yea_persins
     let $Gpjp_yea_fladdr       = &B1.Gpjp_yea_fladdr
     let $Gpjp_yea_fladdr1      = &B1.Gpjp_yea_fladdr1
     let $phone                 = &B1.phone
     let #Gpjp_Yea_Carpre       = &B1.Gpjp_Yea_Carpre
     let #Gpjp_Yea_Penpre1      = &B1.Gpjp_Yea_Penpre1
     let #Gpjp_Yea_Lifpreac1    = &B1.Gpjp_Yea_Lifpreac1
     let #Gpjp_Yea_Lifpreac     = &B1.Gpjp_Yea_Lifpreac

     if #Date_year_val < 2007
         let #Gpjp_yea_spctax   = &B1.Gpjp_yea_spctax
     ELSE
         let #Gpjp_yea_spctax   = &B1.Gpjp_yea_house2
     END-IF

     let #Gpjp_yea_natpen       = &B1.Gpjp_yea_natpen
     let $Gpjp_yea_summ         = &B1.Gpjp_yea_summ

      do Calc-Date2
      do Check-Status
      do Get-Japanese-Dates
      let #Gpjp_amount18 = #Gpjp_yea_persins + #Gpjp_sc_prem
      let $First_print = 'Y'
      do Print-Details
      position  (50,3)
      let $First_print = 'N'
      do Print-Details
      new-page
      
FROM PS_GPJP_YEA_TABLE B1, PS_GPJP_IH_MUNIC2 C
WHERE B1.DATE_YEAR_VAL = #Rc_date_year_val
AND B1.GPJP_TAX_ESTAB = $Rc_Gpjp_tax_estab
AND B1.GPJP_IT_EARNS > 0
AND B1.GPJP_TAX_ESTAB = C.GPJP_TAX_ESTAB
AND C.EFF_STATUS = 'A'
AND C.GPJP_MUNC_IH_CD = B1.MUNICIPAL_CD_JPN
AND C.EFFDT = (SELECT Max(C_ED.EFFDT) FROM PS_GPJP_IH_MUNIC2 C_ED
              WHERE C_ED.MUNICIPAL_CD_JPN = C.MUNICIPAL_CD_JPN
              AND C_ED.GPJP_TAX_ESTAB = C.GPJP_TAX_ESTAB
              AND C_ED.EFF_STATUS = 'A'
              AND C_ED.EFFDT <= $AsOfToday)
               AND EXISTS ( 
 SELECT MC1.MUNICIPAL_CD_JPN 
  FROM PS_GPJP_IH_MUNIC2 MC1 
 WHERE MC1.MUNICIPAL_CD_JPN = C.MUNICIPAL_CD_JPN 
   AND MC1.MUNICIPAL_CD_JPN = ( 
 SELECT  MUNICIPAL_CD_JPN 
  FROM PS_POSTAL_TBL_JPN 
 WHERE POSTAL = ( 
 SELECT ADR.POSTAL 
  FROM PS_ADDRESSES ADR 
 WHERE ADR.EMPLID = B1.EMPLID
   AND ADR.ADDRESS_TYPE IN ('HOME', 'LEGL') 
   AND ADR.EFF_STATUS = 'A' 
   AND ADR.EFFDT = ( 
 SELECT MAX(ADR_ED.EFFDT) 
  FROM PS_ADDRESSES ADR_ED 
 WHERE ADR_ED.EMPLID = ADR.EMPLID 
   AND ADR_ED.ADDRESS_TYPE = ADR.ADDRESS_TYPE 
   AND ADR_ED.EFFDT <= $AsOfToday)) ))
[$Slct_Recipient1]
[$SecurityClausewithERN]
ORDER BY C.GPJP_MUNC_RPT_CD
end-select  
 
  END-IF

end-procedure ! Wage-Payment-Report

!***********************************************************************
!                                                                      *
! Calc-Date2                                                           *
!                                                                      *
!                                                                      *
! Called By:    Begin-Report                                           *
!                                                                      *
! Description:  Calculate the Date  01/01 of the next year             *
!               and converts Object Year into Japanese Era             *
!                                                                      *
!***********************************************************************
begin-procedure Calc-Date2


    let #first_day = 01
    let #january   = 01
    let #next_year = #Date_year_val + 1

    do dtu-format-date(#next_year, #january, #first_day, $Date_jan)

    do Convert-From-DTU-Date($Date_jan,$NextJan)

    let #last_day  = 31
    let #dec       = 12

    do dtu-format-date(#Date_year_val, #dec, #last_day, $EndYR_Date)

    do Convert-From-DTU-Date($EndYR_Date,$EndYR_Dt)

    do format-datetime ($EndYR_Dt, $Imperial_date, {DEFROM}, '', '')
    if substr($Imperial_date,4,1) = '.' ! If the year-in-era is one digit value, fill a zero
       let $Year_in_era  = substr($Imperial_date,3,1)
       move $Year_in_era to #Year_in_era
       move #Year_in_era to $object_year_in_era 09
    else
       let $object_year_in_era = substr($Imperial_date,3,2)
    end-if

end-procedure !Calc-Date2

!***********************************************************************
!                                                                      *
! Build-Withh-select                                                   *
!                                                                      *
!                                                                      *
! Called By:    Withholding-Report                                     *
!                                                                      *
! Description:  Build dynamic select statement for the Withholding     *
!               Report                                                 *
!                                                                      *
!***********************************************************************
begin-procedure Build-Withh-select


     move '' to $Slct_Payent

     if $Rc_pay_entity <> ''
        concat 'AND A.CAL_RUN_ID IN (SELECT DISTINCT(CAL_RUN_ID) FROM PS_GP_CAL_RUN_DTL WHERE PAY_ENTITY = ' with  $Slct_Payent
        concat   '''' with $Slct_Payent
        concat  $Rc_pay_entity with  $Slct_Payent
        concat   ''') ' with $Slct_Payent
     end-if

     move '' to $SlctDept

     if $Rc_deptid <> ''
        concat 'AND A.DEPTID = ' with  $SlctDept
        concat   '''' with $SlctDept
        concat  $Rc_deptid with  $SlctDept
        concat '''' with $SlctDept
        concat 'AND A.BUSINESS_UNIT = ' with  $SlctDept
        concat   '''' with $SlctDept
        concat  $Rc_business_unit with  $SlctDept
        concat   ''' ' with $SlctDept
     Else
       if $Rc_business_unit <> ''
        concat 'AND A.BUSINESS_UNIT = ' with  $SlctDept
        concat   '''' with $SlctDept
        concat  $Rc_business_unit with  $SlctDept
        concat   ''' ' with $SlctDept
       end-if
     end-if

     move '' to $Slct_location

     if $Rc_location <> ''
        concat 'AND A.LOCATION = ' with  $Slct_location
        concat   '''' with $Slct_location
        concat  $Rc_location with  $Slct_location
        concat   ''' ' with $Slct_location
     end-if

     move '' to $Slct_emplid


     if $Rc_emplid <> ''

        concat 'AND A.EMPLID = ' with  $Slct_emplid
        concat   '''' with $Slct_emplid
        concat  $Rc_emplid with  $Slct_emplid
        concat   ''' ' with $Slct_emplid
     end-if




     move '' to $Slct_calgid

    if $Rc_cal_run_id <> 'Calendar'
       concat 'AND A.CAL_RUN_ID = ' with  $Slct_calgid
       concat   '''' with $Slct_calgid
       concat  $Rc_cal_run_id with  $Slct_calgid
       concat   ''' ' with $Slct_calgid
       concat 'AND A.GPJP_PROCESS = ''T'' ' with $Slct_calgid
    end-if

     move '' to $Slct_dateyv

    if $Rc_cal_run_id = 'Calendar'
       concat 'AND A.DATE_YEAR_VAL = ' with  $Slct_dateyv
       concat  $Rc_date_year_val with  $Slct_dateyv
    end-if


end-procedure  !Build-Withh-select

!***********************************************************************
!                                                                      *
! Build-Wage-select                                                    *
!                                                                      *
!                                                                      *
! Called By:    Wage-Payment-Report                                    *
!                                                                      *
! Description:  Build dynamic select statement for the Wage Payment    *
!               Report                                                 *
!                                                                      *
!***********************************************************************
begin-procedure Build-Wage-select


     move '' to $Slct_Municipal_cd    
        
    
  

     move '' to $Slct_Recipient
     move '' to $Slct_Recipient1

     if $Rc_gpjp_recipient <> ''
        concat 'AND B.GPJP_RECIPIENT_NBR = ' with  $Slct_Recipient
        concat   '''' with $Slct_Recipient
        concat  $Rc_gpjp_recipient  with $Slct_Recipient
        concat   ''' ' with $Slct_Recipient
        
        concat 'AND B1.GPJP_RECIPIENT_NBR = ' with  $Slct_Recipient1
        concat   '''' with $Slct_Recipient1
        concat  $Rc_gpjp_recipient  with $Slct_Recipient1
        concat   ''' ' with $Slct_Recipient1
     end-if

     move '' to $Slct_Order_by

     if $Rc_municipal_cd = ''
        concat 'ORDER BY B.MUNICIPAL_CD_JPN,B.GPJP_RECIPIENT_NBR' with  $Slct_Order_by
     else
        if $Rc_gpjp_recipient = ''
           concat 'ORDER BY C.GPJP_MUNC_RPT_CD, B1.GPJP_RECIPIENT_NBR' with  $Slct_Order_by
        end-if
     end-if


end-procedure  !Build-Wage-select

!***********************************************************************
!                                                                      *
! Print-Details                                                        *
!                                                                      *
!                                                                      *
! Called By:    Withholding-Report & Wage-Payment-Report               *
!                                                                      *
! Description:  Prints the detail lines                                *
!                                                                      *
!***********************************************************************
begin-procedure Print-Details

If $Gpjp_yea_trmdth = '1'
  Let $reason = 'DEA'
end-if

           if $First_print = 'Y'
              do Get-Personal-Data
           end-if

           print $object_year_in_era    (0,38,2)  point-size = 11
           print $object_year_in_era    (0,162,2) point-size = 11

           print $gpjp_recipient_nbr    (+2,84,11)                      !(2)
           print $gpjp_recipient_nbr    (0,206,11)                      !(2)

           let $Pers_address1 = substrp($Gpjp_yea_fladdr,1,{PERS_ADDR_LEN})
           let #strlen = lengthp($Pers_address1)
           let $Pers_address2 = substrp($Gpjp_yea_fladdr,#strlen + 1,{PERS_ADDR_LEN})
           let #strlen = {PERS_ADDR_LEN}+2

           print $Pers_address1         (+1,14,#strlen)                 !(1)
           print $Pers_address1         (0,138,#strlen)                 !(1)

           print $Pers_address2         (+1,14,#strlen)                 !(1)
           print $Pers_address2         (0,138,#strlen)                 !(1)

           print $Name_ac               (+1,84,50)                       !(3)
           print $Name_ac               (0,206,50)                       !(3)

           do Get-Setid ($Business_unit, 'SUPVSR_LVL_TBL', $Setid_dept)
           do Get-Supvlvl-Name

           print $SupvlvlName           (+2,84,30)                      !(5)
           print $SupvlvlName           (0,206,30)                      !(5)
           print $Name                  (+1,84,50)                      !(4)
           print $Name                  (0,206,50)                      !(4)

           print $GPJPYE01_Sal_bonus    (+4,6,15)                       !(6)
           print $GPJPYE01_Sal_bonus    (0,129,15)                      !(6)

           move #Gpjp_it_earns to $Gpjp_it_earns 999999999999
           let $It_earns = substr($Gpjp_it_earns,1,12)

           print $It_earns              (0,17,15) edit xxxbxxxbxxxbxxx point-size = 12 !(7)
           print $It_earns              (0,142,15) edit xxxbxxxbxxxbxxx point-size = 12 !(7)

           if $Gpjp_yea_type = '10'
             print #Gpjp_yea_incaft       (0,44,15)  edit 999999999990 point-size = 12 !(8)
             print #Gpjp_yea_incaft       (0,168,15) edit 999999999990 point-size = 12 !(8)
             print #Gpjp_yea_yeaded       (0,65,15)  edit 999999999990 point-size = 12 !(9)
             print #Gpjp_yea_yeaded       (0,189,15) edit 999999999990 point-size = 12 !(9)
           end-if

           print #Gpjp_it_inctax        (0,85,15) edit 999999999999 point-size = 12 !(10)
           print #Gpjp_it_inctax        (0,210,15) edit 999999999999 point-size = 12 !(10)

           print #Gpjp_yea_mutaid       (+6,66,9) edit 99999999B     !(18a)
           print #Gpjp_yea_mutaid       (0,190,9) edit 99999999B     !(18a)

           if $Gpjp_yea_type <> '10'
              print ' '                    (+1,17,11)
           else
              print #Gpjp_yea_spsded       (+1,18,9) edit 999999990     !(12)
              print #Gpjp_yea_spsded       (0,143,9) edit 999999990     !(12)
           end-if


           if $Gpjp_yea_otsu = '1'
              print #Gpjp_yea_depspc       (0,33,2) edit 90                !(13-2)
              print #Gpjp_yea_depspc       (0,158,2) edit 90               !(13-2)
              print #Gpjp_yea_depeld       (0,44,2) edit 90                !(14-2)
              print #Gpjp_yea_depeld       (0,169,2) edit 90               !(14-2)
              print #Gpjp_yea_depoth       (0,52,2) edit 90                !(15-2)
              print #Gpjp_yea_depoth       (0,176,2) edit 90               !(15-2)

           else

                    print #Gpjp_yea_depspc       (0,29,2) edit 90          !(13-1)
                    print #Gpjp_yea_depspc       (0,154,2) edit 90         !(13-1)
                    print #Gpjp_yea_liveld       (0,37,2) edit 90          !(13a)
                    print #Gpjp_yea_liveld       (0,162,2) edit 90         !(13a)
                    print #Gpjp_yea_depeld       (0,40,2) edit 90          !(14-1)
                    print #Gpjp_yea_depeld       (0,165,2) edit 90         !(14-1)
                    print #Gpjp_yea_depoth       (0,48,2) edit 90          !(15-1)
                    print #Gpjp_yea_depoth       (0,172,2) edit 90         !(15-1)
                    print #Gpjp_yea_disliv       (0,55,2) edit 90          !(16)
                    print #Gpjp_yea_disliv       (0,180,2) edit 90         !(16)
                    print #Gpjp_yea_disspc       (0,58,2) edit 90          !(16a)
                    print #Gpjp_yea_disspc       (0,183,2) edit 90         !(16a)
                    print #Gpjp_yea_disoth       (0,62,2) edit 90          !(17)
                    print #Gpjp_yea_disoth       (0,187,2) edit 90         !(17)
           end-if

           print #Gpjp_amount18         (0,66,9) edit 999999990         !(18)
           print #Gpjp_amount18         (0,190,9) edit 999999990        !(18)
           print #Gpjp_yea_lifpre       (0,77,9) edit 99999999B         !(19)
           print #Gpjp_yea_lifpre       (0,202,9) edit 99999999B        !(19)
           print #Gpjp_yea_nonlif       (0,88,8) edit  9999999B         !(20)
           print #Gpjp_yea_nonlif       (0,213,8) edit  9999999B        !(20)
           print #Gpjp_yea_house        (0,98,9) edit 99999999B         !(21)
           print #Gpjp_yea_house        (0,223,9) edit 99999999B        !(21)

           if $Gpjp_yea_dedspo = '1'
              if $Gpjp_yea_otsu = '1'
                   print 'o'       (0,9,1)                         !(11)
                   print 'o'       (0,134,1)                       !(11)
              else
                   print 'o'       (0,2,1)                         !(11)
                   print 'o'       (0,127,1)                       !(11)
              end-if
           else
              if $Gpjp_yea_otsu = '1'
                   print 'o'       (0,13,1)                        !(11)
                   print 'o'       (0,138,1)                       !(11)
              else
                   print 'o'       (0,6,1)                         !(11)
                   print 'o'       (0,130,1)                       !(11)
              end-if
           end-if
           if $Gpjp_yea_dedels = '1'
                 print 'o'       (0,17,1)                          !(11)
                 print 'o'       (0,141,1)                         !(11)
           end-if


           let $Yeasumm1 = substrp($Gpjp_yea_summ,1,{SUMLEN})
           let #strlen = lengthp($Yeasumm1)
           let $Yeasumm2 = substrp($Gpjp_yea_summ,#strlen + 1,{SUMLEN})
           let #strlen = #strlen + lengthp($Yeasumm2)
           let $Yeasumm3 = substrp($Gpjp_yea_summ,#strlen + 1,{SUMLEN})
           let #strlen = {SUMLEN}+2

  ! Starting 2007, Deductible Housing Loan amount is printed on the column for Special Tax Reduction
           if $Gpjp_yea_type = '10'
             print #Gpjp_yea_natpen       (+1,67,15) edit 99999999999B
             print #Gpjp_yea_natpen       (0,192,15) edit 99999999999B
             print #Gpjp_yea_spctax       (0,20,15)  edit 99999999999B
             print #Gpjp_yea_spctax       (0,144,15) edit 99999999999B
             print #Gpjp_Yea_Carpre       (0,94,12) edit 99999999999B      ! Care Medical Insurance Premium
             print #Gpjp_Yea_Carpre       (0,219,12) edit 99999999999B     ! Care Medical Insurance Premium
             !print #Gpjp_yea_spsinc       (0,95,12) edit 999999999990     !(23)
             !print #Gpjp_yea_spsinc       (0,217,12) edit 999999999990    !(23)
             position (+1)
           else
             position (+1)
             print #Gpjp_Yea_Carpre       (0,94,12) edit 99999999999B      ! Care Medical Insurance Premium
             print #Gpjp_Yea_Carpre       (0,219,12) edit 99999999999B     ! Care Medical Insurance Premium
             position (+1)
           end-if

           
           let #Res_start_yy = substr($Gpjp_res_chrdt7_1,2,2)
           let #Res_start_mm = substr($Gpjp_res_chrdt7_1,4,2)
           let #Res_start_dd = substr($Gpjp_res_chrdt7_1,6,2)
           move #Res_start_yy to $Res_start_yy 99
           move #Res_start_mm to $Res_start_mm 99
           move #Res_start_dd to $Res_start_dd 99
           let $Res_start_eyymmdd = 'H' || ltrim($Res_start_yy,' ') || '.' || ltrim($Res_start_mm,' ')
             || '.' || ltrim($Res_start_dd,' ')
           
           if NOT IsBlank($Gpjp_res_chrdt7_1)
            print $Res_start_eyymmdd     (+1,19,9)
            print $Res_start_eyymmdd     (0,141,9)
           end-if
 
           if $Gpjp_yea_type = '10'
             print #Gpjp_yea_spsinc       (0,67,12) edit 99999999999B     !(23)
             print #Gpjp_yea_spsinc       (0,192,12) edit 99999999999B    !(23)
           end-if
           
           print #Gpjp_Yea_Penpre1       (0,94,12) edit 99999999999B      ! New Pension Insurance Premium
           print #Gpjp_Yea_Penpre1       (0,219,12) edit 99999999999B     ! New Pension Insurance Premium
           
           !print #Gpjp_yea_penpre       (0,94,12) edit 99999999999B       !(24)
           !print #Gpjp_yea_penpre       (0,216,12) edit 99999999999B      !(24)

           print $Yeasumm1              (+1,5,#strlen)                    !(22)
           print $Yeasumm1              (0,129,#strlen)                   !(22)
           
           print $Yeasumm2              (+1,5,#strlen)                    !(22)
           print $Yeasumm2              (0,129,#strlen)                   !(22)
           
           print #Gpjp_Yea_Lifpreac1    (0,67,12) edit 99999999999B       ! New Life Insurance Premium
           print #Gpjp_Yea_Lifpreac1    (0,192,12) edit 99999999999B      ! New Life Insurance Premium
           
           print #Gpjp_yea_penpre       (0,94,12) edit 99999999999B       !(24)
           print #Gpjp_yea_penpre       (0,219,12) edit 99999999999B      !(24)
           
           print $Yeasumm3              (+1,5,#strlen)                    !(22)
           print $Yeasumm3              (0,129,#strlen)                   !(22)
           
           print #Gpjp_Yea_Lifpreac       (0,67,12) edit 99999999999B     ! Old Life Insurance Premium
           print #Gpjp_Yea_Lifpreac       (0,192,12) edit 99999999999B    ! Old Life Insurance Premium
     
           print #Gpjp_yea_ltnonl       (0,94,12) edit 99999999999B       !(25)
           print #Gpjp_yea_ltnonl       (0,219,12) edit 99999999999B      !(25)


           if #Gpjp_yea_hirmid = 1
              print 'o'                 (+5,58,1)                       !(37)
              print $Middt_Year_in_era  (0,66,2)                        !(37)
              print $Middt_Month        (0,71,2)                        !(37)
              print $Middt_Day          (0,76,2)                        !(37)
              print 'o'                 (0,183,1)                       !(37)
              print $Middt_Year_in_era  (0,191,2)                       !(37)
              print $Middt_Month        (0,196,2)                       !(37)
              print $Middt_Day          (0,200,2)                       !(37)
           else
              if #Gpjp_yea_hirmid = 2
                 print 'o'              (+5,63,1)                       !(37)
                 print $Middt_Year_in_era  (0,66,2)                     !(37)
                 print $Middt_Month     (0,71,2)                        !(37)
                 print $Middt_Day       (0,76,2)                        !(37)
                 print 'o'              (0,187,1)                       !(37)
                 print $Middt_Year_in_era  (0,191,2)                    !(37)
                 print $Middt_Month     (0,196,2)                       !(37)
                 print $Middt_Day       (0,200,2)                       !(37)
              else
                 print ' '              (+5,60,1)
              end-if
           end-if


           if $Gpjp_yea_bdtera = '1'
              print 'o'                 (0,80,1)                        !(38)
              print 'o'                 (0,205,1)                       !(38)
           else
             if $Gpjp_yea_bdtera = '2'
                print 'o'               (0,85,1)                        !(38)
                print 'o'               (0,210,1)                       !(38)
             else
                if $Gpjp_yea_bdtera = '3'
                   print 'o'            (0,90,1)                        !(38)
                   print 'o'            (0,214,1)                       !(38)
                else
                   print 'o'            (0,94,1)                        !(38)
                   print 'o'            (0,219,1)                       !(38)
                end-if
             end-if
           end-if

          print $Print_year_in_era      (0,98,2)                        !(38)
          print $Print_year_in_era      (0,223,2)                       !(38)
          print $Print_month            (0,103,2)                       !(38)
          print $Print_month            (0,227,2)                       !(38)
          print $Print_day              (0,107,2)                       !(38)
          print $Print_day              (0,232,2)                       !(38)

          print #Gpjp_yea_depjuv        (+1,2,1)                        !26
          print #Gpjp_yea_depjuv        (0,126,1)                       !26

           if #Gpjp_yea_minor = 1
              print 'o'                 (0,7,1)                         !(27)
              print 'o'                 (0,132,1)                       !(27)
           end-if

           if $Gpjp_yea_forgn = '1'
              print 'o'                 (0,12,1)                        !(36)
              print 'o'                 (0,136,1)                       !(36)
           end-if

           if $Gpjp_yea_trmdth = '1'
              print 'o'                 (0,16,1)                        !(34)
              print 'o'                 (0,140,1)                       !(34)
           end-if

           if $Gpjp_yea_otsu = '1'
              print 'o'                 (0,25,1)                        !(28)
              print 'o'                 (0,150,1)                       !(28)
           end-if

           if $Gpjp_yea_disfl1 = '1'
              print 'o'                 (0,29,1)                        !(29)
              print 'o'                 (0,154,1)                       !(29)
           end-if

           if $Gpjp_yea_disfl2 = '1'
              print 'o'                 (0,34,1)                        !(29)
              print 'o'                 (0,159,1)                       !(29)
           end-if

           if $Gpjp_yea_widow = '1'
              print 'o'                 (0,39,1)                        !(31)
              print 'o'                 (0,164,1)                       !(31)
           else
              if $Gpjp_yea_widow = '2'
                 print 'o'              (0,43,1)                        !(31)
                 print 'o'              (0,168,1)                       !(31)
              end-if
           end-if

           if $Gpjp_yea_wdwer = '1'
              print 'o'                 (0,49,1)                        !(32)
              print 'o'                 (0,173,1)                       !(32)
           end-if

           if $Gpjp_yea_wrkstd = '1'
              print 'o'                 (0,54,1)                        !(33)
              print 'o'                 (0,177,1)                       !(33)
           end-if

          let $Estab_address1 = substrp($Gpjp_yea_fladdr1,1,{ESTAB_ADDR_LEN})
          let #strlen = lengthp($Estab_address1)
          let $Estab_address2 = substrp($Gpjp_yea_fladdr1,#strlen + 1,{ESTAB_ADDR_LEN})
          let #strlen = {ESTAB_ADDR_LEN}+2

          print $Estab_address1         (+2,25,#strlen)                 !(39)
          print $Estab_address1         (0,147,#strlen)                 !(39)
          print $Estab_address2         (+1,25,#strlen)             !(39)
          print $Estab_address2         (0,147,#strlen)             !(39)
          print $EstabName              (+3,25,50)                      !(40)
          print $EstabName              (0,147,50)                      !(40)
          print $Phone                  (+1,83,24)                      !(41)
          print $Phone                  (0,205,24)                      !(41)


end-procedure  !Print-Details


!***********************************************************************
!                                                                      *
! Get-Personal-Data                                                    *
!                                                                      *
!                                                                      *
! Called By:    Print-Details                                          *
!                                                                      *
! Description:  Reads Personal Data table to get Employee Name         *
!                                                                      *
!***********************************************************************
begin-procedure Get-Personal-Data

let $Name = ' '

begin-select
NM.EMPLID
NM.NAME_FORMAL
NM.NAME_AC

     let $Name    = &NM.Name_Formal
     let $Name_ac = &NM.Name_ac

FROM  PS_PERSON_NAME NM
WHERE NM.EMPLID         = $Emplid

end-select

end-procedure !Get-Personal-Data

!***********************************************************************
!                                                                      *
! Get-Translatable-Data                                                *
!                                                                      *
!                                                                      *
! Called By:    Print-Details-New                                      *
!                                                                      *
! Description:  Gets the translatable text from the strings table      *
!                                                                      *
!***********************************************************************
begin-procedure Get-Translatable-Data ($PROGRAM_ID, $STRING_ID, :$String_Text)

let $String_Text = ' '

begin-select
ST.STRING_TEXT

     let $String_Text    = &ST.String_Text


FROM  PS_STRINGS_TBL ST
WHERE ST.PROGRAM_ID         = $PROGRAM_ID
AND   ST.STRING_ID         =  $STRING_ID
end-select

end-procedure !Get-Translatable-Data
!***********************************************************************
!                                                                      *
! Print-Details-New-Withholding-Report                                 *
!                                                                      *
!                                                                      *
! Called By:    Withholding-Report                                     *
!                                                                      *
! Description:  Prints the detail lines                                *
!                                                                      *
!***********************************************************************
begin-procedure Print-Details-New-Withholding-Report

If $Gpjp_yea_trmdth = '1'
  Let $reason = 'DEA'
end-if


           do Get-Personal-Data

           print $object_year_in_era    (+2,39,2)  point-size = 11
           print $object_year_in_era    (0,156,2)  point-size = 11

           if $RC_Print_Asgn_Nbr='Y'
              print $gpjp_recipient_nbr    (+2,84,11)  !A                
              print $gpjp_recipient_nbr    (0,206,11)  !A                 
           else
              position (+2)
           end-if

           let $Pers_address1 = substrp($Gpjp_yea_fladdr,1,{PERS_ADDR_LEN})
           let #strlen = lengthp($Pers_address1)
           let $Pers_address2 = substrp($Gpjp_yea_fladdr,#strlen + 1,{PERS_ADDR_LEN})
           let #strlen = {PERS_ADDR_LEN}+2

           print $Pers_address1         (+3,19,#strlen)       !A       
           print $Pers_address1         (0,135,#strlen)       !A        

           print $Pers_address2         (+2,19,#strlen)       !A      
           print $Pers_address2         (0,135,#strlen)       !A
      

           !Payee personal number
           let $EE_Pers_Nbr = ' '
           if $RC_Print_Pers_Nbr = 'Y'
             if $JPN-Personal-Nbr-Installed='Y'
                do Get_Pers_Nbr2($Emplid,' ',$EE_Pers_Nbr)   !gpjppnbr.sqc
             end-if          
           end-if
        
           print $EE_Pers_Nbr           (-2,198,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8     !###PersonalNumber###
               

           do Get-Setid ($Business_unit, 'SUPVSR_LVL_TBL', $Setid_dept)
           do Get-Supvlvl-Name

           print $SupvlvlName           (+2,84,30)    !A  !2           
           print $SupvlvlName           (0,206,30)    !A  !2          

           print $Name_ac               (+2,84,50)    !A  !2             
           print $Name_ac               (0,206,50)    !A  !2             

           print $Name                  (+1,84,50)    !A  !2             
           print $Name                  (0,206,50)    !A  !2             

           print $GPJPYE01_Sal_bonus    (+3,10,15)    !A                 
           print $GPJPYE01_Sal_bonus    (0,129,15)    !A                

           move #Gpjp_it_earns to $Gpjp_it_earns 999999999999
           let $It_earns = substr($Gpjp_it_earns,1,12)

           print $It_earns              (0,20,15)  edit xxxbxxxbxxxbxxx point-size = 12 !A
           print $It_earns              (0,136,15) edit xxxbxxxbxxxbxxx point-size = 12 !A

           print #Gpjp_yea_incaft       (0,48,15)  edit 999999999990 point-size = 12    !A
           print #Gpjp_yea_incaft       (0,164,15) edit 999999999990 point-size = 12    !A
           print #Gpjp_yea_yeaded       (0,69,15)  edit 999999999990 point-size = 12    !A
           print #Gpjp_yea_yeaded       (0,185,15) edit 999999999990 point-size = 12    !A

           print #Gpjp_it_inctax        (0,89,15)  edit 999999999999 point-size = 12    !A
           print #Gpjp_it_inctax        (0,205,15) edit 999999999999 point-size = 12    !A

           print #Gpjp_yea_spsded       (+8,25,9)  edit 999999990   point-size = 10     !A
           print #Gpjp_yea_spsded       (0,141,9)  edit 999999990   point-size = 10     !A 

           print #Gpjp_yea_mutaid       (+4,13,9)  edit 99999999B   point-size = 10     !B
           print #Gpjp_yea_mutaid       (0,130,9)  edit 99999999B   point-size = 10     !B


             

           if $Gpjp_yea_otsu = '1'
              print #Gpjp_yea_depspc       (-4,50,2) edit 90    !A           
              print #Gpjp_yea_depspc       (0,166,2) edit 90    !A         
              print #Gpjp_yea_depeld       (0,67,2)  edit 90    !A           
              print #Gpjp_yea_depeld       (0,182,2) edit 90    !A          
              print #Gpjp_yea_depoth       (0,77,2)  edit 90    !A            
              print #Gpjp_yea_depoth       (0,194,2) edit 90    !A          

           else

                    print #Gpjp_yea_depspc       (-4,44,2) edit 90    !A     
                    print #Gpjp_yea_depspc       (0,162,2) edit 90    !A    
                    print #Gpjp_yea_liveld       (0,56,2)  edit 90    !A      
                    print #Gpjp_yea_liveld       (0,172,2) edit 90    !A     
                    print #Gpjp_yea_depeld       (0,60,2)  edit 90    !A      
                    print #Gpjp_yea_depeld       (0,175,2) edit 90    !A     
                    print #Gpjp_yea_depoth       (0,72,2)  edit 90    !A      
                    print #Gpjp_yea_depoth       (0,188,2) edit 90    !A    
                    print #Gpjp_yea_disliv       (0,91,2)  edit 90    !A      
                    print #Gpjp_yea_disliv       (0,207,2) edit 90    !A     
                    print #Gpjp_yea_disspc       (0,97,2)  edit 90    !A    
                    print #Gpjp_yea_disspc       (0,212,2) edit 90    !A   
                    print #Gpjp_yea_disoth       (0,104,2) edit 90    !A    
                    print #Gpjp_yea_disoth       (0,219,2) edit 90    !A   
           end-if

           print #Gpjp_yea_depjuv        (0,85,1)    !A                     !4
           print #Gpjp_yea_depjuv        (0,200,1)   !A                     !4

           print  #Gpjp_yea_dep_nrsd        (0,111,2)!A      !###Number of Non-Resident Kin###
           print  #Gpjp_yea_dep_nrsd        (0,227,2)!A                       

           print #Gpjp_amount18        (+6,13,9) edit 999999990 point-size = 10 !B        
           print #Gpjp_amount18        (0,130,9) edit 999999990 point-size = 10 !B       
           print #Gpjp_yea_lifpre      (0,40,9)  edit 99999999B point-size = 10 !B     
           print #Gpjp_yea_lifpre      (0,155,9) edit 99999999B point-size = 10 !B      
           print #Gpjp_yea_nonlif      (0,67,8)  edit 9999999B  point-size = 10 !B       
           print #Gpjp_yea_nonlif      (0,184,8) edit 9999999B  point-size = 10 !B       
           print #Gpjp_yea_house       (0,95,9)  edit 99999999B point-size = 10 !B       
           print #Gpjp_yea_house       (0,211,9) edit 99999999B point-size = 10 !B      

           position (-6)
           if $Gpjp_yea_dedspo = '1'
              if $Gpjp_yea_otsu = '1'
                  print 'o'       (0,11,1)  !A !3                      
                  print 'o'       (0,127,1) !A !3                     
              else
                  print 'o'       (0,16,1)  !A !3                     
                  print 'o'       (0,134,1) !A !3                     
              end-if
           end-if
           if $Gpjp_yea_dedels = '1'
                 print 'o'       (0,22,1)   !A !3                  
                 print 'o'       (0,139,1)  !A !3                  
           end-if
  
  position (+8) 

  print #Gpjp_Yea_Lifpreac1    (+8,18,12) edit 99999999999B      !6  ! New Life Insurance Premium
  print #Gpjp_Yea_Lifpreac1    (0,134,12) edit 99999999999B      !6  ! New Life Insurance Premium

  print #Gpjp_Yea_Lifpreac     (0,38,12) edit 99999999999B    !7  ! Old Life Insurance Premium
  print #Gpjp_Yea_Lifpreac     (0,154,12) edit 99999999999B   !7  ! Old Life Insurance Premium

  print #Gpjp_Yea_Carpre       (0,58,12) edit 99999999999B   !8    ! Care Medical Insurance Premium
  print #Gpjp_Yea_Carpre       (0,174,12) edit 99999999999B  !8    ! Care Medical Insurance Premium

  print #Gpjp_Yea_Penpre1       (0,78,12) edit 99999999999B     !9 ! New Pension Insurance Premium
  print #Gpjp_Yea_Penpre1       (0,194,12) edit 99999999999B    !9 ! New Pension Insurance Premium


  print #Gpjp_yea_penpre       (0,98,12) edit 99999999999B    !10   
  print #Gpjp_yea_penpre       (0,214,12) edit 99999999999B   !10   


  print #Gpjp_no_house_loan       (+3,14,12) edit 99999999999B    !11   
  print #Gpjp_no_house_loan       (0,130,12) edit 99999999999B   !11


   let #Res_start_yy = substr($Gpjp_res_chrdt7_1,2,2)
           let #Res_start_mm = substr($Gpjp_res_chrdt7_1,4,2)
           let #Res_start_dd = substr($Gpjp_res_chrdt7_1,6,2)
           move #Res_start_yy to $Res_start_yy 99
           move #Res_start_mm to $Res_start_mm 99
           move #Res_start_dd to $Res_start_dd 99
           let $Res_start_eyymmdd = 'H' || ltrim($Res_start_yy,' ') || '    ' || ltrim($Res_start_mm,' ')
             || '   ' || ltrim($Res_start_dd,' ')
           
           if NOT IsBlank($Gpjp_res_chrdt7_1)
            print $Res_start_eyymmdd     (0,47,12)   !12
            print $Res_start_eyymmdd     (0,162,12)  !12
           end-if



  print $Gpjp_app_class1       (0,64,12) edit 99999999999B    !13   
  print $Gpjp_app_class1       (0,180,12) edit 99999999999B   !13


  print #Gpjp_payable_loan1       (0,91,12) edit 99999999999B    !14   
  print #Gpjp_payable_loan1       (0,206,12) edit 99999999999B   !14


  print #Gpjp_yea_spctax       (+2,18,12) edit 99999999999B   !15   
  print #Gpjp_yea_spctax       (0,134,12) edit 99999999999B   !15


 let #Res_start_yy2 = substr($Gpjp_res_chrdt7_2,2,2)
           let #Res_start_mm2 = substr($Gpjp_res_chrdt7_2,4,2)
           let #Res_start_dd2 = substr($Gpjp_res_chrdt7_2,6,2)
           move #Res_start_yy2 to $Res_start_yy2 99
           move #Res_start_mm2 to $Res_start_mm2 99
           move #Res_start_dd2 to $Res_start_dd2 99
           let $Res_start_eyymmdd2 = 'H' || ltrim($Res_start_yy2,' ') || '    ' || ltrim($Res_start_mm2,' ')
             || '   ' || ltrim($Res_start_dd2,' ')
           
           if NOT IsBlank($Gpjp_res_chrdt7_2)
            print $Res_start_eyymmdd2     (0,47,12)   !16
            print $Res_start_eyymmdd2     (0,162,12)  !16
           end-if


  print $Gpjp_app_class2       (0,64,12) edit 99999999999B    !17   
  print $Gpjp_app_class2       (0,180,12) edit 99999999999B   !17  

  print #Gpjp_payable_loan2    (0,91,12) edit 99999999999B    !18   
  print #Gpjp_payable_loan2    (0,206,12) edit 99999999999B   !18


  print #Gpjp_yea_spsinc       (+4,58,12) edit 99999999999B    !21   
  print #Gpjp_yea_spsinc       (0,174,12) edit 99999999999B    !21

  print #Gpjp_yea_natpen       (0,78,12) edit 99999999999B    !22   
  print #Gpjp_yea_natpen       (0,194,12) edit 99999999999B   !22

  print #Gpjp_yea_ltnonl       (0,98,12) edit 99999999999B    !23   
  print #Gpjp_yea_ltnonl       (0,214,12) edit 99999999999B   !23

  do Get-Translatable-Data ('GPJPYEA', 'JUVENILE', $Juvenile)
  do Get-Translatable-Data ('GPJPYE01', 'NON RESIDENT', $Non_Resident) 
  do Print-Dependent-Data-Withholding-Report

  concat  $Gpjp_yea_summ_new with  $Dep_Description

           let $Yeasumm1 = substrp($Dep_Description,1,80)
           let #strlen = lengthp($Yeasumm1)
           let $Yeasumm2 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm2)
           let $Yeasumm3 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm3)
           let $Yeasumm4 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm4)
           let $Yeasumm5 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm5)
           let $Yeasumm6 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = 90 


  print $Yeasumm1            (35,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm1            (35,126,#strlen)
      
  print $Yeasumm2            (36,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm2            (36,126,#strlen)

  print $Yeasumm3            (37,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm3            (37,126,#strlen)

  
  print $Yeasumm4            (38,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm4            (38,126,#strlen)

  print $Yeasumm5            (39,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm5            (39,126,#strlen)

  print $Yeasumm6            (40,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm6            (40,126,#strlen)
           
           if #Gpjp_yea_hirmid = 1
              print 'o'                 (80,56,1)                       !12
              print $Middt_Year_in_era  (0,65,2)                        !14
              print $Middt_Month        (0,70,2)                        !15
              print $Middt_Day          (0,75,2)                        !16
              print 'o'                 (0,176,1)                      
              print $Middt_Year_in_era  (0,186,2)                      
              print $Middt_Month        (0,190,2)                      
              print $Middt_Day          (0,195,2)                      
           else
              if #Gpjp_yea_hirmid = 2
                 print 'o'                (80,61,1)                     !13              
                 print $Middt_Year_in_era (0,65,2)                       !14
                 print $Middt_Month       (0,70,2)                       !15
                 print $Middt_Day         (0,75,2)                       !16
                 print 'o'                (0,181,1)                      
                 print $Middt_Year_in_era (0,186,2)                  
                 print $Middt_Month       (0,190,2)                      
                 print $Middt_Day         (0,195,2)                     
              else
                 print ' '                (80,60,1)
              end-if
           end-if


           if $Gpjp_yea_bdtera = '1'
              print 'o'                 (0,84,1)                        !17
              print 'o'                 (0,201,1)                       !17
           else
             if $Gpjp_yea_bdtera = '2'
                print 'o'               (0,89,1)                        !18
                print 'o'               (0,205,1)                       !18
             else
                if $Gpjp_yea_bdtera = '3'
                   print 'o'            (0,93,1)                        !19
                   print 'o'            (0,209,1)                       !19
                else
                   print 'o'            (0,98,1)                        !20
                   print 'o'            (0,214,1)                       !20
                end-if
             end-if
           end-if

          print $Print_year_in_era      (0,102,2)                       !21
          print $Print_year_in_era      (0,218,2)                       !21
          print $Print_month            (0,107,2)                       !22
          print $Print_month            (0,223,2)                       !22
          print $Print_day              (0,112,2)                       !23
          print $Print_day              (0,228,2)                       !23

  

           if #Gpjp_yea_minor = 1
              print 'o'                 (0,11,1)                         !1
              print 'o'                 (0,128,1)                       !1
           end-if

           if $Gpjp_yea_forgn = '1'
              print 'o'                 (0,15,1)                        !2
              print 'o'                 (0,131,1)                       !2
           end-if

           if $Gpjp_yea_trmdth = '1'
              print 'o'                 (0,19,1)                        !3
              print 'o'                 (0,135,1)                       !3
           end-if

           if $Gpjp_yea_otsu = '1'
              print 'o'                 (0,28,1)                        !5
              print 'o'                 (0,143,1)                       !5
           end-if

           if $Gpjp_yea_disfl1 = '1'
              print 'o'                 (0,33,1)                        !6
              print 'o'                 (0,147,1)                       !6
           end-if

           if $Gpjp_yea_disfl2 = '1'
              print 'o'                 (0,37,1)                        !7
              print 'o'                 (0,151,1)                       !7
           end-if

           if $Gpjp_yea_widow = '1'
              print 'o'                 (0,42,1)                        !8
              print 'o'                 (0,157,1)                       !8
           else
              if $Gpjp_yea_widow = '2'
                 print 'o'              (0,46,1)                        !9
                 print 'o'              (0,161,1)                       !9
              end-if
           end-if

           if $Gpjp_yea_wdwer = '1'
              print 'o'                 (0,50,1)                        !10
              print 'o'                 (0,166,1)                       !10
           end-if

           if $Gpjp_yea_wrkstd = '1'
              print 'o'                 (0,55,1)                        !11
              print 'o'                 (0,172,1)                       !11
           end-if

          let $Estab_address1 = substrp($Gpjp_yea_fladdr1,1,{ESTAB_ADDR_LEN})
          let #strlen = lengthp($Estab_address1)
          let $Estab_address2 = substrp($Gpjp_yea_fladdr1,#strlen + 1,{ESTAB_ADDR_LEN})
          let #strlen = {ESTAB_ADDR_LEN}+2


          if #Firm_Number > 0
          print #Firm_Number           (+3,143,30)   edit xbxbxbxbxbxbxbxbxbxbxbxbx  point-size = 8
          else
          position (+3)          
          end-if
          print $Estab_address1        (+2,27,#strlen)              
          print $Estab_address1         (0,145,#strlen)           
          print $Estab_address2        (+1,27,#strlen)       
          print $Estab_address2         (0,145,#strlen)        
          print $EstabName             (+2,27,50)                    
          print $EstabName              (0,145,50)                 
          print $Phone                 (0,85,24)                
          print $Phone                 (0,201,24)                


end-procedure  !Print-Details-New-Withholding-Report

!***********************************************************************
!                                                                      *
! Print-Details-New-Wage-Payment-Report                                *
!                                                                      *
!                                                                      *
! Called By:    Wage-Payment-Report                                    *
!                                                                      *
! Description:  Prints the detail lines                                *
!                                                                      *
!***********************************************************************
begin-procedure Print-Details-New-Wage-Payment-Report

If $Gpjp_yea_trmdth = '1'
  Let $reason = 'DEA'
end-if

           do Get-Personal-Data

           !print $object_year_in_era    (+2,39,2)  point-size = 11
           position (+2)
           print $gpjp_recipient_nbr    (+1,84,11)  !A                                


           let $Pers_address1 = substrp($Gpjp_yea_fladdr,1,{PERS_ADDR_LEN})
           let #strlen = lengthp($Pers_address1)
           let $Pers_address2 = substrp($Gpjp_yea_fladdr,#strlen + 1,{PERS_ADDR_LEN})
           let #strlen = {PERS_ADDR_LEN}+2

           print $Pers_address1         (+4,17,#strlen)       !A             
           print $Pers_address2         (+2,17,#strlen)       !A      
      

           !Payee personal number
           let $EE_Pers_Nbr = ' '
           
           if $JPN-Personal-Nbr-Installed='Y'
                do Get_Pers_Nbr2($Emplid,' ',$EE_Pers_Nbr)   !gpjppnbr.sqc
           end-if          
                  
           print $EE_Pers_Nbr           (-3,80,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8     !###PersonalNumber###
               
           do Get-Setid ($Business_unit, 'SUPVSR_LVL_TBL', $Setid_dept)
           do Get-Supvlvl-Name

           print $SupvlvlName           (+2,84,30)    !A  !2                     
           print $Name_ac               (+2,84,50)    !A  !2                        
           print $Name                  (+3,84,50)    !A  !2                         
           print $GPJPYE01_Sal_bonus    (+5,8,15)    !A                                 

           move #Gpjp_it_earns to $Gpjp_it_earns 999999999999
           let $It_earns = substr($Gpjp_it_earns,1,12)

           print $It_earns              (0,16,15)  edit xxxbxxxbxxxbxxx point-size = 12 !A
           print #Gpjp_yea_incaft       (0,44,15)  edit 999999999990 point-size = 12    !A
           print #Gpjp_yea_yeaded       (0,65,15)  edit 999999999990 point-size = 12    !A
           print #Gpjp_it_inctax        (0,85,15)  edit 999999999999 point-size = 12    !A
           print #Gpjp_yea_spsded       (+8,21,9)  edit 999999990   point-size = 10     !A
           print #Gpjp_yea_mutaid       (+4,09,9)  edit 99999999B   point-size = 10     !B
            
           if $Gpjp_yea_otsu = '1'
              print #Gpjp_yea_depspc       (-4,46,2) edit 90    !A                  
              print #Gpjp_yea_depeld       (0,63,2)  edit 90    !A                    
              print #Gpjp_yea_depoth       (0,73,2)  edit 90    !A                    
           else
              print #Gpjp_yea_depspc       (-4,40,2) edit 90    !A   
              print #Gpjp_yea_liveld       (0,52,2)  edit 90    !A                              
              print #Gpjp_yea_depeld       (0,56,2)  edit 90    !A                            
              print #Gpjp_yea_depoth       (0,68,2)  edit 90    !A                            
              print #Gpjp_yea_disliv       (0,87,2)  edit 90    !A                            
              print #Gpjp_yea_disspc       (0,93,2)  edit 90    !A                    
              print #Gpjp_yea_disoth       (0,100,2) edit 90    !A    
                    
           end-if

           print #Gpjp_yea_depjuv        (0,83,1)    !A                     !4          
           print  #Gpjp_yea_dep_nrsd        (0,109,2)!A      !###Number of Non-Resident Kin###                            
           print #Gpjp_amount18        (+6,11,9) edit 999999990 point-size = 10 !B                        
           print #Gpjp_yea_lifpre      (0,38,9)  edit 99999999B point-size = 10 !B                   
           print #Gpjp_yea_nonlif      (0,65,8)  edit 9999999B  point-size = 10 !B                      
           print #Gpjp_yea_house       (0,93,9)  edit 99999999B point-size = 10 !B       
           
           position (-6)
           if $Gpjp_yea_dedspo = '1'
              if $Gpjp_yea_otsu = '1'
                  print 'o'       (0,09,1)  !A !3                                                        
              else
                  print 'o'       (0,14,1)  !A !3                                                          
              end-if
           end-if
           if $Gpjp_yea_dedels = '1'
                 print 'o'       (0,20,1)   !A !3                                                   
           end-if
  
  position (+8) 

  print #Gpjp_Yea_Lifpreac1    (+8,15,12) edit 99999999999B      !6  ! New Life Insurance Premium  
  print #Gpjp_Yea_Lifpreac     (0,37,12) edit 99999999999B    !7  ! Old Life Insurance Premium  
  print #Gpjp_Yea_Carpre       (0,57,12) edit 99999999999B   !8    ! Care Medical Insurance Premium  
  print #Gpjp_Yea_Penpre1       (0,77,12) edit 99999999999B     !9 ! New Pension Insurance Premium 
  print #Gpjp_yea_penpre       (0,97,12) edit 99999999999B    !10     
  print #Gpjp_no_house_loan       (+3,14,12) edit 99999999999B    !11   
 
   let #Res_start_yy = substr($Gpjp_res_chrdt7_1,2,2)
           let #Res_start_mm = substr($Gpjp_res_chrdt7_1,4,2)
           let #Res_start_dd = substr($Gpjp_res_chrdt7_1,6,2)
           move #Res_start_yy to $Res_start_yy 99
           move #Res_start_mm to $Res_start_mm 99
           move #Res_start_dd to $Res_start_dd 99
           let $Res_start_eyymmdd = 'H' || ltrim($Res_start_yy,' ') || '    ' || ltrim($Res_start_mm,' ')
             || '   ' || ltrim($Res_start_dd,' ')
           
           if NOT IsBlank($Gpjp_res_chrdt7_1)
            print $Res_start_eyymmdd     (0,45,12)   !12
           end-if

  print $Gpjp_app_class1       (0,64,12) edit 99999999999B    !13   
  print #Gpjp_payable_loan1       (0,91,12) edit 99999999999B    !14   
  print #Gpjp_yea_spctax       (+2,17,12) edit 99999999999B   !15   
 
 let #Res_start_yy2 = substr($Gpjp_res_chrdt7_2,2,2)
           let #Res_start_mm2 = substr($Gpjp_res_chrdt7_2,4,2)
           let #Res_start_dd2 = substr($Gpjp_res_chrdt7_2,6,2)
           move #Res_start_yy2 to $Res_start_yy2 99
           move #Res_start_mm2 to $Res_start_mm2 99
           move #Res_start_dd2 to $Res_start_dd2 99
           let $Res_start_eyymmdd2 = 'H' || ltrim($Res_start_yy2,' ') || '    ' || ltrim($Res_start_mm2,' ')
             || '   ' || ltrim($Res_start_dd2,' ')
           
           if NOT IsBlank($Gpjp_res_chrdt7_2)
            print $Res_start_eyymmdd2     (0,45,12)   !16
           end-if

  print $Gpjp_app_class2       (0,64,12) edit 99999999999B    !17   
  print #Gpjp_payable_loan2    (0,91,12) edit 99999999999B    !18    
  print #Gpjp_yea_spsinc       (+4,58,12) edit 99999999999B    !21    
  print #Gpjp_yea_natpen       (0,78,12) edit 99999999999B    !22     
  print #Gpjp_yea_ltnonl       (0,98,12) edit 99999999999B    !23   
  

  do Get-Translatable-Data ('GPJPYEA', 'JUVENILE', $Juvenile)
  do Get-Translatable-Data ('GPJPYE01', 'NON RESIDENT', $Non_Resident) 
  do Print-Dependent-Data-Wage-Payment-Report

  concat  $Gpjp_yea_summ_new with  $Dep_Description

           let $Yeasumm1 = substrp($Dep_Description,1,80)
           let #strlen = lengthp($Yeasumm1)
           let $Yeasumm2 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm2)
           let $Yeasumm3 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm3)
           let $Yeasumm4 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm4)
           let $Yeasumm5 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = #strlen + lengthp($Yeasumm5)
           let $Yeasumm6 = substrp($Dep_Description,#strlen + 1,80)
           let #strlen = 90 

  print $Yeasumm1            (35,10,#strlen)   !####DESCRIPTION COLUMN###      
  print $Yeasumm2            (36,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm3            (37,10,#strlen)   !####DESCRIPTION COLUMN###    
  print $Yeasumm4            (38,10,#strlen)   !####DESCRIPTION COLUMN###
  print $Yeasumm5            (39,10,#strlen)   !####DESCRIPTION COLUMN###  
  print $Yeasumm6            (40,10,#strlen)   !####DESCRIPTION COLUMN###
            
           if #Gpjp_yea_hirmid = 1
              print 'o'                 (83,55,1)                       !12
              print $Middt_Year_in_era  (0,64,2)                        !14
              print $Middt_Month        (0,69,2)                        !15
              print $Middt_Day          (0,74,2)                        !16                    
           else
              if #Gpjp_yea_hirmid = 2
                 print 'o'                (83,60,1)                     !13              
                 print $Middt_Year_in_era (0,64,2)                       !14
                 print $Middt_Month       (0,69,2)                       !15
                 print $Middt_Day         (0,74,2)                       !16                                     
              else
                 print ' '                (83,59,1)
              end-if
           end-if

           if $Gpjp_yea_bdtera = '1'
              print 'o'                 (0,83,1)                        !17
           else
             if $Gpjp_yea_bdtera = '2'
                print 'o'               (0,88,1)                        !18
             else
                if $Gpjp_yea_bdtera = '3'
                   print 'o'            (0,92,1)                        !19
                else
                   print 'o'            (0,97,1)                        !20
                end-if
             end-if
           end-if

          print $Print_year_in_era      (0,101,2)                       !21          
          print $Print_month            (0,106,2)                       !22          
          print $Print_day              (0,111,2)                       !23
            
           if #Gpjp_yea_minor = 1
              print 'o'                 (0,10,1)                         !1              
           end-if

           if $Gpjp_yea_forgn = '1'
              print 'o'                 (0,14,1)                        !2              
           end-if

           if $Gpjp_yea_trmdth = '1'
              print 'o'                 (0,18,1)                        !3              
           end-if

           if $Gpjp_yea_otsu = '1'
              print 'o'                 (0,27,1)                        !5              
           end-if

           if $Gpjp_yea_disfl1 = '1'
              print 'o'                 (0,32,1)                        !6              
           end-if

           if $Gpjp_yea_disfl2 = '1'
              print 'o'                 (0,36,1)                        !7              
           end-if

           if $Gpjp_yea_widow = '1'
              print 'o'                 (0,41,1)                        !8             
           else
              if $Gpjp_yea_widow = '2'
                 print 'o'              (0,45,1)                        !9                 
              end-if
           end-if

           if $Gpjp_yea_wdwer = '1'
              print 'o'                 (0,49,1)                        !10             
           end-if

           if $Gpjp_yea_wrkstd = '1'
              print 'o'                 (0,54,1)                        !11              
           end-if

          let $Estab_address1 = substrp($Gpjp_yea_fladdr1,1,{ESTAB_ADDR_LEN})
          let #strlen = lengthp($Estab_address1)
          let $Estab_address2 = substrp($Gpjp_yea_fladdr1,#strlen + 1,{ESTAB_ADDR_LEN})
          let #strlen = {ESTAB_ADDR_LEN}+2

          if #Firm_Number > 0
          print #Firm_Number           (+2,26,30)   edit xbxbxbxbxbxbxbxbxbxbxbxbx  point-size = 9
          else
          position (+2)          
          end-if
          print $Estab_address1        (+3,27,#strlen)                                   
          print $Estab_address2        (+1,27,#strlen)                         
          print $EstabName             (+2,27,50)                                            
          print $Phone                 (0,85,24)                
                         
end-procedure  !Print-Details-New-Wage-Payment-Report

!***********************************************************************
!                                                                      *
! Age-In-Years                                                         *
!                                                                      *
!                                                                      *
! Called By:    Print-Dependent-Data                                   *
!                                                                      *
! Description:  Gets Age of Employee or Dependents                     *
!                                                                      *
!***********************************************************************

begin-procedure Age-In-Years($pBIRTHDATE, $pSYSDATE, :#pAGE)


do Convert-To-DTU-Date($pBIRTHDATE, $pBIRTHDATE)
do Convert-To-DTU-Date($pSYSDATE, $pSYSDATE)
If isnull($pBIRTHDATE) or isnull($pSYSDATE)
let #pAge = 0
else

let #EMP_AGE = 0

do dtu-parse-date($pBIRTHDATE, #BIRTH_YEAR,
#BIRTH_MONTH, #BIRTH_DAY)

do dtu-parse-date($pSYSDATE, #CURRENT_YEAR,
#CURRENT_MONTH, #CURRENT_DAY)

If Not (#BIRTH_YEAR = - 1 Or
#BIRTH_MONTH = - 1 Or
#BIRTH_DAY = - 1)
! Age = difference in years, adjusted for date in the year...
let #EMP_AGE = #CURRENT_YEAR - #BIRTH_YEAR
If (#CURRENT_MONTH < #BIRTH_MONTH) Or
(#CURRENT_MONTH = #BIRTH_MONTH And
#CURRENT_DAY < #BIRTH_DAY)
let #EMP_AGE = #EMP_AGE - 1
end-if
end-if

If #EMP_AGE < 0
let #EMP_AGE = 0
end-if

let #pAGE = #EMP_AGE
end-if

end-procedure !Age-In-Years 

!***********************************************************************
!                                                                      *
! Check-Non-Resident                                                   *
!                                                                      *
!                                                                      *
! Called By:    Print-Dependent-Data                                   *
!                                                                      *
! Description:  Checks if a Dependent is Non Resident or not           *
!                                                                      *
!***********************************************************************

begin-procedure Check-Non-Resident($EMPLID1, $DEPENDENT_BENEF1, $DEP_DATE, :$Gpjp_no_rsdnt)

begin-select
DEPX.GPJP_NO_RSDNT_RLTV

 let $Gpjp_no_rsdnt = &DEPX.Gpjp_no_rsdnt_rltv
 
FROM  PS_GPJP_IT_DEP_TAX  DEPX
WHERE DEPX.EMPLID         = $EMPLID1
AND DEPX.DEPENDENT_BENEF= $DEPENDENT_BENEF1
AND DEPX.EFFDT =           (SELECT MAX(DEPX1.EFFDT) FROM PS_GPJP_IT_DEP_TAX  DEPX1
                           WHERE DEPX1.EMPLID = DEPX.EMPLID
                           AND DEPX1.DEPENDENT_BENEF = DEPX.DEPENDENT_BENEF
                           AND DEPX1.EFFDT <= $DEP_DATE)

end-select
end-procedure ! Check-Non-Resident 
!***********************************************************************
!                                                                      *
! Print-Dependent-Data-Withholding-Report                              *
!                                                                      *
!                                                                      *
! Called By:    Print-Details-New-Withholding-Report                   *
!                                                                      *
! Description:  Reads Dependent Data table to get Dependent Details    *
!                                                                      *
!***********************************************************************
begin-procedure Print-Dependent-Data-Withholding-Report

let $Dep_Name = ' '
let $Dep_Name_ac = ' '
let #Dep_Count1 = 1
let #Dep_Count2 = 1
let #Tot_Count = 1
let #Line_Count = 55
let #Line_Count2 = 55
let $Dep_Description = ' '
let $Dep_Comment = ' '

begin-select
NAM.EMPLID
NAM.NAME_FORMAL
NAM.NAME_AC
BEN.DEPENDENT_BENEF
BEN.BIRTHDATE
BEN.RELATIONSHIP

     let $_My_Emplid = &NAM.Emplid
     let $Dep_Name    = &NAM.Name_Formal
     let $Dep_Name_Ac = &NAM.Name_ac
     let $Dep_Birth_Date = &BEN.Birthdate
     let $Dependent_Benef = &BEN.Dependent_benef
     let $Relationship = &BEN.Relationship

     let $_DB_Pers_Nbr = ' '
     if $RC_Print_Pers_Nbr = 'Y'
       if $JPN-Personal-Nbr-Installed='Y'
        do Get_Pers_Nbr2($Emplid,$Dependent_Benef,$_DB_Pers_Nbr)    !gpjppnbr.sqc
       end-if
     end-if
 
     do Check-Non-Resident($Emplid, $Dependent_Benef, $EndYR_Dt, $Dep_Status)
     do Age-In-Years($Dep_Birth_Date, $EndYR_Dt, #Dep_Age)

  if $Relationship = 'SP' ! ###Spouse###
      If #Gpjp_yea_spsded = 0   

          print $Dep_Name_Ac       (49,24,12)       !19    
          print $Dep_Name_Ac       (49,138,12)      !19

          print $Dep_Name          (51,24,12)      !19       
          print $Dep_Name          (51,138,12)     !19
             
          print $_DB_Pers_Nbr       (53,138,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8   !19 

          if $Dep_Status = 'Y'
             print 'o'       (50,53,12)    !25   
             print 'o'       (50,169,12)   !25
          end-if
       Else 
           move #Tot_Count to $Tot_Count
                     let $Tot_Count = rtrim($Tot_Count, '.0')
                     concat '(' with  $Dep_Description
                     concat  $Tot_Count with  $Dep_Description 
                     concat ')' with  $Dep_Description
                     concat $Dep_Name with  $Dep_Description
                     concat ' ' with  $Dep_Description
             Concat '(Spouse Sp)' with $Dep_Description
                     if $Dep_Status = 'Y'
                       concat '(' with  $Dep_Description
                       concat  $Non_Resident with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                     end-if

                     let $Dep_Comment = ''                 
                     concat '(' with  $Dep_Comment
                     concat  $Tot_Count with  $Dep_Comment
                     concat ')' with  $Dep_Comment

                                  
                     let #Line_Count = #Line_Count + 1
                     let #Tot_Count = #Tot_Count + 1 
    END-IF

  else
          if #Dep_Age > 16

                EVALUATE #Dep_Count1

                WHEN = 1       ! ###Qualified Dependent-1###

                   print  $Dep_Name_Ac          (54,24,12)    !24    
                   print  $Dep_Name_Ac          (54,138,12)   !24

                   print  $Dep_Name           (56,24,12)    !24   
                   print  $Dep_Name           (56,138,12)   !24
  
                   print $_DB_Pers_Nbr       (58,138,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24

                   if $Dep_Status = 'Y'
                       print 'o'       (55,53,12)    !25   
                       print 'o'       (55,169,12)   !25
                   end-if 
                   let #Dep_Count1 = #Dep_Count1 + 1       
                   BREAK



                WHEN = 2       ! ###Qualified Dependent-2###

                   print  $Dep_Name_Ac          (59,24,12)    !24    
                   print  $Dep_Name_Ac          (59,138,12)   !24

                   print  $Dep_Name       (61,24,12)    !24   
                   print  $Dep_Name       (61,138,12)   !24
  
                   print $_DB_Pers_Nbr       (63,138,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24

                   if $Dep_Status = 'Y'
                     print 'o'       (60,53,12)    !25   
                     print 'o'       (60,169,12)   !25
                   end-if 
                   let #Dep_Count1 = #Dep_Count1 + 1       
                   BREAK



                 WHEN = 3       ! ###Qualified Dependent-3###

                   print  $Dep_Name_Ac          (64,24,12)    !24    
                   print  $Dep_Name_Ac          (64,138,12)   !24

                   print  $Dep_Name       (66,24,12)    !24   
                   print  $Dep_Name       (66,138,12)   !24
  

                   print $_DB_Pers_Nbr       (68,138,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24

                   if $Dep_Status = 'Y'
                      print 'o'       (65,53,12)    !25   
                      print 'o'       (65,169,12)   !25
                   end-if
                   let #Dep_Count1 = #Dep_Count1 + 1       
                   BREAK



                 WHEN = 4       ! ###Qualified Dependent-4###

                    print  $Dep_Name_Ac          (69,24,12)    !24    
                    print  $Dep_Name_Ac          (69,138,12)   !24

                    print  $Dep_Name        (71,24,12)    !24   
                    print  $Dep_Name        (71,138,12)   !24
  

                    print $_DB_Pers_Nbr       (73,138,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24

                    if $Dep_Status = 'Y'
                       print 'o'       (70,53,12)    !25   
                       print 'o'       (70,169,12)   !25
                    end-if 
                    let #Dep_Count1 = #Dep_Count1 + 1       
                    BREAK


                  WHEN-OTHER
                     move #Tot_Count to $Tot_Count
                     let $Tot_Count = rtrim($Tot_Count, '.0')
                     concat '(' with  $Dep_Description
                     concat  $Tot_Count with  $Dep_Description 
                     concat ')' with  $Dep_Description
                     concat $Dep_Name with  $Dep_Description
                     concat ' ' with  $Dep_Description
                     if $Dep_Status = 'Y'
                       concat '(' with  $Dep_Description
                       concat  $Non_Resident with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                     end-if

                     let $Dep_Comment = ''                 
                     concat '(' with  $Dep_Comment
                     concat  $Tot_Count with  $Dep_Comment
                     concat ')' with  $Dep_Comment

                     print $Dep_Comment               (#Line_Count,218,5)  !###COMMENTs COLUMN###
                     let #Line_Count = #Line_Count + 1 
                     print $_DB_Pers_Nbr              (#Line_Count,219,15) point-size = 6                
                     let #Line_Count = #Line_Count + 1
                     let #Tot_Count = #Tot_Count + 1       
                     
                  END-EVALUATE

       
          else


                  EVALUATE #Dep_Count2

                  WHEN = 1       ! ###Dependent under 16 -1###

                     print  $Dep_Name_Ac          (54,70,12)    !26    
                     print  $Dep_Name_Ac          (54,185,12)   !26

                     print  $Dep_Name       (56,70,12)    !26   
                     print  $Dep_Name       (56,185,12)   !26
  
                     if $Dep_Status = 'Y'
                        print 'o'       (55,98,12)    !27   
                        print 'o'       (55,214,12)   !27
                     end-if 
                     let #Dep_Count2 = #Dep_Count2 + 1       
                     BREAK



                  WHEN = 2       ! ###Dependent under 16-2###

                     print  $Dep_Name_Ac          (59,70,12)    !26    
                     print  $Dep_Name_Ac          (59,185,12)   !26

                     print  $Dep_Name       (61,70,12)    !26   
                     print  $Dep_Name       (61,185,12)   !26

                     if $Dep_Status = 'Y'
                       print 'o'       (60,98,12)    !27   
                       print 'o'       (60,214,12)   !27
                     end-if 
                     let #Dep_Count2 = #Dep_Count2 + 1       
                     BREAK



                  WHEN = 3       ! ###Dependent under 16-3###

                      print  $Dep_Name_Ac          (64,70,12)    !26    
                      print  $Dep_Name_Ac          (64,185,12)   !26

                      print  $Dep_Name       (66,70,12)    !26   
                      print  $Dep_Name       (66,185,12)   !26

                      if $Dep_Status = 'Y'
                         print 'o'       (65,98,12)    !27   
                         print 'o'       (65,214,12)   !27
                      end-if 
                      let #Dep_Count2 = #Dep_Count2 + 1       
                      BREAK


                  WHEN = 4       ! ###Dependent under 16-4###

                      print  $Dep_Name_Ac          (69,70,12)    !26    
                      print  $Dep_Name_Ac          (69,185,12)   !26

                      print  $Dep_Name       (71,70,12)    !26   
                      print  $Dep_Name       (71,185,12)   !26

                      if $Dep_Status = 'Y'
                          print 'o'       (70,98,12)    !27   
                          print 'o'       (70,214,12)   !27
                      end-if 
                      let #Dep_Count2 = #Dep_Count2 + 1       
                      BREAK



                   WHEN-OTHER
                       move #Tot_Count to $Tot_Count
                       let $Tot_Count = rtrim($Tot_Count, '.0')
                       concat '(' with  $Dep_Description
                       concat  $Tot_Count with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat $Dep_Name with  $Dep_Description
                       concat ' ' with  $Dep_Description
                       concat '(' with  $Dep_Description
                       concat  $Juvenile with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                       if $Dep_Status = 'Y'
                       concat '(' with  $Dep_Description
                       concat  $Non_Resident with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                       end-if  
                       let #Tot_Count = #Tot_Count + 1    
                   END-EVALUATE
  
         end-if
  end-if
FROM  PS_DEP_BEN_NAME NAM, PS_GPJP_DEPEND_VW BEN
WHERE NAM.EMPLID         =      $Emplid
AND NAM.EFFDT            =      (SELECT MAX(NAM1.EFFDT) FROM PS_DEP_BEN_NAME NAM1
                                WHERE NAM1.EMPLID = NAM.EMPLID
                                AND NAM1.DEPENDENT_BENEF = NAM.DEPENDENT_BENEF
                                AND NAM1.EFFDT <= $EndYR_Dt)
AND BEN.EMPLID           =      NAM.EMPLID
AND BEN.DEPENDENT_BENEF  =      NAM.DEPENDENT_BENEF
AND BEN.EFFDT            =      (SELECT MAX(BEN1.EFFDT) FROM PS_GPJP_DEPEND_VW BEN1
                                WHERE BEN1.EMPLID = BEN.EMPLID
                                AND BEN1.DEPENDENT_BENEF = BEN.DEPENDENT_BENEF
                                AND BEN1.EFFDT <= $EndYR_Dt)

end-select

end-procedure !Print-Dependent-Data-Withholding-Report

!***********************************************************************
!                                                                      *
! Print-Dependent-Data-Wage-Payment-Report                             *
!                                                                      *
!                                                                      *
! Called By:    Print-Details-New-Wage-Payment-Report                  *
!                                                                      *
! Description:  Reads Dependent Data table to get Dependent Details    *
!                                                                      *
!***********************************************************************
begin-procedure Print-Dependent-Data-Wage-Payment-Report

let $Dep_Name = ' '
let $Dep_Name_ac = ' '
let #Dep_Count1 = 1
let #Dep_Count2 = 1
let #Tot_Count = 1
let #Line_Count = 58
let #Line_Count2 =69
let $Dep_Description = ' '
let $Dep_Comment = ' '

begin-select
NAM1.EMPLID
NAM1.NAME_FORMAL
NAM1.NAME_AC
BEN1.DEPENDENT_BENEF
BEN1.BIRTHDATE
BEN1.RELATIONSHIP

     let $_My_Emplid = &NAM1.Emplid
     let $Dep_Name    = &NAM1.Name_Formal
     let $Dep_Name_Ac = &NAM1.Name_ac
     let $Dep_Birth_Date = &BEN1.Birthdate
     let $Dependent_Benef = &BEN1.Dependent_benef
     let $Relationship = &BEN1.Relationship

     let $_DB_Pers_Nbr = ' '    
     if $JPN-Personal-Nbr-Installed='Y'
        do Get_Pers_Nbr2($Emplid,$Dependent_Benef,$_DB_Pers_Nbr)    !gpjppnbr.sqc
     end-if    
 
     do Check-Non-Resident($Emplid, $Dependent_Benef, $EndYR_Dt, $Dep_Status)
     do Age-In-Years($Dep_Birth_Date, $EndYR_Dt, #Dep_Age)

  if $Relationship = 'SP' ! ###Spouse###
      If #Gpjp_yea_spsded = 0 
          print $Dep_Name_Ac       (50,22,12)       !19    
          print $Dep_Name          (51,22,12)      !19                    
          print $_DB_Pers_Nbr       (53,22,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8   !19 
          if $Dep_Status = 'Y'
             print 'o'       (51,52,12)    !25   
          end-if
      Else 
           move #Tot_Count to $Tot_Count
                     let $Tot_Count = rtrim($Tot_Count, '.0')
                     concat '(' with  $Dep_Description
                     concat  $Tot_Count with  $Dep_Description 
                     concat ')' with  $Dep_Description
                     concat $Dep_Name with  $Dep_Description
                     concat ' ' with  $Dep_Description
             Concat '(Spouse Sp)' with $Dep_Description
                     if $Dep_Status = 'Y'
                       concat '(' with  $Dep_Description
                       concat  $Non_Resident with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                     end-if

                     let $Dep_Comment = ''                 
                     concat '(' with  $Dep_Comment
                     concat  $Tot_Count with  $Dep_Comment
                     concat ')' with  $Dep_Comment
              
                     let #Line_Count = #Line_Count + 1
                     let #Tot_Count = #Tot_Count + 1 
    END-IF
  else
          if #Dep_Age > 16

                EVALUATE #Dep_Count1

                WHEN = 1       ! ###Qualified Dependent-1###
                   print  $Dep_Name_Ac          (55,22,12)    !24    
                   print  $Dep_Name           (56,22,12)    !24                   
                   print $_DB_Pers_Nbr       (59,22,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24
                   if $Dep_Status = 'Y'
                       print 'o'       (56,52,12)    !25                        
                   end-if 
                   let #Dep_Count1 = #Dep_Count1 + 1       
                   BREAK

                WHEN = 2       ! ###Qualified Dependent-2###
                   print  $Dep_Name_Ac          (60,22,12)    !24                       
                   print  $Dep_Name       (61,22,12)    !24                        
                   print $_DB_Pers_Nbr       (64,22,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24
                   if $Dep_Status = 'Y'
                     print 'o'       (61,52,12)    !25                        
                   end-if 
                   let #Dep_Count1 = #Dep_Count1 + 1       
                   BREAK

                 WHEN = 3       ! ###Qualified Dependent-3###
                   print  $Dep_Name_Ac          (66,22,12)    !24                      
                   print  $Dep_Name       (67,22,12)    !24                        
                   print $_DB_Pers_Nbr       (69,22,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24
                   if $Dep_Status = 'Y'
                      print 'o'       (66,52,12)    !25                        
                   end-if
                   let #Dep_Count1 = #Dep_Count1 + 1       
                   BREAK

                 WHEN = 4       ! ###Qualified Dependent-4###
                    print  $Dep_Name_Ac          (71,22,12)    !24                        
                    print  $Dep_Name        (72,22,12)    !24                         
                    print $_DB_Pers_Nbr       (74,22,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8    !24
                    if $Dep_Status = 'Y'
                       print 'o'       (72,52,12)    !25                         
                    end-if 
                    let #Dep_Count1 = #Dep_Count1 + 1       
                    BREAK

                  WHEN-OTHER
                     move #Tot_Count to $Tot_Count
                     let $Tot_Count = rtrim($Tot_Count, '.0')
                     concat '(' with  $Dep_Description
                     concat  $Tot_Count with  $Dep_Description 
                     concat ')' with  $Dep_Description
                     concat $Dep_Name with  $Dep_Description
                     concat ' ' with  $Dep_Description
                     if $Dep_Status = 'Y'
                       concat '(' with  $Dep_Description
                       concat  $Non_Resident with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                     end-if

                     let $Dep_Comment = ''                 
                     concat '(' with  $Dep_Comment
                     concat  $Tot_Count with  $Dep_Comment
                     concat ')' with  $Dep_Comment

                     print $Dep_Comment               (#Line_Count,103,5)  !###COMMENTs COLUMN###
                     let #Line_Count = #Line_Count + 1 
                     print $_DB_Pers_Nbr              (#Line_Count,104,15) point-size = 4                
                     let #Line_Count = #Line_Count + 1
                     let #Tot_Count = #Tot_Count + 1       
                     
                  END-EVALUATE       
          else
                  EVALUATE #Dep_Count2

                  WHEN = 1       ! ###Dependent under 16 -1###
                     print  $Dep_Name_Ac          (55,70,12)    !26    
                     print  $Dep_Name       (56,70,12)    !26                                              
                     print $_DB_Pers_Nbr       (59,70,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8                     
                     if $Dep_Status = 'Y'
                        print 'o'       (56,99,12)    !27                      
                     end-if 
                     let #Dep_Count2 = #Dep_Count2 + 1       
                     BREAK

                  WHEN = 2       ! ###Dependent under 16-2###
                     print  $Dep_Name_Ac          (61,70,12)    !26                         
                     print  $Dep_Name       (62,70,12)    !26                                             
                     print $_DB_Pers_Nbr       (64,70,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8                     
                     if $Dep_Status = 'Y'
                       print 'o'       (61,99,12)    !27                        
                     end-if 
                     let #Dep_Count2 = #Dep_Count2 + 1       
                     BREAK

                  WHEN = 3       ! ###Dependent under 16-3###
                      print  $Dep_Name_Ac          (66,70,12)    !26                          
                      print  $Dep_Name       (67,70,12)    !26                               
                      if $Gpjp_yea_type <> '10'
                      print $_DB_Pers_Nbr       (69,70,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8
                      end-if
                      if $Dep_Status = 'Y'
                         print 'o'       (66,99,12)    !27                           
                      end-if 
                      let #Dep_Count2 = #Dep_Count2 + 1       
                      BREAK

                  WHEN = 4       ! ###Dependent under 16-4###
                      print  $Dep_Name_Ac          (71,70,12)    !26                 
                      print  $Dep_Name       (72,70,12)    !26                                                                    
                      print $_DB_Pers_Nbr       (74,70,30) edit xbxbxbxbxbxbxbxbxbxbxbx  point-size = 8                      
                      if $Dep_Status = 'Y'
                          print 'o'       (71,99,12)    !27                             
                      end-if 
                      let #Dep_Count2 = #Dep_Count2 + 1       
                      BREAK

                   WHEN-OTHER
                       move #Tot_Count to $Tot_Count
                       let $Tot_Count = rtrim($Tot_Count, '.0')
                       concat '(' with  $Dep_Description
                       concat  $Tot_Count with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat $Dep_Name with  $Dep_Description
                       concat ' ' with  $Dep_Description
                       concat '(' with  $Dep_Description
                       concat  $Juvenile with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                       if $Dep_Status = 'Y'
                       concat '(' with  $Dep_Description
                       concat  $Non_Resident with  $Dep_Description 
                       concat ')' with  $Dep_Description
                       concat ' ' with  $Dep_Description
                       end-if  

                       let $Dep_Comment = ''                 
                       concat '(' with  $Dep_Comment
                       concat  $Tot_Count with  $Dep_Comment
                       concat ')' with  $Dep_Comment

                       print $Dep_Comment               (#Line_Count2,103,5)  !###COMMENTs COLUMN###
                       let #Line_Count2 = #Line_Count2 + 1 
                       print $_DB_Pers_Nbr              (#Line_Count2,104,15) point-size = 4                
                       let #Line_Count2 = #Line_Count2 + 1                     
                       let #Tot_Count = #Tot_Count + 1    
                   END-EVALUATE  
         end-if
  end-if
FROM  PS_DEP_BEN_NAME NAM1, PS_GPJP_DEPEND_VW BEN1
WHERE NAM1.EMPLID         =      $Emplid
AND NAM1.EFFDT            =      (SELECT MAX(NAM11.EFFDT) FROM PS_DEP_BEN_NAME NAM11
                                WHERE NAM11.EMPLID = NAM1.EMPLID
                                AND NAM11.DEPENDENT_BENEF = NAM1.DEPENDENT_BENEF
                                AND NAM11.EFFDT <= $EndYR_Dt)
AND BEN1.EMPLID           =      NAM1.EMPLID
AND BEN1.DEPENDENT_BENEF  =      NAM1.DEPENDENT_BENEF
AND BEN1.EFFDT            =      (SELECT MAX(BEN11.EFFDT) FROM PS_GPJP_DEPEND_VW BEN11
                                WHERE BEN11.EMPLID = BEN1.EMPLID
                                AND BEN11.DEPENDENT_BENEF = BEN1.DEPENDENT_BENEF
                                AND BEN11.EFFDT <= $EndYR_Dt)

end-select

end-procedure !Print-Dependent-Data-Wage-Payment-Report
!***********************************************************************
!                                                                      *
! Get-Japanese-Dates                                                   *
!                                                                      *
!                                                                      *
! Called By:    Withholding-Report & Wage-Payment-Report               *
!                                                                      *
! Description:  This procedure converts the hired/termination dates    *
!               into the appropriate Japanese format                   *
!                                                                      *
!***********************************************************************
begin-procedure Get-Japanese-Dates

        let $Middt_Year_in_era  = substr($Gpjp_yea_middt,1,2)
        let $Middt_Month        = substr($Gpjp_yea_middt,3,2)
        let $Middt_Day          = substr($Gpjp_yea_middt,5,2)

        let $Print_year_in_era  = substr($Gpjp_yea_bthdt6,1,2)
        let $Print_month        = substr($Gpjp_yea_bthdt6,3,2)
        let $Print_day          = substr($Gpjp_yea_bthdt6,5,2)

end-procedure !Get-Japanese-Dates

!***********************************************************************
!                                                                      *
! Check-Status                                                         *
!                                                                      *
!                                                                      *
! Called By:    Withholding-Report & Wage-Payment-Report               *
!                                                                      *
! Description:  This procedure checks the status of an employee on the *
!               PS_JOB table.                                          *
!                                                                      *
!***********************************************************************
begin-procedure Check-Status

    let  $Status = ' '

begin-select

JOB.EMPLID
JOB.EMPL_RCD
JOB.EFFDT
JOB.EFFSEQ
JOB.EMPL_STATUS
JOB.ACTION_REASON

      let $Status = Rtrim(&JOB.EMPL_STATUS,' ')
      let $Effdt  = &JOB.Effdt
      let $reason = Rtrim(&JOB.ACTION_REASON,' ')

FROM  PS_JOB JOB
WHERE JOB.EMPLID        = $Emplid
AND JOB.EMPL_RCD        = #Empl_rcd
AND JOB.PAY_SYSTEM_FLG  = 'GP'
AND JOB.EFFDT           = (SELECT MAX(JOB1.EFFDT) FROM PS_JOB JOB1
                           WHERE JOB1.EMPLID = JOB.EMPLID
                           AND JOB1.EMPL_RCD = JOB.EMPL_RCD
                           AND JOB1.EFFDT <= $EndYR_Dt)
AND JOB.EFFSEQ          = (SELECT MAX(JOB2.EFFSEQ) FROM PS_JOB JOB2
                           WHERE JOB2.EMPLID = JOB.EMPLID
                           AND JOB2.EMPL_RCD = JOB.EMPL_RCD
                           AND JOB2.EFFDT = JOB.EFFDT)

end-select

        if $Status <> 'T' and $Status <> ' '
           let $Comp_date = $NextJan
        else
           if $Status <> ' '
              let $Comp_date = $Effdt
           else
              let $Comp_date = $AsOfToday
           end-if
        end-if

end-procedure  !Check-Status

!***********************************************************************
!                                                                      *
!                                                                      *
! SQCS included in the report                                          *
!                                                                      *
!***********************************************************************
#include 'getestab.sqc'     ! Get Establishment Data from the GPJP_TAX_ESTAB
#include 'datemath.sqc'     ! Date conversion procedures
#include 'number.sqc'       ! Routines to format numbers
#include 'datetime.sqc'     ! Routines for date and time formatting
#include 'sqrtrans.sqc'     ! Translate SQR strings to given language
#include 'prcsapi.sqc'      ! Replaces stdapi.sqc
#include 'prcslng.sqc'      ! Replaces getrplng.sqc
#include 'readxlat.sqc'     ! Procedure to read values from xlattable
#include 'reset1.sqc'       ! Reset printer procedure
#include 'hrsecty.sqc'      ! Get SQR Security parameters
#Include 'getsetid.sqc'     ! Get Set Id from the Tableset Record Detail
#include 'getsupjp.sqc'     ! Get Supervisor Level Name
